var ki=Object.create;var Me=Object.defineProperty;var zi=Object.getOwnPropertyDescriptor;var Xi=Object.getOwnPropertyNames;var Ui=Object.getPrototypeOf,Wi=Object.prototype.hasOwnProperty;var vt=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var Re=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var Yi=(i,e,t,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Xi(e))!Wi.call(i,s)&&s!==t&&Me(i,s,{get:()=>e[s],enumerable:!(l=zi(e,s))||l.enumerable});return i};var ee=(i,e,t)=>(t=i!=null?ki(Ui(i)):{},Yi(e||!i||!i.__esModule?Me(t,"default",{value:i,enumerable:!0}):t,i));var ie=Re(Ht=>{(function(i){Date.now=Date.now||function(){return new Date().getTime()};var e={extend:function(){arguments[0]=arguments[0]||{};for(var s=1;s<arguments.length;s++)for(var r in arguments[s])arguments[s].hasOwnProperty(r)&&(typeof arguments[s][r]=="object"?arguments[s][r]instanceof Array?arguments[0][r]=arguments[s][r]:arguments[0][r]=e.extend(arguments[0][r],arguments[s][r]):arguments[0][r]=arguments[s][r]);return arguments[0]},binarySearch:function(s,r){for(var c=0,o=s.length;c<o;){var n=c+o>>1;r<s[n][0]?o=n:c=n+1}return c},pixelSnap:function(s,r){return r%2===0?Math.round(s):Math.floor(s)+.5}};function t(s){this.options=e.extend({},t.defaultOptions,s),this.disabled=!1,this.clear()}t.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},t.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},t.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var s=1;s<this.data.length;s++){var r=this.data[s][1];r>this.maxValue&&(this.maxValue=r),r<this.minValue&&(this.minValue=r)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},t.prototype.append=function(s,r,c){if(!(isNaN(s)||isNaN(r))){var o=this.data.length-1;if(o>=0)for(var n=o;;){var a=this.data[n];if(s>=a[0]){s===a[0]?c?(a[1]+=r,r=a[1]):a[1]=r:this.data.splice(n+1,0,[s,r]);break}if(n--,n<0){this.data.splice(0,0,[s,r]);break}}else this.data.push([s,r]);this.maxValue=isNaN(this.maxValue)?r:Math.max(this.maxValue,r),this.minValue=isNaN(this.minValue)?r:Math.min(this.minValue,r)}},t.prototype.dropOldData=function(s,r){for(var c=0;this.data.length-c>=r&&this.data[c+1][0]<s;)c++;c!==0&&this.data.splice(0,c)};function l(s){this.options=e.extend({},l.defaultChartOptions,s),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}l.tooltipFormatter=function(s,r){var c=this.options.timestampFormatter||l.timeFormatter,o=document.createElement("div"),n;o.appendChild(document.createTextNode(c(new Date(s))));for(var a=0;a<r.length;++a){n=r[a].series.options.tooltipLabel||"",n!==""&&(n=n+" ");var d=document.createElement("span");d.style.color=r[a].series.options.strokeStyle,d.appendChild(document.createTextNode(n+this.options.yMaxFormatter(r[a].value,this.options.labels.precision))),o.appendChild(document.createElement("br")),o.appendChild(d)}return o.innerHTML},l.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(s,r){return parseFloat(s).toFixed(r)},yMaxFormatter:function(s,r){return parseFloat(s).toFixed(r)},yIntermediateFormatter:function(s,r){return parseFloat(s).toFixed(r)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:2,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},title:{text:"",fillStyle:"#ffffff",fontSize:15,fontFamily:"monospace",verticalAlign:"middle"},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:l.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},l.AnimateCompatibility=function(){var s=function(c,o){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(function(){a(Date.now())},16)};return n.call(window,c,o)},r=function(c){var o=window.cancelAnimationFrame||function(n){clearTimeout(n)};return o.call(window,c)};return{requestAnimationFrame:s,cancelAnimationFrame:r}}(),l.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},l.prototype.addTimeSeries=function(s,r){this.seriesSet.push({timeSeries:s,options:e.extend({},l.defaultSeriesPresentationOptions,r)}),s.options.resetBounds&&s.options.resetBoundsInterval>0&&(s.resetBoundsTimerId=setInterval(function(){s.resetBounds()},s.options.resetBoundsInterval))},l.prototype.removeTimeSeries=function(s){for(var r=this.seriesSet.length,c=0;c<r;c++)if(this.seriesSet[c].timeSeries===s){this.seriesSet.splice(c,1);break}s.resetBoundsTimerId&&clearInterval(s.resetBoundsTimerId)},l.prototype.getTimeSeriesOptions=function(s){for(var r=this.seriesSet.length,c=0;c<r;c++)if(this.seriesSet[c].timeSeries===s)return this.seriesSet[c].options},l.prototype.bringToFront=function(s){for(var r=this.seriesSet.length,c=0;c<r;c++)if(this.seriesSet[c].timeSeries===s){var o=this.seriesSet.splice(c,1);this.seriesSet.push(o[0]);break}},l.prototype.streamTo=function(s,r){this.canvas=s,this.clientWidth=parseInt(this.canvas.getAttribute("width")),this.clientHeight=parseInt(this.canvas.getAttribute("height")),this.delay=r,this.start()},l.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.pointerEvents="none",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},l.prototype.updateTooltip=function(){if(this.options.tooltip){var s=this.getTooltipEl();if(!this.mouseover||!this.options.tooltip){s.style.display="none";return}for(var r=this.lastChartTimestamp,c=this.options.scrollBackwards?r-this.mouseX*this.options.millisPerPixel:r-(this.clientWidth-this.mouseX)*this.options.millisPerPixel,o=[],n=0;n<this.seriesSet.length;n++){var a=this.seriesSet[n].timeSeries;if(!a.disabled){var d=e.binarySearch(a.data,c);d>0&&d<a.data.length&&o.push({series:this.seriesSet[n],index:d,value:a.data[d][1]})}}o.length?(s.innerHTML=this.options.tooltipFormatter.call(this,c,o),s.style.display="block"):s.style.display="none"}},l.prototype.mousemove=function(s){if(this.mouseover=!0,this.mouseX=s.offsetX,this.mouseY=s.offsetY,this.mousePageX=s.pageX,this.mousePageY=s.pageY,!!this.options.tooltip){var r=this.getTooltipEl();r.style.top=Math.round(this.mousePageY)+"px",r.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()}},l.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},l.prototype.resize=function(){var s=!this.options.enableDpiScaling||!window?1:window.devicePixelRatio,r,c;this.options.responsive?(r=this.canvas.offsetWidth,c=this.canvas.offsetHeight,r!==this.lastWidth&&(this.lastWidth=r,this.canvas.setAttribute("width",Math.floor(r*s).toString()),this.canvas.getContext("2d").scale(s,s)),c!==this.lastHeight&&(this.lastHeight=c,this.canvas.setAttribute("height",Math.floor(c*s).toString()),this.canvas.getContext("2d").scale(s,s)),this.clientWidth=r,this.clientHeight=c):(r=parseInt(this.canvas.getAttribute("width")),c=parseInt(this.canvas.getAttribute("height")),s!==1?(Math.floor(this.clientWidth*s)!==r&&(this.canvas.setAttribute("width",Math.floor(r*s).toString()),this.canvas.style.width=r+"px",this.clientWidth=r,this.canvas.getContext("2d").scale(s,s)),Math.floor(this.clientHeight*s)!==c&&(this.canvas.setAttribute("height",Math.floor(c*s).toString()),this.canvas.style.height=c+"px",this.clientHeight=c,this.canvas.getContext("2d").scale(s,s))):(this.clientWidth=r,this.clientHeight=c))},l.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var s=function(){this.frame=l.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var r=new Date(0),c=this.seriesSet.reduce(function(o,n){var a=n.timeSeries.data,d=Math.round(this.options.displayDataFromPercentile*a.length)-1;if(d=d>=0?d:0,d=d<=a.length-1?d:a.length-1,a&&a.length>0){var f=a[d][0];o=o>f?o:f}return o}.bind(this),r);this.render(this.canvas,c>r?c:null)}else this.render();s()}.bind(this))}.bind(this);s()}},l.prototype.stop=function(){this.frame&&(l.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},l.prototype.updateValueRange=function(){for(var s=this.options,r=Number.NaN,c=Number.NaN,o=0;o<this.seriesSet.length;o++){var n=this.seriesSet[o].timeSeries;n.disabled||(isNaN(n.maxValue)||(r=isNaN(r)?n.maxValue:Math.max(r,n.maxValue)),isNaN(n.minValue)||(c=isNaN(c)?n.minValue:Math.min(c,n.minValue)))}if(s.maxValue!=null?r=s.maxValue:r*=s.maxValueScale,s.minValue!=null?c=s.minValue:c-=Math.abs(c*s.minValueScale-c),this.options.yRangeFunction){var a=this.options.yRangeFunction({min:c,max:r});c=a.min,r=a.max}if(!isNaN(r)&&!isNaN(c)){var d=r-c,f=d-this.currentValueRange,u=c-this.currentVisMinValue;this.isAnimatingScale=Math.abs(f)>.1||Math.abs(u)>.1,this.currentValueRange+=s.scaleSmoothing*f,this.currentVisMinValue+=s.scaleSmoothing*u}this.valueRange={min:c,max:r}},l.prototype.render=function(s,r){var c=Date.now();if(!(this.options.limitFPS>0&&c-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(r=(r||c)-(this.delay||0),r-=r%this.options.millisPerPixel,!this.isAnimatingScale){var o=this.lastChartTimestamp===r;if(o){var n=c-this.lastRenderTimeMillis>166.66666666666666;if(!n)return}}this.lastRenderTimeMillis=c,this.lastChartTimestamp=r,this.resize(),s=s||this.canvas;var a=s.getContext("2d"),d=this.options,f={top:0,left:0,width:this.clientWidth,height:this.clientHeight},u=r-f.width*d.millisPerPixel,g=function(z,q){var tt=z-this.currentVisMinValue,ut=this.currentValueRange===0?f.height:f.height*(1-tt/this.currentValueRange);return e.pixelSnap(ut,q)}.bind(this),S=function(z,q){var tt=d.scrollBackwards?(r-z)/d.millisPerPixel:f.width-(r-z)/d.millisPerPixel;return e.pixelSnap(tt,q)};if(this.updateValueRange(),a.font=d.labels.fontSize+"px "+d.labels.fontFamily,a.save(),a.translate(f.left,f.top),a.beginPath(),a.rect(0,0,f.width,f.height),a.clip(),a.save(),a.fillStyle=d.grid.fillStyle,a.clearRect(0,0,f.width,f.height),a.fillRect(0,0,f.width,f.height),a.restore(),a.save(),a.lineWidth=d.grid.lineWidth,a.strokeStyle=d.grid.strokeStyle,d.grid.millisPerLine>0){a.beginPath();for(var p=r-r%d.grid.millisPerLine;p>=u;p-=d.grid.millisPerLine){var T=S(p,d.grid.lineWidth);a.moveTo(T,0),a.lineTo(T,f.height)}a.stroke(),a.closePath()}for(var L=1;L<d.grid.verticalSections;L++){var b=e.pixelSnap(L*f.height/d.grid.verticalSections,d.grid.lineWidth);a.beginPath(),a.moveTo(0,b),a.lineTo(f.width,b),a.stroke(),a.closePath()}if(d.grid.borderVisible&&(a.beginPath(),a.strokeRect(0,0,f.width,f.height),a.closePath()),a.restore(),d.horizontalLines&&d.horizontalLines.length)for(var E=0;E<d.horizontalLines.length;E++){var F=d.horizontalLines[E],_=F.lineWidth||1,C=g(F.value,_);a.strokeStyle=F.color||"#ffffff",a.lineWidth=_,a.beginPath(),a.moveTo(0,C),a.lineTo(f.width,C),a.stroke(),a.closePath()}for(var h=0;h<this.seriesSet.length;h++){var R=this.seriesSet[h].timeSeries,m=R.data;if(R.dropOldData(u,d.maxDataSetLength),!(m.length<=1||R.disabled)){a.save();var v=this.seriesSet[h].options,A=v.strokeStyle&&v.strokeStyle!=="none",w=A?v.lineWidth:0;a.beginPath();var M=S(m[0][0],w),G=g(m[0][1],w),H=M,x=G,B;switch(a.moveTo(M,G),v.interpolation||d.interpolation){case"linear":case"line":{B=function(z,q,tt,ut){a.lineTo(z,q)};break}case"bezier":default:{B=function(z,q,tt,ut){a.bezierCurveTo(Math.round((tt+z)/2),ut,Math.round(tt+z)/2,q,z,q)};break}case"step":{B=function(z,q,tt,ut){a.lineTo(z,ut),a.lineTo(z,q)};break}}for(var X=1;X<m.length;X++){var dt=m[X],gt=S(dt[0],w),Le=g(dt[1],w);B(gt,Le,H,x),H=gt,x=Le}A&&(a.lineWidth=v.lineWidth,a.strokeStyle=v.strokeStyle,a.stroke()),v.fillStyle&&(a.lineTo(H,f.height+w+1),a.lineTo(M,f.height+w+1),a.fillStyle=v.fillStyle,a.fill()),a.restore()}}d.tooltip&&this.mouseX>=0&&(a.lineWidth=d.tooltipLine.lineWidth,a.strokeStyle=d.tooltipLine.strokeStyle,a.beginPath(),a.moveTo(this.mouseX,0),a.lineTo(this.mouseX,f.height),a.closePath(),a.stroke()),this.updateTooltip();var J=d.labels;if(!J.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var Fe=d.yMaxFormatter(this.valueRange.max,J.precision),Nt=d.yMinFormatter(this.valueRange.min,J.precision),Gi=d.scrollBackwards?0:f.width-a.measureText(Fe).width-2,Pi=d.scrollBackwards?0:f.width-a.measureText(Nt).width-2;a.fillStyle=J.fillStyle,a.fillText(Fe,Gi,J.fontSize),a.fillText(Nt,Pi,f.height-2)}if(J.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&d.grid.verticalSections>0)for(var Ni=(this.valueRange.max-this.valueRange.min)/d.grid.verticalSections,Hi=f.height/d.grid.verticalSections,L=1;L<d.grid.verticalSections;L++){var b=f.height-Math.round(L*Hi),Qt=d.yIntermediateFormatter(this.valueRange.min+L*Ni,J.precision),Oi=J.intermediateLabelSameAxis?d.scrollBackwards?0:f.width-a.measureText(Qt).width-2:d.scrollBackwards?f.width-a.measureText(Qt).width-2:0;a.fillText(Qt,Oi,b-d.grid.lineWidth)}if(d.timestampFormatter&&d.grid.millisPerLine>0)for(var jt=d.scrollBackwards?a.measureText(Nt).width:f.width-a.measureText(Nt).width+4,p=r-r%d.grid.millisPerLine;p>=u;p-=d.grid.millisPerLine){var T=S(p,0);if(!d.scrollBackwards&&T<jt||d.scrollBackwards&&T>jt){var Bi=new Date(p),Kt=d.timestampFormatter(Bi),Jt=a.measureText(Kt).width;jt=d.scrollBackwards?T+Jt+2:T-Jt-2,a.fillStyle=d.labels.fillStyle,d.scrollBackwards?a.fillText(Kt,T,f.height-2):a.fillText(Kt,T-Jt,f.height-2)}}if(d.title.text!==""){a.font=d.title.fontSize+"px "+d.title.fontFamily;var Vi=d.scrollBackwards?f.width-a.measureText(d.title.text).width-2:2;if(d.title.verticalAlign=="bottom"){a.textBaseline="bottom";var te=f.height}else if(d.title.verticalAlign=="middle"){a.textBaseline="middle";var te=f.height/2}else{a.textBaseline="top";var te=0}a.fillStyle=d.title.fillStyle,a.fillText(d.title.text,Vi,te)}a.restore()}},l.timeFormatter=function(s){function r(c){return(c<10?"0":"")+c}return r(s.getHours())+":"+r(s.getMinutes())+":"+r(s.getSeconds())},i.TimeSeries=t,i.SmoothieChart=l})(Ht)});var Pe=Re((Ge,ne)=>{(function(i){if(typeof Ge=="object"&&typeof ne<"u")ne.exports=i();else if(typeof define=="function"&&define.amd)define([],i);else{var e;e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this,e.Fili=i()}})(function(){return function i(e,t,l){function s(o,n){if(!t[o]){if(!e[o]){var a=typeof vt=="function"&&vt;if(!n&&a)return a(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(u){var g=e[o][1][u];return s(g||u)},f,f.exports,i,e,t,l)}return t[o].exports}for(var r=typeof vt=="function"&&vt,c=0;c<l.length;c++)s(l[c]);return s}({1:[function(i,e,t){"use strict";e.exports={CalcCascades:i("./src/calcCascades"),Fft:i("./src/fft"),FirCoeffs:i("./src/firCoeffs"),FirFilter:i("./src/firFilter"),IirCoeffs:i("./src/iirCoeffs"),IirFilter:i("./src/iirFilter"),TestFilter:i("./src/testFilter")}},{"./src/calcCascades":2,"./src/fft":3,"./src/firCoeffs":4,"./src/firFilter":5,"./src/iirCoeffs":6,"./src/iirFilter":7,"./src/testFilter":8}],2:[function(i,e,t){"use strict";var l=i("./iirCoeffs"),s=new l,r={bessel:{q:[[.57735026919],[.805538281842,.521934581669],[1.02331395383,.611194546878,.510317824749],[1.22566942541,.710852074442,.559609164796,.505991069397],[1.41530886916,.809790964842,.620470155556,.537552151325,.503912727276],[1.59465693507,.905947107025,.684008068137,.579367238641,.525936202016,.502755558204],[1.76552743493,.998998442993,.747625068271,.624777082395,.556680772868,.519027293158,.502045428643],[1.9292718407,1.08906376917,.810410302962,.671382379377,.591144659703,.542678365981,.514570953471,.501578400482],[2.08691792612,1.17637337045,.872034231424,.718163551101,.627261751983,.569890924765,.533371782078,.511523796759,.50125489338],[2.23926560629,1.26117120993,.932397288146,.764647810579,.664052481472,.598921924986,.555480327396,.526848630061,.509345928377,.501021580965],[2.38695091667,1.34368488961,.991497755204,.81060830488,.701011199665,.628878390935,.57943181849,.545207253735,.52208637596,.507736060535,.500847111042],[2.53048919562,1.42411783481,1.04937620183,.85593899901,.737862159044,.659265671705,.604435823473,.565352679646,.537608804383,.51849505465,.506508536474,.500715908905]],f3dB:[[1.27201964951],[1.60335751622,1.43017155999],[1.9047076123,1.68916826762,1.60391912877],[2.18872623053,1.95319575902,1.8320926012,1.77846591177],[2.45062684305,2.20375262593,2.06220731793,1.98055310881,1.94270419166],[2.69298925084,2.43912611431,2.28431825401,2.18496722634,2.12472538477,2.09613322542],[2.91905714471,2.66069088948,2.49663434571,2.38497976939,2.30961462222,2.26265746534,2.24005716132],[3.13149167404,2.87016099416,2.69935018044,2.57862945683,2.49225505119,2.43227707449,2.39427710712,2.37582307687],[3.33237300564,3.06908580184,2.89318259511,2.76551588399,2.67073340527,2.60094950474,2.55161764546,2.52001358804,2.50457164552],[3.52333123464,3.25877569704,3.07894353744,2.94580435024,2.84438325189,2.76691082498,2.70881411245,2.66724655259,2.64040228249,2.62723439989],[3.70566068548,3.44032173223,3.2574059854,3.11986367838,3.01307175388,2.92939234605,2.86428726094,2.81483068055,2.77915465405,2.75596888377,2.74456638588],[3.88040469682,3.61463243697,3.4292654707,3.28812274966,3.17689762788,3.08812364257,3.01720732972,2.96140104561,2.91862858495,2.88729479473,2.8674198668,2.8570800015]],f1dB:[[2.16477559371],[2.70320928596,2.41122332505],[3.25676581436,2.88822569572,2.74246238837],[3.76153580353,3.35675411406,3.14862673032,3.05646412475],[4.22174260104,3.79644757806,3.55260471864,3.41193742197,3.34673435508],[4.64584812552,4.20789257981,3.94082363122,3.76942681446,3.66549975744,3.61617359345],[5.04060395196,4.5944592201,4.3111677248,4.11836351827,3.98822359814,3.90713836715,3.86811234525],[5.41107948467,4.95951159709,4.66435804468,4.45575796102,4.30650679478,4.20286750045,4.13720522991,4.10531748119],[5.76110791853,5.30592898465,5.00182215701,4.7811081045,4.61724509926,4.49660100894,4.41131378918,4.35667671372,4.32997951075],[6.09364309488,5.63609116014,5.32506930789,5.09480346139,4.91939504255,4.78540258409,4.68493280536,4.61302286993,4.56661931366,4.54382759952],[6.41100731543,5.95195558182,5.63550073656,5.39754464742,5.21278891332,5.06801430334,4.95539684456,4.8697869429,4.80814951843,4.76793469612,4.74828032403],[6.71506056052,6.25514029778,5.9343616072,5.69011422355,5.49763642361,5.34401973764,5.22125973611,5.12485045619,5.05037962112,4.99699982231,4.96155789635,4.94441828777]]}},c={bessel:{as:[[1.3617],[1.3397,.7743],[1.2217,.9686,.5131],[1.1112,.9754,.7202,.3728],[1.0215,.9393,.7815,.5604,.2883]],bs:[[.618],[.4889,.389],[.3887,.3505,.2756],[.3162,.2979,.2621,.2087],[.265,.2549,.2351,.2059,.1665]]},butterworth:{as:[[1.4142],[1.8478,.7654],[1.9319,1.4142,.5176],[1.9616,1.6629,1.1111,.3902],[1.9754,1.782,1.4142,.908,.3129]],bs:[[1],[1,1],[1,1,1],[1,1,1,1],[1,1,1,1,1]]},tschebyscheff05:{as:[[1.3614],[2.6282,.3648],[3.8645,.7528,.1589],[5.1117,1.0639,.3439,.0885],[6.3648,1.3582,.4822,.1994,.0563]],bs:[[1.3827],[3.4341,1.1509],[6.9797,1.8573,1.0711],[11.9607,2.9365,1.4206,1.0407],[18.3695,4.3453,1.944,1.252,1.0263]]},tschebyscheff1:{as:[[1.3022],[2.5904,.3039],[3.8437,.6292,.1296],[5.1019,.8916,.2806,.0717],[6.3634,1.1399,.3939,.1616,.0455]],bs:[[1.5515],[4.1301,1.1697],[8.5529,1.9124,1.0766],[14.7608,3.0426,1.4334,1.0432],[22.7468,4.5167,1.9665,1.2569,1.0277]]},tschebyscheff2:{as:[[1.1813],[2.4025,.2374],[3.588,.4925,.0995],[4.7743,.6991,.2153,.0547],[5.9618,.8947,.3023,.1233,.0347]],bs:[[1.7775],[4.9862,1.1896],[10.4648,1.9622,1.0826],[18.151,3.1353,1.4449,1.0461],[28.0376,4.6644,1.9858,1.2614,1.0294]]},tschebyscheff3:{as:[[1.065],[2.1853,.1964],[3.2721,.4077,.0815],[4.3583,.5791,.1765,.0448],[5.4449,.7414,.2479,.1008,.0283]],bs:[[1.9305],[5.5339,1.2009],[11.6773,1.9873,1.0861],[20.2948,3.1808,1.4507,1.0478],[31.3788,4.7363,1.9952,1.2638,1.0304]]},allpass:{as:[[1.6278],[2.337,1.3506],[2.6117,2.0706,1.0967],[2.7541,2.4174,1.785,.9239],[2.8406,2.612,2.1733,1.5583,.8018]],bs:[[.8832],[1.4878,1.1837],[1.7763,1.6015,1.2596],[1.942,1.83,1.6101,1.2822],[2.049,1.9714,1.8184,1.5923,1.2877]]}},o=function(f,u){var g=[],S=0;if(u!=="fromPZ")for(f.order>12&&(f.order=12),S=0;S<f.order;S++){var p,T,L;f.transform==="matchedZ"?g.push(s.lowpassMZ({Fs:f.Fs,Fc:f.Fc,preGain:f.preGain,as:c[f.characteristic].as[f.order-1][S],bs:c[f.characteristic].bs[f.order-1][S]})):(f.characteristic==="butterworth"?(p=.5/Math.sin(Math.PI/(2*f.order)*(S+.5)),T=1):(p=r[f.characteristic].q[f.order-1][S],T=f.oneDb?r[f.characteristic].f1dB[f.order-1][S]:r[f.characteristic].f3dB[f.order-1][S]),L=u==="highpass"?f.Fc/T:f.Fc*T,u!=="bandpass"&&u!=="bandstop"||f.characteristic==="bessel"&&(L=Math.sqrt(f.order)*L/f.order),g.push(s[u]({Fs:f.Fs,Fc:L,Q:p,BW:f.BW||0,gain:f.gain||0,preGain:f.preGain||!1})))}else for(S=0;S<f.length;S++)g.push(s[u](f[S]));return g},n=function(f){return function(u){return o(u,f)}},a={},d=function(){var f=[];for(var u in s)a[u]=n(u),f.push(u);return a.available=function(){return f},a};e.exports=d},{"./iirCoeffs":6}],3:[function(i,e,t){"use strict";var l=function(s){if(!function(_){return!(_&_-1)}(s))return!1;var r={};r.length=s,r.buffer=new Float64Array(s),r.re=new Float64Array(s),r.im=new Float64Array(s),r.reI=new Float64Array(s),r.imI=new Float64Array(s),r.twiddle=new Int32Array(s),r.sinTable=new Float64Array(s-1),r.cosTable=new Float64Array(s-1);var c=2*Math.PI,o=Math.floor(Math.log(s)/Math.LN2);for(a=r.sinTable.length;a--;)r.sinTable[a]=Math.sin(c*(a/s)),r.cosTable[a]=Math.cos(c*(a/s));for(var n=s>>1,a=0,d=0;r.twiddle[a]=d,!(++a>=s);){for(o=n;o<=d;)d-=o,o>>=1;d+=o}var f=Math.PI,u=2*Math.PI,g=Math.abs,S=Math.pow,p=Math.cos,T=Math.sin,L=function(_){return T(f*_)/(f*_)},b=Math.E,E={rectangular:{calc:function(){return 1},values:[],correction:1},none:{calc:function(){return 1},values:[],correction:1},hanning:{calc:function(_,C){return .5*(1-p(u*_/(C-1)))},values:[],correction:2},hamming:{calc:function(_,C){return .54-.46*p(u*_/(C-1))},values:[],correction:1.8518999946875638},tukery:{calc:function(_,C,h){return _<h*(C-1)/2?.5*(1+p(f*(2*_/(h*(C-1))-1))):(C-1)*(1-h/2)<_?.5*(1+p(f*(2*_/(h*(C-1))-2/h+1))):1},values:[],correction:4/3},cosine:{calc:function(_,C){return T(f*_/(C-1))},values:[],correction:1.570844266360796},lanczos:{calc:function(_,C){return L(2*_/(C-1)-1)},values:[],correction:1.6964337576195783},triangular:{calc:function(_,C){return 2/(C+1)*((C+1)/2-g(_-(C-1)/2))},values:[],correction:2},bartlett:{calc:function(_,C){return 2/(C-1)*((C-1)/2-g(_-(C-1)/2))},values:[],correction:2},gaussian:{calc:function(_,C,h){return S(b,-.5*S((_-(C-1)/2)/(h*(C-1)/2),2))},values:[],correction:5/3},bartlettHanning:{calc:function(_,C){var h=u*_/(C-1);return .62-.48*g(_/(C-1)-.5)-.38*p(h)},values:[],correction:2},blackman:{calc:function(_,C,h){var R=(1-h)/2,m=h/2,v=u*_/(C-1);return R-.5*p(v)+m*p(2*v)},values:[],correction:4/3},blackmanHarris:{calc:function(_,C){var h=u*_/(C-1);return .35875-.48829*p(h)+.14128*p(2*h)-.01168*p(3*h)},values:[],correction:1.5594508635},nuttall3:{calc:function(_,C){var h=u*_/(C-1);return .375-.5*p(h)+.125*p(2*h)},values:[],correction:1.56},nuttall3a:{calc:function(_,C){var h=u*_/(C-1);return .40897-.5*p(h)+.09103*p(2*h)},values:[],correction:1.692},nuttall3b:{calc:function(_,C){var h=u*_/(C-1);return .4243801-.4973406*p(h)+.078793*p(2*h)},values:[],correction:1.7372527},nuttall4:{calc:function(_,C){var h=u*_/(C-1);return .3125-.46875*p(h)+.1875*p(2*h)-.03125*p(3*h)},values:[],correction:1.454543},nuttall4a:{calc:function(_,C){var h=u*_/(C-1);return .338946-.481973*p(h)+.161054*p(2*h)-.018027*p(3*h)},values:[],correction:1.512732763},nuttall4b:{calc:function(_,C){var h=u*_/(C-1);return .355768-.481973*p(h)+.144232*p(2*h)-.012604*p(3*h)},values:[],correction:1.55223262},nuttall4c:{calc:function(_,C){var h=u*_/(C-1);return .3635819-.4891775*p(h)+.1365995*p(2*h)-.0106411*p(3*h)},values:[],correction:1.57129067},sft3f:{calc:function(_,C){var h=u*_/(C-1);return .26526-.5*p(h)+.23474*p(2*h)},values:[],correction:1.3610238},sft4f:{calc:function(_,C){var h=u*_/(C-1);return .21706-.42103*p(h)+.28294*p(2*h)-.07897*p(3*h)},values:[],correction:1.2773573},sft5f:{calc:function(_,C){var h=u*_/(C-1);return .1881-.36923*p(h)+.28702*p(2*h)-.13077*p(3*h)+.02488*p(4*h)},values:[],correction:1.23167769},sft3m:{calc:function(_,C){var h=u*_/(C-1);return .28235-.52105*p(h)+.19659*p(2*h)},values:[],correction:1.39343451},sft4m:{calc:function(_,C){var h=u*_/(C-1);return .241906-.460841*p(h)+.2552381*p(2*h)-.041872*p(3*h)},values:[],correction:1.3190596},sft5m:{calc:function(_,C){var h=u*_/(C-1);return .209671-.407331*p(h)+.281225*p(2*h)-.092669*p(3*h)+.0091036*p(4*h)},values:[],correction:1.26529456464},nift:{calc:function(_,C){var h=u*_/(C-1);return .2810639-.5208972*p(h)+.1980399*p(2*h)},values:[],correction:1.39094182},hpft:{calc:function(_,C){var h=u*_/(C-1);return(1-1.912510941*p(h)+1.079173272*p(2*h)-.1832630879*p(3*h))/C},values:[],correction:1},srft:{calc:function(_,C){var h=u*_/(C-1);return(1-1.93*p(h)+1.29*p(2*h)-.388*p(3*h)+.028*p(4*h))/C},values:[],correction:1},hft70:{calc:function(_,C){var h=u*_/(C-1);return(1-1.90796*p(h)+1.07349*p(2*h)-.18199*p(3*h))/C},values:[],correction:1},hft95:{calc:function(_,C){var h=u*_/(C-1);return(1-1.9383379*p(h)+1.3045202*p(2*h)-.402827*p(3*h)+.0350665*p(4*h))/C},values:[],correction:1},hft90d:{calc:function(_,C){var h=u*_/(C-1);return(1-1.942604*p(h)+1.340318*p(2*h)-.440811*p(3*h)+.043097*p(4*h))/C},values:[],correction:1},hft116d:{calc:function(_,C){var h=u*_/(C-1);return(1-1.9575375*p(h)+1.4780705*p(2*h)-.6367431*p(3*h)+.1228389*p(4*h)-.0066288*p(5*h))/C},values:[],correction:1},hft144d:{calc:function(_,C){var h=u*_/(C-1);return(1-1.96760033*p(h)+1.57983607*p(2*h)-.81123644*p(3*h)+.22583558*p(4*h)-.02773848*p(5*h)+9036e-7*p(6*h))/C},values:[],correction:1},hft196d:{calc:function(_,C){var h=u*_/(C-1);return(1-1.97441842*p(h)+1.65409888*p(2*h)-.95788186*p(3*h)+.3367342*p(4*h)-.06364621*p(5*h)+.00521942*p(6*h)-10599e-8*p(7*h))/C},values:[],correction:1},hft223d:{calc:function(_,C){var h=u*_/(C-1);return(1-1.98298997309*p(h)+1.75556083063*p(2*h)-1.19037717712*p(3*h)+.56155440797*p(4*h)-.17296769663*p(5*h)+.03233247087*p(6*h)-.00324954578*p(7*h)+.0001380104*p(8*h)-132725e-11*p(9*h))/C},values:[],correction:1},hft248d:{calc:function(_,C){var h=u*_/(C-1);return(1-1.985844164102*p(h)+1.791176438506*p(2*h)-1.282075284005*p(3*h)+.667777530266*p(4*h)-.240160796576*p(5*h)+.056656381764*p(6*h)-.008134974479*p(7*h)+.00062454465*p(8*h)-19808998e-12*p(9*h)+132974e-12*p(10*h))/C},values:[],correction:1}},F=function(_){return E[_.name].values.length!==_.N?(_.n===0&&(E[_.name].values.length=0),E[_.name].values[_.n]=E[_.name].correction*E[_.name].calc(_.n,_.N,_.a),E[_.name].values[_.n]):E[_.name].values};return{forward:function(_,C){var h,R,m,v,A,w,M,G,H,x,B,X;m=r.buffer.length;var dt={name:C,N:m,a:.5,n:0},gt=F(dt);if(typeof gt=="number")for(h=0;h<m;++h)dt.n=h,r.buffer[h]=_[h]*F(dt);else for(h=0;h<m;++h)r.buffer[h]=_[h]*gt[h];for(h=m;h--;)r.re[h]=r.buffer[r.twiddle[h]],r.im[h]=0;for(v=1;v<m;v=A)for(w=0,A=v+v,M=m/A,R=0;R<v;R++){for(G=r.cosTable[w],H=r.sinTable[w],h=R;h<m;h+=A)x=h+v,B=H*r.im[x]+G*r.re[x],X=G*r.im[x]-H*r.re[x],r.re[x]=r.re[h]-B,r.re[h]+=B,r.im[x]=r.im[h]-X,r.im[h]+=X;w+=M}return{re:r.re,im:r.im}},inverse:function(_,C){var h,R,m,v,A,w,M,G,H,x,B,X;for(m=_.length,h=m;h--;)R=r.twiddle[h],r.reI[h]=_[R],r.imI[h]=-C[R];for(v=1;v<m;v=A)for(w=0,A=v+v,M=m/A,R=0;R<v;R++){for(G=r.cosTable[w],H=r.sinTable[w],h=R;h<m;h+=A)x=h+v,B=H*r.imI[x]+G*r.reI[x],X=G*r.imI[x]-H*r.reI[x],r.reI[x]=r.reI[h]-B,r.reI[h]+=B,r.imI[x]=r.imI[h]-X,r.imI[h]+=X;w+=M}for(h=m;h--;)r.buffer[h]=r.reI[h]/m;return r.buffer},magnitude:function(_){for(var C=[],h=0;h<_.re.length;h++)C.push(Math.sqrt(_.re[h]*_.re[h]+_.im[h]*_.im[h]));return C},magToDb:function(_){for(var C=[],h=0;h<_.length;h++)C.push(20*Math.log(_[h])*Math.LOG10E);return C},phase:function(_){for(var C=[],h=0;h<_.re.length;h++)C.push(Math.atan2(_.im[h],_.re[h]));return C},windows:function(){var _=[];for(var C in E)_.push(C);return _}}};e.exports=l},{}],4:[function(i,e,t){"use strict";var l=function(){var s=function(n){var a=n.Fs,d=n.Fa,f=n.Fb,u=n.order||51,g=n.Att||100,S=function(_){for(var C=0,h=1,R=1;h>1e-6*R;)C+=2,h*=_*_/(C*C),R+=h;return R};u/2-Math.floor(u/2)==0&&u++;var p,T=(u-1)/2,L=[],b=0,E=0,F=[];for(L[0]=2*(f-d)/a,E=1;E<=T;E++)L[E]=(Math.sin(2*E*Math.PI*f/a)-Math.sin(2*E*Math.PI*d/a))/(E*Math.PI);for(b=g<21?0:g>50?.1102*(g-8.7):.5842*Math.pow(g-21,.4)+.07886*(g-21),p=S(b),E=0;E<=T;E++)F[T+E]=L[E]*S(b*Math.sqrt(1-E*E/(T*T)))/p;for(E=0;E<T;E++)F[E]=F[u-1-E];return F},r=function(n){var a=n.Fs,d=n.Fc,f=n.order,u=2*Math.PI*d/a,g=0,S=0,p=[];for(g=0;g<=f;g++)g-f/2==0?p[g]=u:(p[g]=Math.sin(u*(g-f/2))/(g-f/2),p[g]*=.54-.46*Math.cos(2*Math.PI*g/f)),S+=p[g];for(g=0;g<=f;g++)p[g]/=S;return p},c=function(n){var a;for(a=0;a<n.length;a++)n[a]=-n[a];return n[(n.length-1)/2]++,n},o=function(n){for(var a=r({order:n.order,Fs:n.Fs,Fc:n.F2}),d=c(r({order:n.order,Fs:n.Fs,Fc:n.F1})),f=[],u=0;u<a.length;u++)f.push(a[u]+d[u]);return f};return{lowpass:function(n){return r(n)},highpass:function(n){return c(r(n))},bandstop:function(n){return o(n)},bandpass:function(n){return c(o(n))},kbFilter:function(n){return s(n)},available:function(){return["lowpass","highpass","bandstop","bandpass","kbFilter"]}}};e.exports=l},{}],5:[function(i,e,t){"use strict";var l=i("./utils"),s=l.runMultiFilter,r=l.runMultiFilterReverse,c=l.complex,o=l.evaluatePhase,n=function(a){var d=a,f=[],u=0;for(u=0;u<d.length;u++)f[u]={re:d[u],im:0};var g=function(b){var E,F=[];for(E=0;E<b;E++)F.push(0);return{buf:F,pointer:0}},S=g(d.length-1),p=function(b,E){E.buf[E.pointer]=b;var F=0;for(u=0;u<E.buf.length;u++)F+=d[u]*E.buf[(E.pointer+u)%E.buf.length];return E.pointer=(E.pointer+1)%E.buf.length,F},T=function(b){var E=g(d.length-1);return s(b,E,p)},L=function(b){for(var E=b.Fs,F=b.Fr,_=-Math.PI*(F/E)*2,C={re:0,im:0},h=0;h<d.length-1;h++)C=c.add(C,c.mul(f[h],{re:Math.cos(_*h),im:Math.sin(_*h)}));var R=c.magnitude(C);return{magnitude:R,phase:c.phase(C),dBmagnitude:20*Math.log(R)*Math.LOG10E}};return{responsePoint:function(b){return L(b)},response:function(b){b=b||100;var E=[],F=0,_=2*b;for(F=0;F<b;F++)E[F]=L({Fs:_,Fr:F});return o(E),E},simulate:function(b){return T(b)},singleStep:function(b){return p(b,S)},multiStep:function(b,E){return s(b,S,p,E)},filtfilt:function(b,E){return r(s(b,S,p,E),S,p,!0)},reinit:function(){S=g(d.length-1)}}};e.exports=n},{"./utils":9}],6:[function(i,e,t){"use strict";var l=function(){var s=function(o,n){var a=o.Q,d=o.Fc,f=o.Fs,u={},g=2*Math.PI*d/f;return o.BW?u.alpha=Math.sin(g)*Math.sinh(Math.log(2)/2*o.BW*g/Math.sin(g)):u.alpha=Math.sin(g)/(2*a),u.cw=Math.cos(g),u.a0=1+u.alpha,n.a0=u.a0,n.a.push(-2*u.cw/u.a0),n.k=1,n.a.push((1-u.alpha)/u.a0),u},r=function(o){var n=o.Q,a=o.Fc,d=o.Fs,f={},u=2*Math.PI*a/d;return f.alpha=Math.sin(u)/(2*n),f.cw=Math.cos(u),f.A=Math.pow(10,o.gain/40),f},c=function(){var o={};return o.z=[0,0],o.a=[],o.b=[],o};return{fromPZ:function(o){var n=c();return n.a0=1,n.b.push(1),n.b.push(-o.z0.re-o.z1.re),n.b.push(o.z0.re*o.z1.re-o.z0.im*o.z1.im),n.a.push(-o.p0.re-o.p1.re),n.a.push(o.p0.re*o.p1.re-o.p0.im*o.p1.im),o.type==="lowpass"?n.k=(1+n.a[0]+n.a[1])/(1+n.b[1]+n.b[2]):n.k=(1-n.a[0]+n.a[1])/(1-n.b[1]+n.b[2]),n},lowpassMZ:function(o){var n=c();n.a0=1;var a=o.as,d=o.bs,f=2*Math.PI*o.Fc/o.Fs,u=-a/(2*d);return n.a.push(2*-Math.pow(Math.E,u*f)*Math.cos(-f*Math.sqrt(Math.abs(Math.pow(a,2)/(4*Math.pow(d,2))-1/d)))),n.a.push(Math.pow(Math.E,2*u*f)),o.preGain?(n.b.push(1),n.k=n.a0+n.a[0]+n.a[1]):(n.b.push(n.a0+n.a[0]+n.a[1]),n.k=1),n.b.push(0),n.b.push(0),n},lowpassBT:function(o){var n=c();return o.Q=1,n.wp=Math.tan(2*Math.PI*o.Fc/(2*o.Fs)),n.wp2=n.wp*n.wp,o.BW&&delete o.BW,n.k=1,n.a0=3*n.wp+3*n.wp2+1,n.b.push(3*n.wp2*o.Q/n.a0),n.b.push(2*n.b[0]),n.b.push(n.b[0]),n.a.push((6*n.wp2-2)/n.a0),n.a.push((3*n.wp2-3*n.wp+1)/n.a0),n},highpassBT:function(o){var n=c();return o.Q=1,n.wp=Math.tan(2*Math.PI*o.Fc/(2*o.Fs)),n.wp2=n.wp*n.wp,o.BW&&delete o.BW,n.k=1,n.a0=n.wp+n.wp2+3,n.b.push(3*o.Q/n.a0),n.b.push(2*n.b[0]),n.b.push(n.b[0]),n.a.push((2*n.wp2-6)/n.a0),n.a.push((n.wp2-n.wp+3)/n.a0),n},lowpass:function(o){var n=c();o.BW&&delete o.BW;var a=s(o,n);return o.preGain?(n.k=.5*(1-a.cw),n.b.push(1/a.a0)):(n.k=1,n.b.push((1-a.cw)/(2*a.a0))),n.b.push(2*n.b[0]),n.b.push(n.b[0]),n},highpass:function(o){var n=c();o.BW&&delete o.BW;var a=s(o,n);return o.preGain?(n.k=.5*(1+a.cw),n.b.push(1/a.a0)):(n.k=1,n.b.push((1+a.cw)/(2*a.a0))),n.b.push(-2*n.b[0]),n.b.push(n.b[0]),n},allpass:function(o){var n=c();o.BW&&delete o.BW;var a=s(o,n);return n.k=1,n.b.push((1-a.alpha)/a.a0),n.b.push(-2*a.cw/a.a0),n.b.push((1+a.alpha)/a.a0),n},bandpassQ:function(o){var n=c(),a=s(o,n);return n.k=1,n.b.push(a.alpha*o.Q/a.a0),n.b.push(0),n.b.push(-n.b[0]),n},bandpass:function(o){var n=c(),a=s(o,n);return n.k=1,n.b.push(a.alpha/a.a0),n.b.push(0),n.b.push(-n.b[0]),n},bandstop:function(o){var n=c(),a=s(o,n);return n.k=1,n.b.push(1/a.a0),n.b.push(-2*a.cw/a.a0),n.b.push(n.b[0]),n},peak:function(o){var n=c(),a=r(o);return n.k=1,n.a0=1+a.alpha/a.A,n.a.push(-2*a.cw/n.a0),n.a.push((1-a.alpha/a.A)/n.a0),n.b.push((1+a.alpha*a.A)/n.a0),n.b.push(-2*a.cw/n.a0),n.b.push((1-a.alpha*a.A)/n.a0),n},lowshelf:function(o){var n=c();o.BW&&delete o.BW;var a=r(o);n.k=1;var d=2*Math.sqrt(a.A)*a.alpha;return n.a0=a.A+1+(a.A-1)*a.cw+d,n.a.push(-2*(a.A-1+(a.A+1)*a.cw)/n.a0),n.a.push((a.A+1+(a.A-1)*a.cw-d)/n.a0),n.b.push(a.A*(a.A+1-(a.A-1)*a.cw+d)/n.a0),n.b.push(2*a.A*(a.A-1-(a.A+1)*a.cw)/n.a0),n.b.push(a.A*(a.A+1-(a.A-1)*a.cw-d)/n.a0),n},highshelf:function(o){var n=c();o.BW&&delete o.BW;var a=r(o);n.k=1;var d=2*Math.sqrt(a.A)*a.alpha;return n.a0=a.A+1-(a.A-1)*a.cw+d,n.a.push(2*(a.A-1-(a.A+1)*a.cw)/n.a0),n.a.push((a.A+1-(a.A-1)*a.cw-d)/n.a0),n.b.push(a.A*(a.A+1+(a.A-1)*a.cw+d)/n.a0),n.b.push(-2*a.A*(a.A-1+(a.A+1)*a.cw)/n.a0),n.b.push(a.A*(a.A+1+(a.A-1)*a.cw-d)/n.a0),n},aweighting:function(o){var n=c();n.k=1;var a=2*Math.PI*o.Fc/o.Fs,d=2*Math.tan(a/2),f=o.Q,u=Math.pow(d,2);return n.a0=4*f+u*f+2*d,n.a.push(2*u*f-8*f),n.a.push(4*f+u*f-2*d),n.b.push(u*f),n.b.push(2*u*f),n.b.push(u*f),n}}};e.exports=l},{}],7:[function(i,e,t){"use strict";var l=i("./utils"),s=l.complex,r=l.runMultiFilter,c=l.runMultiFilterReverse,o=l.evaluatePhase,n=function(a){for(var d=a,f={re:1,im:0},u=[],g=[],S=0;S<d.length;S++){u[S]={};var p=d[S];u[S].b0={re:p.b[0],im:0},u[S].b1={re:p.b[1],im:0},u[S].b2={re:p.b[2],im:0},u[S].a1={re:p.a[0],im:0},u[S].a2={re:p.a[1],im:0},u[S].k={re:p.k,im:0},u[S].z=[0,0],g[S]={},g[S].b1=p.b[1]/p.b[0],g[S].b2=p.b[2]/p.b[0],g[S].a1=p.a[0],g[S].a2=p.a[1]}var T=function(m,v){var A=v*m.k.re-m.a1.re*m.z[0]-m.a2.re*m.z[1],w=m.b0.re*A+m.b1.re*m.z[0]+m.b2.re*m.z[1];return m.z[1]=m.z[0],m.z[0]=A,w},L=function(m,v){var A=m,w=0;for(w=0;w<v.length;w++)A=T(v[w],A);return A},b=function(m,v){var A=m.Fs,w=m.Fr,M=-Math.PI*(w/A)*2,G={re:Math.cos(M),im:Math.sin(M)},H=s.mul(v.k,s.add(v.b0,s.mul(G,s.add(v.b1,s.mul(v.b2,G))))),x=s.add(f,s.mul(G,s.add(v.a1,s.mul(v.a2,G)))),B=s.div(H,x);return{magnitude:s.magnitude(B),phase:s.phase(B)}},E=function(m){var v=0,A={magnitude:1,phase:0};for(v=0;v<u.length;v++){var w=b(m,u[v]);A.magnitude*=w.magnitude,A.phase+=w.phase}return A.dBmagnitude=20*Math.log(A.magnitude)*Math.LOG10E,A},F=function(){for(var m=[],v=0;v<d.length;v++)m[v]={b0:{re:p.b[0],im:0},b1:{re:p.b[1],im:0},b2:{re:p.b[2],im:0},a1:{re:p.a[0],im:0},a2:{re:p.a[1],im:0},k:{re:p.k,im:0},z:[0,0]};return m},_=function(m){var v=F();return r(m,v,L)},C=function(m,v){var A={},w=[],M=0;for(M=0;M<v;M++)w.push(m(M));A.out=_(w);var G=!1,H=!1;for(M=0;M<v-1;M++)if(A.out[M]>A.out[M+1]&&!G&&(G=!0,A.max={sample:M,value:A.out[M]}),G&&!H&&A.out[M]<A.out[M+1]){H=!0,A.min={sample:M,value:A.out[M]};break}return A},h=function(m,v){var A=Math.pow(m/2,2)-v;return A<0?[{re:-m/2,im:Math.sqrt(Math.abs(A))},{re:-m/2,im:-Math.sqrt(Math.abs(A))}]:[{re:-m/2+Math.sqrt(A),im:0},{re:-m/2-Math.sqrt(A),im:0}]},R=function(){for(var m=[],v=0;v<g.length;v++)m[v]={},m[v].z=h(g[v].b1,g[v].b2),m[v].p=h(g[v].a1,g[v].a2);return m};return{singleStep:function(m){return L(m,u)},multiStep:function(m,v){return r(m,u,L,v)},filtfilt:function(m,v){return c(r(m,u,L,v),u,L,!0)},simulate:function(m){return _(m)},stepResponse:function(m){return C(function(){return 1},m)},impulseResponse:function(m){return C(function(v){return v===0?1:0},m)},responsePoint:function(m){return E(m)},response:function(m){m=m||100;var v=[],A=0,w=2*m;for(A=0;A<m;A++)v[A]=E({Fs:w,Fr:A});return o(v),v},polesZeros:function(){return R()},reinit:function(){for(S=0;S<u.length;S++)u[S].z=[0,0]}}};e.exports=n},{"./utils":9}],8:[function(i,e,t){"use strict";var l=function(s){var r,c=s,o=[],n=function(u){for(r=0;r<u.steps;r++)o.push(c.singleStep((Math.random()-.5)*u.pp+u.offset))},a=function(u){var g=u.offset+u.pp,S=u.offset-u.pp;for(r=0;r<u.steps;r++)r%200<100?o.push(c.singleStep(g)):o.push(c.singleStep(S))},d=function(u){var g=u.offset+u.pp,S=u.offset-u.pp;for(r=0;r<u.steps;r++)r%100==0?o.push(c.singleStep(g)):o.push(c.singleStep(S))},f=function(u){var g=u.offset+u.pp,S=u.offset-u.pp,p=S,T=(g-S)/100;for(r=0;r<u.steps;r++)r%200<100?p+=T:p-=T,o.push(c.singleStep(p))};return{randomStability:function(u){for(c.reinit(),o.length=0,n(u),r=u.setup;r<o.length;r++)if(o[r]>u.maxStable||o[r]<u.minStable)return o[r];return!0},directedRandomStability:function(u){c.reinit(),o.length=0;var g;for(g=0;g<u.tests;g++){var S=Math.random();S<.25?n(u):S<.5?a(u):S<.75?d(u):f(u)}for(n(u),r=u.setup;r<o.length;r++)if(o[r]>u.maxStable||o[r]<u.minStable)return o[r];return!0},evaluateBehavior:function(){}}};e.exports=l},{}],9:[function(i,e,t){"use strict";t.evaluatePhase=function(o){var n=0,a=0,d=Math.PI,f=2*d,u=[];for(a=0;a<o.length;a++)u.push(o[a].phase);for(o[0].unwrappedPhase=o[0].phase,o[0].groupDelay=0,a=1;a<u.length;a++){var g=u[a]-u[a-1];if(g>d)for(n=a;n<u.length;n++)u[n]-=f;else if(g<-d)for(n=a;n<u.length;n++)u[n]+=f;u[a]<0?o[a].unwrappedPhase=-u[a]:o[a].unwrappedPhase=u[a],o[a].phaseDelay=o[a].unwrappedPhase/(a/o.length),o[a].groupDelay=(o[a].unwrappedPhase-o[a-1].unwrappedPhase)/(d/o.length),o[a].groupDelay<0&&(o[a].groupDelay=-o[a].groupDelay)}o[0].magnitude!==0?(o[0].phaseDelay=o[1].phaseDelay,o[0].groupDelay=o[1].groupDelay):(o[0].phaseDelay=o[2].phaseDelay,o[0].groupDelay=o[2].groupDelay,o[1].phaseDelay=o[2].phaseDelay,o[1].groupDelay=o[2].groupDelay)},t.runMultiFilter=function(o,n,a,d){var f=[];d&&(f=o);var u;for(u=0;u<o.length;u++)f[u]=a(o[u],n);return f},t.runMultiFilterReverse=function(o,n,a,d){var f=[];d&&(f=o);var u;for(u=o.length-1;u>=0;u--)f[u]=a(o[u],n);return f};var l=function(o,n){for(var a=!0;a;){var d=o,f=n;if(a=!1,f||(f=1),d!==Math.floor(d)||f!==Math.floor(f))return 1;if(d===0||d===1)return f;o=d-1,n=f*d,a=!0}};t.besselFactors=function(o){for(var n=[],a=0;a<o+1;a++){var d=l(2*o-a),f=Math.pow(2,o-a)*l(a)*l(o-a);n.unshift(Math.floor(d/f))}return n};var s=function(o,n){for(var a=0,d=0;d<n;d++){var f=1/Math.pow(2,d+1);o>f&&(o-=f,a+=f)}return a},r=function(o,n){return o&Math.pow(2,n)},c=function(o,n,a){var d=Math.abs(o),f=o-d;return{number:r(d,n).toString(),fraction:s(f,a).toString(),numberBits:n,fractionBits:a}};t.fixedPoint={convert:function(o,n,a){return c(o,n,a)},add:function(o,n){},sub:function(o,n){},mul:function(o,n){},div:function(o,n){}},t.complex={div:function(o,n){var a=o.re,d=o.im,f=n.re,u=n.im,g=f*f+u*u;return{re:(a*f+d*u)/g,im:(d*f-a*u)/g}},mul:function(o,n){var a=o.re,d=o.im,f=n.re,u=n.im;return{re:a*f-d*u,im:(a+d)*(f+u)-a*f-d*u}},add:function(o,n){return{re:o.re+n.re,im:o.im+n.im}},sub:function(o,n){return{re:o.re-n.re,im:o.im-n.im}},phase:function(o){return Math.atan2(o.im,o.re)},magnitude:function(o){return Math.sqrt(o.re*o.re+o.im*o.im)}}},{}]},{},[1])(1)})});var N=ee(ie(),1);var De=ee(ie(),1),Ot="#ebebebcc",Bt="#5f5f5fcc",St="14px Arial";function ye(i){return parseFloat(i.split("px")[0])}var st=class{timeseries;tsPresOpts;text;x=0;y=0;fillStyle;textBaseline="top";textAlign="start";font=St;on=!0;on_fillStyle;off_fillStyle=Bt;width=void 0;height=void 0;constructor(e,t,l,s="start",r=0,c=0,o=!0,n="top",a=St,d=void 0,f=void 0){this.timeseries=e,this.tsPresOpts=t,this.text=l,this.textAlign=s,this.x=r,this.y=c,this.on=o,this.fillStyle=t?.strokeStyle||(o?Ot:Bt),this.textBaseline=n,this.font=a,d!==void 0?this.on_fillStyle=d:this.on&&(this.on_fillStyle=this.fillStyle),f!==void 0?this.off_fillStyle=f:this.on||(this.off_fillStyle=this.fillStyle),this.enable(o)}getHeight(){return this.height=ye(this.font),this.height}getWidth(e){let t=e.getContext("2d");return t&&(t.save(),t.textBaseline=this.textBaseline,t.textAlign=this.textAlign,t.font=this.font,t.fillStyle=this.fillStyle,this.width=t.measureText(this.text).width,t.restore()),this.width}enable(e=!0){this.on=e,this.fillStyle=this.on?this.on_fillStyle:this.off_fillStyle}onclick(){this.on=!this.on,this.enable(this.on)}};function xe(i,e,t,l,s,r){return i>t&&i<t+l&&e>s&&e<s+r}var Et=class extends De.SmoothieChart{smoothieTSInfos;isRow=!0;enableRenderLegend=!0;allowToggleTooltip=!0;allowToggleLegend=!0;allowToggleLabelAuto=!0;ctrlFont=St;ctrlFontHeight=0;enableTooltipText="[Tooltip]";enableTooltipTextX=0;enableTooltipTextY=0;enableTooltipTextWidth=0;yAutoScaleText="[Auto Y scale]";yAutoScaleTextX=0;yAutoScaleTextY=0;yAutoScaleTextWidth=0;defaultXSpacing=10;defaultYSpacing=0;renderOffset=0;prevMinValue=void 0;prevMaxValue=void 0;scrollable=!1;constructor(e,t=!0,l=!0,s=!0,r=!0,c=!0,o=St,n=10,a=0,d=!1){super(e),this.smoothieTSInfos=[],this.isRow=t,this.enableRenderLegend=l,this.allowToggleTooltip=s,this.allowToggleLegend=r,this.allowToggleLabelAuto=c,this.ctrlFont=o,this.defaultXSpacing=n,this.defaultYSpacing=a,this.ctrlFontHeight=ye(this.ctrlFont),this.scrollable=d}canvasOnClick=e=>{if(this.allowToggleLegend&&"canvas"in this){let t=this.canvas;this.allowToggleTooltip&&this.options.tooltip!==void 0&&xe(e.offsetX,e.offsetY,this.enableTooltipTextX,this.enableTooltipTextWidth,this.enableTooltipTextY,this.ctrlFontHeight)&&(this.options.tooltip?(this.options.tooltip=!1,"tooltipEl"in this&&(this.tooltipEl.style.display="none")):this.options.tooltip=!0),this.allowToggleLabelAuto&&xe(e.offsetX,e.offsetY,this.yAutoScaleTextX,this.yAutoScaleTextWidth,this.yAutoScaleTextY,this.ctrlFontHeight)&&(this.yScaleIsAuto()?(this.options.minValue=this.prevMinValue||this?.valueRange?.min||20,this.options.maxValue=this.prevMaxValue||this?.valueRange?.max||-20,this.updateValueRange(),this.showScrollMessage()):(this.prevMinValue=this.options.minValue,this.prevMaxValue=this.options.maxValue,this.options.minValue=void 0,this.options.maxValue=void 0,this.updateValueRange()));for(let l=0;l<this.smoothieTSInfos.length;l++){let s=this.smoothieTSInfos[l],r=s.width||s.getWidth(t)||0,c=s.height||s.getHeight()||0;r>0&&c>0&&e.offsetX-this.renderOffset>s.x&&e.offsetX-this.renderOffset<s.x+r&&e.offsetY>s.y&&e.offsetY<s.y+c&&(s.onclick(),s.on?s.timeseries!==void 0&&this.addTimeSeries(s.timeseries,s.tsPresOpts):s.timeseries!==void 0&&this.removeTimeSeries(s.timeseries))}}};yScaleIsAuto(){return this.options.minValue===void 0||this.options.maxValue===void 0}streamTo(e,t){if(super.streamTo(e,t),"canvas"in this){let l=this.canvas;l.removeEventListener("click",this.canvasOnClick),l.addEventListener("click",this.canvasOnClick)}}render(e,t){if(super.render(e,t),this.enableRenderLegend&&this.smoothieTSInfos.length){let l=this.lastRenderTimeMillis;Date.now()-l<3&&this.renderLegend(e)}}renderLegend(e){let t=e.getContext("2d");if(t){t.save();let l=this.smoothieTSInfos,s=this.defaultXSpacing;this.allowToggleTooltip&&(t.textBaseline="top",t.textAlign="start",t.font=this.ctrlFont,t.fillStyle=this.options.tooltip?Ot:Bt,t.fillText(this.enableTooltipText,s,this.defaultYSpacing),this.enableTooltipTextX=s,this.enableTooltipTextY=this.defaultYSpacing,this.enableTooltipTextWidth=t.measureText(this.enableTooltipText).width,s+=this.enableTooltipTextWidth+this.defaultXSpacing),this.allowToggleLabelAuto&&(t.textBaseline="top",t.textAlign="start",t.font=this.ctrlFont,t.fillStyle=Ot,t.fillStyle=this.yScaleIsAuto()?Ot:Bt,t.fillText(this.yAutoScaleText,s,this.defaultYSpacing),this.yAutoScaleTextX=s,this.yAutoScaleTextY=this.defaultYSpacing,this.yAutoScaleTextWidth=t.measureText(this.yAutoScaleText).width,s+=this.yAutoScaleTextWidth+this.defaultXSpacing),this.renderOffset=s;let r=0;for(let c=0;c<l.length;c++){if(c>0){if(this.isRow&&l[c].x===l[0].x)l[c].x=l[c-1].x+r+this.defaultXSpacing;else if(!this.isRow&&l[c].y===l[0].y){let n=parseFloat(l[c].font.split("px")[0]);l[c].y=l[c-1].y+n+2}}let o=l[c];t.textBaseline=o.textBaseline,t.textAlign=o.textAlign,t.font=o.font,t.fillStyle=o.fillStyle,o.timeseries===void 0&&o.tsPresOpts===void 0?t.fillText(o.text,o.x,o.y):t.fillText(o.text,s+o.x,o.y),r=t.measureText(o.text).width}t.restore()}}addSmoothieTSInfo(e){this.smoothieTSInfos.indexOf(e)<0&&(this.smoothieTSInfos.push(e),e.timeseries!==void 0&&e.tsPresOpts!==void 0&&this.addTimeSeries(e.timeseries,e.tsPresOpts))}removeLegendTSInfo(e){let t=this.smoothieTSInfos.indexOf(e);return t>-1?(e.timeseries!==void 0&&this.removeTimeSeries(e.timeseries),this.smoothieTSInfos.splice(t,1)):[]}clearLegendTSInfos(){for(let e=0;e<this.smoothieTSInfos.length;e++){let t=this.smoothieTSInfos[e];t.timeseries!==void 0&&this.removeTimeSeries(t.timeseries)}this.smoothieTSInfos=[]}configureTimeSeries(e,t,l,s=!1,r=void 0,c=void 0,o=1,n=1,a="",d=!1,f=[],u=!0,g=!1,S=!0){this.clearLegendTSInfos();for(let p=0;p<e.length;p++){let T=new st(e[p],t[p],l[p].legend,l[p].textAlign,l[p].x,l[p].y,!0,l[p].textBaseline,l[p].font);this.addSmoothieTSInfo(T)}this.scrollable=s,this.showScrollMessage(),this.options.minValue=r,this.options.maxValue=c,this.options.minValueScale=o,this.options.maxValueScale=n,this.updateValueRange(),a.length>0&&this.options.title!==void 0&&(this.options.title.text=a),this.options.labels!==void 0&&(this.options.labels.disabled=d),this.options.horizontalLines=f,this.allowToggleLegend=u,this.allowToggleLabelAuto=g,this.allowToggleTooltip=S}showScrollMessage(){if(this.scrollable&&"canvas"in this){let e=this.canvas,t=new st(void 0,void 0,"Scroll to change y-range","center",e.width/window.devicePixelRatio/2,30,!0,"top","16px Arial","#fbfbfb");this.addSmoothieTSInfo(t),setTimeout(()=>{this.removeLegendTSInfo(t)},1500)}}};function P(i,e=10,t=5,l="top",s="start",r=St){return{legend:i,x:e,y:t,textBaseline:l,textAlign:s,font:r}}var O=ee(Pe(),1);var re=(i=>(i[i.SAMPLE_RATE=0]="SAMPLE_RATE",i[i.RESOLUTION=1]="RESOLUTION",i[i.RANGE_PN_UNIT=2]="RANGE_PN_UNIT",i[i.RANGE_MILI_UNIT=3]="RANGE_MILI_UNIT",i[i.NUM_CHANNELS=4]="NUM_CHANNELS",i[i.CONVERSION_FACTOR=5]="CONVERSION_FACTOR",i))(re||{});function se(i,e,t=!0){return i.getUint16(e,t)}function $i(i,e,t=!0){return i.getFloat32(e,t)}function qi(i,e,t=!0){return[i.getUint16(e,t),i.getUint16(e+2,t),i.getUint16(e+4,t),i.getUint16(e+6,t)]}var Zi={SAMPLE_RATE:se,RESOLUTION:se,RANGE_PN_UNIT:se,RANGE_MILI_UNIT:qi,CONVERSION_FACTOR:$i},Qi={SAMPLE_RATE:2,RESOLUTION:2,RANGE_PN_UNIT:2,RANGE_MILI_UNIT:8,NUM_CHANNELS:1,CONVERSION_FACTOR:4},ae=(i=>(i[i.GET_MEASUREMENT_SETTINGS=1]="GET_MEASUREMENT_SETTINGS",i[i.REQUEST_MEASUREMENT_START=2]="REQUEST_MEASUREMENT_START",i[i.REQUEST_MEASUREMENT_STOP=3]="REQUEST_MEASUREMENT_STOP",i))(ae||{}),ft=["SUCCESS","INVALID OP CODE","INVALID MEASUREMENT TYPE","NOT SUPPORTED","INVALID LENGTH","INVALID PARAMETER","ALREADY IN STATE","INVALID RESOLUTION","INVALID SAMPLE RATE","INVALID RANGE","INVALID MTU","INVALID NUMBER OF CHANNELS","INVALID STATE","DEVICE IN CHARGER"],Ne="fb005c80-02e7-f387-1cad-8acd2d8df0c8",ji="fb005c81-02e7-f387-1cad-8acd2d8df0c8",Ki="fb005c82-02e7-f387-1cad-8acd2d8df0c8",He="0000180d-0000-1000-8000-00805f9b34fb",Ji="00002a37-0000-1000-8000-00805f9b34fb",Oe=[Ne,He,"battery_service"],U=(i=>(i[i.ECG=0]="ECG",i[i.PPG=1]="PPG",i[i.ACC=2]="ACC",i[i.PPI=3]="PPI",i[i.GYRO=5]="GYRO",i[i.MAGNETOMETER=6]="MAGNETOMETER",i[i.SDK_MODE=9]="SDK_MODE",i[i.LOCATION=10]="LOCATION",i[i.PRESSURE=11]="PRESSURE",i[i.TEMPERATURE=12]="TEMPERATURE",i))(U||{}),bn=Object.keys(re).filter(i=>isNaN(Number(i))),Vt=Object.keys(U).filter(i=>isNaN(Number(i))),In=Object.keys(ae).filter(i=>isNaN(Number(i))),Be=class{device;server=void 0;PMDService=void 0;PMDCtrlChar=void 0;PMDDataChar=void 0;BattService=void 0;BattLvlChar=void 0;HeartRateService=void 0;HeartRateChar=void 0;streaming=!1;verbose=!0;dataHandleDict={};heartRateHandleList=[];battLevelHandleList=[];timeOffset=BigInt(0);eventTimeOffset;lastECGTimestamp;lastACCTimestamp;ACCStarted=!1;ECGStarted=!1;battLvl;constructor(i,e=!0){this.device=i,this.verbose=e,this.lastECGTimestamp=0,this.lastACCTimestamp=0,this.ACCStarted=!1,this.ECGStarted=!1;for(let t=0;t<Vt.length;t++)this.dataHandleDict[Vt[t]]=[]}addEventListener(i,e){this.dataHandleDict[i].includes(e)||this.dataHandleDict[i].push(e)}addHeartRateEventListener(i){this.heartRateHandleList.includes(i)||this.heartRateHandleList.push(i)}addBatteryLevelEventListener(i){this.battLevelHandleList.includes(i)||this.battLevelHandleList.push(i)}removeEventListener(i,e){let t=this.dataHandleDict[i].indexOf(e);return t>-1&&this.dataHandleDict[i].splice(t,1),t}removeHeartRateEventListener(i){let e=this.heartRateHandleList.indexOf(i);return e>-1&&this.heartRateHandleList.splice(e,1),e}clearEventListner(i){delete this.dataHandleDict[i],this.dataHandleDict[i]=[]}log(...i){this.verbose&&console.log(...i)}async init(){this.server=await this.device.gatt?.connect(),this.log(`Connecting to ${this.device.name} GATT server...`),this.PMDService=await this.server?.getPrimaryService(Ne),this.log("  Got PMD Service"),this.PMDCtrlChar=await this.PMDService?.getCharacteristic(ji),this.log("    Got PMD control characteristic"),await this.PMDCtrlChar?.startNotifications(),this.log("    Start notification"),this.PMDDataChar=await this.PMDService?.getCharacteristic(Ki),this.log("    Got PMD data characteristic"),await this.PMDDataChar?.startNotifications(),this.log("    Start notification"),this.streaming=!1,this.BattService=await this.server?.getPrimaryService("battery_service"),this.log("  Got battery Service"),this.BattLvlChar=await this.BattService?.getCharacteristic("battery_level"),this.log("    Got battery level characteristic"),await this.BattLvlChar?.startNotifications(),this.log("    Start notification"),this.HeartRateService=await this.server?.getPrimaryService(He),this.log("  Got heart rate Service"),this.HeartRateChar=await this.HeartRateService?.getCharacteristic(Ji),await this.HeartRateChar?.startNotifications(),this.log("    Start notification"),this.PMDDataChar?.addEventListener("characteristicvaluechanged",this.PMDDataHandle.bind(this)),this.HeartRateChar?.addEventListener("characteristicvaluechanged",this.HearRateHandle.bind(this)),this.BattLvlChar?.addEventListener("characteristicvaluechanged",this.BatteryLevelHandle.bind(this))}PMDCtrlCharHandle(i){this.log(i)}PMDCtrlDataHandle(i){this.log(i)}async getBatteryLevel(){let i=await this.BattLvlChar?.readValue();return i?i.getUint8(0):0}async getPMDFeatures(){let i=await this.PMDCtrlChar?.readValue(),e=[];if(i!==void 0&&i.byteLength===17&&i.getUint8(0)===15){let t=i.getUint8(1);for(let l=0;l<Vt.length;l++){let s=Vt[l];t>>U[s]&1&&e.push(s)}}return e}async getSensorSettingsFromName(i){return this.getSensorSettingsFromId(U[i])}parseSensorSettings(i){if(i.getUint8(0)==240&&i.getUint8(1)==1){let e={type:U[i.getUint8(2)],error:ft[i.getUint8(3)],more_frames:i.getUint8(4),settings:{}},t=5;for(;t<i.byteLength;){let l=i.getUint8(t);t+=1;let s=i.getUint8(t);t+=1;let r=re[l];e.settings[r]=[];for(let c=0;c<s;c++)e.settings[r].push(Zi[r](i,t)),t+=Qi[r]}return e}}async getSensorSettingsFromId(i){if(!this.streaming){let e,t=new Promise((r,c)=>{e=r}),l=r=>{let c=r?.target?.value;e(this.parseSensorSettings(c))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",l,{once:!0});let s=new Uint8Array([1,i]);return await this.PMDCtrlChar?.writeValue(s),await t}}HearRateHandle(i){if(this.heartRateHandleList.length>0){let e=i.target.value,t={heart_rate_bpm:-1,rr_intervals_ms:[],recv_epoch_time_ms:i.timeStamp+performance.timeOrigin},l=e.getUint8(0),s=1;if((l&1)===1?(t.heart_rate_bpm=e.getUint16(s,!0),s+=2):(t.heart_rate_bpm=e.getUint8(s),s+=1),(l&16)!==0)for(;s<e.byteLength;){let n=e.getUint16(s,!0)/1024*1e3;t.rr_intervals_ms.push(n),s+=2}for(let o of this.heartRateHandleList)o(t)}}BatteryLevelHandle(i){if(this.battLvl=i.target.value.getUint8(),this.battLevelHandleList.length>0)for(let e of this.battLevelHandleList)e(this.battLvl)}PMDDataHandle(i){let e=i.target.value,t=e.getBigUint64(1,!0);this.timeOffset===BigInt(0)&&(this.timeOffset=t,this.eventTimeOffset=i.timeStamp+performance.timeOrigin);let l=Number(t-this.timeOffset)/1e6,s=e.getUint8(0),r=e.getUint8(9),c={type:U[s],sample_timestamp_ms:l,prev_sample_timestamp_ms:0,recv_epoch_time_ms:i.timeStamp+performance.timeOrigin,event_time_offset_ms:this.eventTimeOffset},o=0,n=1;switch(s){case 2:r==1&&(c.samples=new Int16Array(e.buffer.slice(10)),c.prev_sample_timestamp_ms=this.lastACCTimestamp,this.lastACCTimestamp=l,n=3);break;case 0:if(r===0){let a=Math.floor((e.byteLength-10)/3);c.samples=new Int32Array(a);for(let d=10;d<e.byteLength;d+=3){let f=e.getUint8(d+2)<<16|e.getUint8(d+1)<<8|e.getUint8(d);f&8388608&&(f|=4278190080),c.samples[Math.floor((d-10)/3)]=f}c.prev_sample_timestamp_ms=this.lastECGTimestamp,this.lastECGTimestamp=l,n=1}break}if(c.samples!==void 0&&this.dataHandleDict[U[s]].length>0&&(o=(c.sample_timestamp_ms-c.prev_sample_timestamp_ms)/(c.samples.length/n),o>0)){let a=c.event_time_offset_ms+c.prev_sample_timestamp_ms,d=Math.floor(c.samples.length/n);c.epoch_timestamps_ms=new Float64Array(d);for(let f=0;f<d;f++)a+=o,c.epoch_timestamps_ms[f]=a;for(let f of this.dataHandleDict[U[s]])f(c)}}parseCtrlReply(i){if(i.getUint8(0)===240){let e=i.getUint8(1);if(e===2||e===3){let t={type:ae[e],sensor:U[i.getUint8(2)],error:ft[i.getUint8(3)],more_frames:i.getUint8(4)};return i.byteLength>5&&(t.reserved=i.getUint8(5)),t}}}async startHeartRate(){await this.HeartRateChar?.startNotifications()}async stopheartRate(){await this.HeartRateChar?.stopNotifications()}async startACC(i=4,e=100,t=16){if(this.ACCStarted)return;let l,s=new Promise((a,d)=>{l=a}),r=a=>{this.log("PMDSensorSettingHandle");let d=a?.target?.value;l(this.parseCtrlReply(d))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",r,{once:!0});let c=new Uint8Array(14),o=new DataView(c.buffer);c[0]=2,c[1]=2,c[2]=2,c[3]=1,o.setUint16(4,i,!0),c[6]=0,c[7]=1,o.setUint16(8,e,!0),c[10]=1,c[11]=1,o.setUint16(12,t,!0),await this.PMDCtrlChar?.writeValue(c);let n=await s;return n?.error===ft[0]&&(this.ACCStarted=!0),n}async startECG(i=130,e=14){if(this.ECGStarted)return;let t,l=new Promise((n,a)=>{t=n}),s=n=>{this.log("PMDSensorSettingHandle");let a=n?.target?.value;t(this.parseCtrlReply(a))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",s,{once:!0});let r=new Uint8Array(10),c=new DataView(r.buffer);r[0]=2,r[1]=0,r[2]=1,r[3]=1,c.setUint16(4,e,!0),r[6]=0,r[7]=1,c.setUint16(8,i,!0),await this.PMDCtrlChar?.writeValue(r);let o=await l;return o?.error===ft[0]&&(this.ECGStarted=!0),o}async stopECG(){if(!this.ECGStarted)return;let i=await this.stopSensor(0);return i?.error===ft[0]&&(this.ECGStarted=!1),i}async stopACC(){if(!this.ACCStarted)return;let i=await this.stopSensor(2);return i?.error===ft[0]&&(this.ACCStarted=!1),i}async stopSensor(i){let e,t=new Promise((r,c)=>{e=r}),l=r=>{let c=r?.target?.value;e(this.parseCtrlReply(c))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",l,{once:!0});let s=new Uint8Array(2);return s[0]=3,s[1]=i,await this.PMDCtrlChar?.writeValue(s),await t}};var oe=["","LShoulder","RShoulder","Chest","Heart","MiddleSpine","LowerSpine","Hip","LThigh","RThigh"],tn=new Date("2000-01-01T00:00:00Z"),en=new Date("2018-01-01T00:00:00Z"),nn=tn.valueOf(),sn=BigInt(nn)*BigInt(1e6),rn=en.valueOf(),an=BigInt(rn)*BigInt(1e6),ke=an-sn,on=ke/BigInt(1e6),Ve=Number(ke-on*BigInt(1e6))/1e6,Ln=Ve+Number(Ve);var At=5,le=35,ze=600,Xe=-120,ce=120,Ue=0,he=120,kt=25,rt=1,at=20,We=4,pt=130,Ye=5,$e=5,de=1,zt=20,Xt=800,qe=10,Ut=200,Ze=Math.round(pt/(1e3/Ut)),W=.7,ot=40,Z=.1,k=.1,et=100,lt=.1,Qe=600,Wt=[2,4,8],_t=[25,50,100,200],ue=100,fe=4,pe=-2e3,Yt=2e3,je=10,Ke=4;var _e=10,Je=100,Q=2.5,it=.1;var ti=4,ei=-1e3,Ce=1e3,me=1,ii=1,bt=8,It=0,Tt=800,ni=1,wt=1,Lt=30,si=.1,Ft=0,Mt=800,ri=1,Rt=1,xt=30,ai=.1,ge={limitFPS:60,grid:{strokeStyle:"#484f58",fillStyle:"#000000",lineWidth:1,millisPerLine:1e3,borderVisible:!1},title:{text:"EXG raw voltage (0.7\u201340 Hz)",fontFamily:"Arial",verticalAlign:"bottom",fillStyle:"#ffffff80",fontSize:14},responsive:!1,nonRealtimeData:!0,millisPerPixel:bt,scaleSmoothing:.1,tooltip:!1,minValueScale:1,maxValueScale:1},ve={limitFPS:60,minValue:pe,maxValue:Yt,grid:{strokeStyle:"#484f58",fillStyle:"#000000",lineWidth:1,millisPerLine:1e3,borderVisible:!1},title:{text:"Accelerometer raw",fontFamily:"Arial",verticalAlign:"bottom",fillStyle:"#ffffff80",fontSize:14},labels:{disabled:!1},responsive:!1,nonRealtimeData:!0,millisPerPixel:bt,scaleSmoothing:.1,tooltip:!1,minValueScale:1,maxValueScale:1},oi={lineWidth:2,interpolation:"linear",strokeStyle:"#fbfbfbcc"},li={lineWidth:2,interpolation:"linear",strokeStyle:"#ffdcaacc"},ci={lineWidth:2,interpolation:"linear",strokeStyle:"#dcaaffcc",fillStyle:"#f0beff99"},hi={lineWidth:2,interpolation:"linear",strokeStyle:"#ff453acc"},di={lineWidth:2,interpolation:"linear",strokeStyle:"#32ff4bcc"},ui={lineWidth:2,interpolation:"linear",strokeStyle:"#0a84ffcc"},fi={lineWidth:2,interpolation:"linear",strokeStyle:"#ff776ccc"},pi={lineWidth:2,interpolation:"linear",strokeStyle:"#64ff7dcc"},_i={lineWidth:2,interpolation:"linear",strokeStyle:"#3cb6ffcc"},Ci={lineWidth:2,interpolation:"linear",strokeStyle:"#6effffcc"},mi={lineWidth:2,interpolation:"linear",strokeStyle:"#ff70ffcc"},gi={lineWidth:2,interpolation:"linear",strokeStyle:"#ffff78cc"},vi={lineWidth:2,interpolation:"linear",strokeStyle:"#fbfbfbcc"},Si={lineWidth:2,interpolation:"linear",strokeStyle:"#ffdcaacc"},Ei={lineWidth:2,interpolation:"linear",strokeStyle:"#f0883e"},Ai={lineWidth:2,interpolation:"linear",strokeStyle:"#f778ba"},bi={lineWidth:2,interpolation:"linear",strokeStyle:"#388afd"},Ii={lineWidth:2,interpolation:"linear",strokeStyle:"#aadcffcc"},Ti=(d=>(d[d.ECG=0]="ECG",d[d.PPG=1]="PPG",d[d.ACC=2]="ACC",d[d.PPI=3]="PPI",d[d.GYRO=5]="GYRO",d[d.MAGNETOMETER=6]="MAGNETOMETER",d[d.SDK_MODE=9]="SDK_MODE",d[d.LOCATION=10]="LOCATION",d[d.PRESSURE=11]="PRESSURE",d[d.TEMPERATURE=12]="TEMPERATURE",d))(Ti||{}),Fn=Object.keys(Ti).filter(i=>isNaN(Number(i))),ct=["lowpass","highpass","bandpass"],j=["butterworth","bessel"];var $t=new O.CalcCascades;async function xi(i,e){await new y(i,e).init()}function Di(){y.is_recording=!0,y.recorded={};let i={};for(let e=0;e<y.polarVisRows.length;e++){let t=y.polarVisRows[e],l=t.getPolarName();l in i||(y.createNewRecordEntry(t),i[l]=t.polarH10,t.polarH10.addEventListener("ECG",t.recordECGData),t.polarH10.addEventListener("ACC",t.recordACCData))}}function yi(){y.is_recording=!1;for(let i=0;i<y.polarVisRows.length;i++){let e=y.polarVisRows[i],t=e.polarH10;t.removeEventListener("ECG",e.recordECGData),t.removeEventListener("ACC",e.recordACCData)}dn(`Polar-h10_recording_${ln()}`,JSON.stringify(y.recorded,null,2)),y.recorded={},Zt()}function ln(){let i=new Date,e=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),l=String(i.getDate()).padStart(2,"0"),s=String(i.getHours()).padStart(2,"0"),r=String(i.getMinutes()).padStart(2,"0"),c=String(i.getSeconds()).padStart(2,"0");return`${e}-${t}-${l}_${s}-${r}-${c}`}function Zt(){if(!y.is_recording){let i=document.getElementById("record_btn");console.log("updateRecordBtn"),console.log(i),i!=null&&(y.hasAnyActiveStream()?i.disabled=!1:i.disabled=!0)}}function Se(){let i=document.getElementById("ble_disconnect_btn");console.log("updateDisconnectBtn"),console.log(i),i!=null&&(y.hasAnyActiveStream()?i.disabled=!1:i.disabled=!0)}var y=class i{static polarRowID=0;static polarVisRows=[];static recorded={};static is_recording=!1;device;polarH10;deviceName;parent;polarSensorDiv;optionDiv;deviceInfoDiv;nameDiv;loadingDiv;disconnectDiv;deviceNameDiv;battLvlDiv;dataInfo;bodypartLabel;bodypartSelectDiv;bodypartSelect;dataCtrl;extraDataCtrl;rowOrder;visContainerDiv;visConfigDiv;ECGConfigDiv;ECGChartConfigDiv;ECGFilterConfigDiv;ECGRMSConfigDiv;customBodyPartInput;ACCConfigDiv;ACCChartConfigDiv;ACCLPConfigDiv;ACCFilterConfigDiv;ECGCtrlDiv;ACCCtrlDiv;order;ECG_FILTER_MIN=Xe;ECG_FILTER_MAX=ce;ECG_RMS_MIN=Ue;ECG_RMS_MAX=he;ACC_MIN=pe;ACC_MAX=Yt;ACC_FILTER_MIN=ei;ACC_FILTER_MAX=Ce;disBtn;orderUpBtn;orderDownBtn;show3DBtn;filterConfigBtn;ECGFormSelect;ECGSwitchInput;ECGDropDown;ACCFormSelect;ACCSwitchInput;ACCDropDown;ECGDiv=void 0;ACCDiv=void 0;ECGStreamDelayInput=void 0;ECGstreamMPPInput=void 0;ECGRMSWinInput=void 0;ACCStreamDelayInput=void 0;ACCstreamMPPInput=void 0;ecg_resize=void 0;ecg_chart=void 0;ecg_resize_observer=void 0;ecg_canvas=void 0;ecg_filter_iir_coef=void 0;ecg_ts=void 0;ecg_filter_info;ecg_filter_iir=void 0;ecg_filter_ts=void 0;ecg_rms_ts=void 0;ecg_mss_win=void 0;ecg_mss_win_i=0;ecg_buf_head=0;ecg_mss=0;acc_resize=void 0;acc_chart=void 0;acc_resize_observer=void 0;acc_canvas=void 0;acc_x_ts=void 0;acc_y_ts=void 0;acc_z_ts=void 0;acc_mag_ts=void 0;acc_lp_info;acc_lp_iir_coef=void 0;acc_x_lp_iir=void 0;acc_y_lp_iir=void 0;acc_z_lp_iir=void 0;acc_mag_lp_iir=void 0;acc_x_lp_ts=void 0;acc_y_lp_ts=void 0;acc_z_lp_ts=void 0;acc_mag_lp_ts=void 0;acc_rho_ts=void 0;acc_phi_ts=void 0;acc_theta_ts=void 0;acc_filter_info;acc_filter_iir_coef=void 0;acc_x_filter_iir=void 0;acc_y_filter_iir=void 0;acc_z_filter_iir=void 0;acc_mag_filter_iir=void 0;acc_x_filter_ts=void 0;acc_y_filter_ts=void 0;acc_z_filter_ts=void 0;acc_mag_filter_ts=void 0;ecg_rms_window_ms=Ut;ecg_rms_window_size=Ze;ecg_stream_delay=ze;acc_stream_delay=Qe;ecg_millis_per_px=bt;acc_millis_per_px=bt;showVisConfig=!1;customBodyPart="";customBodyPartSpan=void 0;acc_range_options=void 0;acc_sample_rate_options=void 0;acc_range_g=fe;acc_sample_rate_hz=ue;ACCSampleRateSelect=void 0;ACCRangeSelect=void 0;ECGFilterTypesSelect=void 0;ECGFilteCharSelect=void 0;ECGFilterOrderInput=void 0;ECGFilterCutoffInput=void 0;ECGFilterHighCutInput=void 0;ECGFilterLowCutInput=void 0;ACCFilterTypesSelect=void 0;ACCFilterCharSelect=void 0;ACCFilterOrderInput=void 0;ACCFilterCutoffInput=void 0;ACCFilterHighCutInput=void 0;ACCFilterLowCutInput=void 0;ACCLPCharSelect=void 0;ACCLPOrderInput=void 0;ACCLPCutoffInput=void 0;heartbeat_bpm_info=void 0;heart_rate_var_rms_info=void 0;rr_ss=0;rr_sum=0;rr_s_list=[];rr_list=[];hrv_win_ms=3e4;constructor(e,t){if(t.name===void 0)throw new Error("Invalid Bluetooth device! Missing name");this.parent=e,this.device=t,this.deviceName=this.device?.name?.substring(10)||"",this.ecg_rms_window_ms=Ut,this.updateECGRMSWinSize(),this.initFilterSettings(),this.showVisConfig=!1}static createNewRecordEntry(e){let t=e.getPolarName();t in i.recorded||(i.recorded[t]={ECG:{data:[],timestamp:[]},ACC:{data_x:[],data_y:[],data_z:[],timestamp:[]}})}static stopAllPolarStream(){let e=[];for(let t=0;t<i.polarVisRows.length;t++){let l=i.polarVisRows[t];l.ECGDiv!==void 0&&e.push(i.polarVisRows[t].stopECG()),l.ACCDiv!==void 0&&e.push(i.polarVisRows[t].stopAcc())}return Promise.all(e)}static disconnectAllPolarH10(){let e=[];for(let t=0;t<i.polarVisRows.length;t++){let l=i.polarVisRows[t];e.push(l.disconnectPolarH10())}return Promise.all(e)}static hasAnyActiveStream(){let e=!1;for(let t=0;t<i.polarVisRows.length;t++){let l=i.polarVisRows[t];if(l.ECGDiv!==void 0){e=!0;break}if(l.ACCDiv!==void 0){e=!0;break}}return e}getPolarName(){let e;return this.customBodyPart!==void 0&&this.customBodyPart.length>0?e=this.customBodyPart:e=oe[this.bodypartSelect.selectedIndex],e.length>0?`${this.deviceName}-${e}`:this.deviceName}updateECGRMSWinSize(){this.ecg_rms_window_size=Math.round(pt/(1e3/this.ecg_rms_window_ms))}updateECGRMSWin(){this.ecg_mss_win_i=0,this.ecg_buf_head=0,this.ecg_mss=0,this.ecg_mss_win=new Float64Array(this.ecg_rms_window_ms)}initECGFilterSettings(){this.ecg_filter_info={type:"highpass",order:We,characteristic:"butterworth",Fs:pt,Fc:kt,Fl:rt,Fh:at,BW:at-rt,gain:void 0,preGain:!1}}initACCLowpassFilterSettings(){this.acc_lp_info={type:"lowpass",order:Ke,characteristic:"butterworth",Fs:this.acc_sample_rate_hz,Fc:je,Fl:1,Fh:10,BW:void 0,gain:void 0,preGain:!1}}initACCFilterSettings(){this.acc_filter_info={type:"bandpass",order:ti,characteristic:"butterworth",Fs:this.acc_sample_rate_hz,Fc:Math.sqrt(it*Q),Fl:it,Fh:Q,BW:Q-it,gain:void 0,preGain:!1}}initFilterSettings(){this.initECGFilterSettings(),this.initACCLowpassFilterSettings(),this.initACCFilterSettings()}updateBandpass(e){e.Fh!==void 0&&e.Fl!=null&&(e.BW=e.Fh-e.Fl,e.Fc=Math.sqrt(e.Fh*e.Fl))}recordECGData=e=>{if(e.samples!==void 0){let t=this.getPolarName();for(let l=0;l<e.samples.length;l++){let s=e.samples[l];if(i.recorded[t].ECG.data.push(s),e.epoch_timestamps_ms!==void 0){let r=e.epoch_timestamps_ms[l];i.recorded[t].ECG.timestamp.push(r)}}}};recordACCData=e=>{if(e.samples!==void 0){let t=this.getPolarName();for(let l=0;l<e.samples.length;l+=3){let s=Math.floor(l/3),r=-e.samples[l],c=-e.samples[l+1],o=e.samples[l+2];if(i.recorded[t].ACC.data_x.push(c),i.recorded[t].ACC.data_y.push(r),i.recorded[t].ACC.data_z.push(o),e.epoch_timestamps_ms!==void 0){let n=e.epoch_timestamps_ms[s];i.recorded[t].ACC.timestamp.push(n)}}}};disconnectPolarH10=async(e=void 0)=>{this.removeSelf(),this.ecg_chart!==void 0&&this.ecg_chart.stop(),this.ecg_resize_observer!==void 0&&this.ecg_resize_observer.disconnect(),this.ECGDiv!==void 0&&(this.visContainerDiv?.removeChild(this.ECGDiv),this.polarH10.removeEventListener("ECG",this.newECGCallback),await this.stopECG()),this.resetECG(),this.acc_chart!==void 0&&this.acc_chart.stop(),this.acc_resize_observer!==void 0&&this.acc_resize_observer.disconnect(),this.ACCDiv!==void 0&&(this.visContainerDiv?.removeChild(this.ACCDiv),this.polarH10.removeEventListener("ACC",this.newACCCallback),await this.stopAcc()),this.resetACC(),this.disconnectPolarH10IfAlone()};async init(){try{await this.initPolarH10(),await this.initDeviceInfo(),await this.initDeviceGraphCtrl(),i.polarRowID+=1,i.polarVisRows.push(this);let e=this.includesDuplicate("device");if(e>-1){console.log(`duplicateInd: ${e}`);let t=i.polarVisRows[e],l=t.customBodyPart;l?this.onCustomBodyPart({target:{value:l}}):this.onBodypartSelect({target:{selectedIndex:t.bodypartSelect.selectedIndex}})}this.polarH10.addBatteryLevelEventListener(this.updateBatteryInfo)}catch(e){this.disconnectPolarH10(),alert(e)}}moveUp=e=>{this.order-=1,this.polarSensorDiv.style.order=this.order.toString();let t=i.polarVisRows[this.order];t.order+=1,t.polarSensorDiv.style.order=t.order.toString(),i.polarVisRows[this.order]=this,i.polarVisRows[t.order]=t,this.order===0?(this.orderUpBtn.disabled=!0,this.orderDownBtn.disabled=!1,t.orderUpBtn.disabled=!1):this.order===i.polarVisRows.length-2&&(this.orderDownBtn.disabled=!1),t.order===i.polarVisRows.length-1&&(t.orderDownBtn.disabled=!0,t.orderUpBtn.disabled=!1)};moveDown=e=>{this.order+=1,this.polarSensorDiv.style.order=this.order.toString();let t=i.polarVisRows[this.order];t.order-=1,t.polarSensorDiv.style.order=t.order.toString(),i.polarVisRows[this.order]=this,i.polarVisRows[t.order]=t,this.order===i.polarVisRows.length-1?(this.orderUpBtn.disabled=!1,this.orderDownBtn.disabled=!0,t.orderDownBtn.disabled=!1):this.order===1&&(this.orderUpBtn.disabled=!1),t.order===0&&(t.orderDownBtn.disabled=!1,t.orderUpBtn.disabled=!0)};toggleVisConfig=e=>{this.showVisConfig=!this.showVisConfig,this.showVisConfig?(this.visContainerDiv.classList.add("hide"),this.visConfigDiv.classList.remove("hide"),this.filterConfigBtn.classList.add("btn-success")):(this.visContainerDiv.classList.remove("hide"),this.visConfigDiv.classList.add("hide"),this.filterConfigBtn.classList.remove("btn-success"))};newECGCallback=e=>{if(this.ecg_ts!==void 0&&this.ecg_rms_ts!==void 0&&this.ecg_filter_ts!==void 0&&e.prev_sample_timestamp_ms>0&&e.samples!==void 0&&this.ecg_filter_iir!==void 0){if(e.epoch_timestamps_ms===void 0)return;for(let t=0;t<e.samples.length;t++){let l=e.epoch_timestamps_ms[t],s=l-e.event_time_offset_ms-e.prev_sample_timestamp_ms,r=e.samples[t],c=this.ecg_filter_iir.singleStep(r),o=c/this.ecg_rms_window_size*c,n;this.ecg_mss_win!==void 0&&(this.ecg_mss+=o,this.ecg_mss_win_i<this.ecg_rms_window_size?(this.ecg_mss_win[this.ecg_mss_win_i]=o,this.ecg_mss_win_i++):(this.ecg_mss-=this.ecg_mss_win[this.ecg_buf_head],this.ecg_mss_win[this.ecg_buf_head]=o,this.ecg_buf_head=(this.ecg_buf_head+1)%this.ecg_rms_window_size),this.ecg_mss_win_i===this.ecg_rms_window_size&&(n=Math.sqrt(this.ecg_mss))),setTimeout(()=>{this.ecg_ts?.append(l,r),this.ecg_filter_ts?.append(l,c),n!==void 0&&this.ecg_rms_ts?.append(l,n)},s)}}};newACCCallback=e=>{if(e.prev_sample_timestamp_ms>0&&e.samples!==void 0&&this.acc_x_ts!==void 0&&this.acc_y_ts!==void 0&&this.acc_z_ts!==void 0&&this.acc_mag_ts!==void 0&&this.acc_x_lp_ts!==void 0&&this.acc_y_lp_ts!==void 0&&this.acc_z_lp_ts!==void 0&&this.acc_mag_lp_ts!==void 0&&this.acc_rho_ts!==void 0&&this.acc_phi_ts!==void 0&&this.acc_theta_ts!==void 0&&this.acc_x_filter_ts!==void 0&&this.acc_y_filter_ts!==void 0&&this.acc_z_filter_ts!==void 0&&this.acc_mag_filter_ts!==void 0&&this.acc_x_lp_iir!==void 0&&this.acc_y_lp_iir!==void 0&&this.acc_z_lp_iir!==void 0&&this.acc_mag_lp_iir!==void 0&&this.acc_x_filter_iir!==void 0&&this.acc_y_filter_iir!==void 0&&this.acc_z_filter_iir!==void 0&&this.acc_mag_filter_iir!==void 0){if(e.epoch_timestamps_ms===void 0)return;for(let t=0;t<e.samples.length;t+=3){let l=Math.floor(t/3),s=e.epoch_timestamps_ms[l],r=s-e.event_time_offset_ms-e.prev_sample_timestamp_ms,c=-e.samples[t],o=-e.samples[t+1],n=e.samples[t+2],a=this.acc_x_lp_iir.singleStep(o),d=this.acc_y_lp_iir.singleStep(c),f=this.acc_z_lp_iir.singleStep(n),u=a*a,g=d*d,S=f*f,p=Math.atan(a/Math.sqrt(g+S))/Math.PI*180,T=Math.atan(d/Math.sqrt(u+S))/Math.PI*180,L=Math.atan(Math.sqrt(u+g)/f)/Math.PI*180,b=Math.sqrt(o*o+c*c+n*n),E=this.acc_mag_lp_iir.singleStep(b),F=this.acc_x_filter_iir.singleStep(o),_=this.acc_y_filter_iir.singleStep(c),C=this.acc_z_filter_iir.singleStep(n),h=this.acc_mag_filter_iir.singleStep(b);setTimeout(()=>{this.acc_x_ts?.append(s,o),this.acc_y_ts?.append(s,c),this.acc_z_ts?.append(s,n),this.acc_mag_ts?.append(s,b),this.acc_rho_ts?.append(s,p),this.acc_phi_ts?.append(s,T),this.acc_theta_ts?.append(s,L),this.acc_x_lp_ts?.append(s,a),this.acc_y_lp_ts?.append(s,d),this.acc_z_lp_ts?.append(s,f),this.acc_mag_lp_ts?.append(s,E),this.acc_x_filter_ts?.append(s,F),this.acc_y_filter_ts?.append(s,_),this.acc_z_filter_ts?.append(s,C),this.acc_mag_filter_ts?.append(s,h)},r)}}};addHeartInfo=()=>{this.bodypartSelect.selectedIndex===4&&this.heartbeat_bpm_info!==void 0&&this.heart_rate_var_rms_info!==void 0&&this.ecg_chart!==void 0&&(this.ecg_chart.addSmoothieTSInfo(this.heartbeat_bpm_info),this.ecg_chart.addSmoothieTSInfo(this.heart_rate_var_rms_info))};removeheartInfo=()=>{this.bodypartSelect.selectedIndex!==4&&this.heartbeat_bpm_info!==void 0&&this.heart_rate_var_rms_info!==void 0&&(this.ecg_chart!==void 0&&(this.ecg_chart.removeLegendTSInfo(this.heartbeat_bpm_info),this.ecg_chart.removeLegendTSInfo(this.heart_rate_var_rms_info)),this.heartbeat_bpm_info=void 0,this.heart_rate_var_rms_info=void 0)};changeECGGraph=e=>{if(this.ecg_chart!==void 0&&this.ecg_ts!==void 0&&this.ecg_filter_ts!==void 0&&this.ecg_rms_ts!==void 0){let t=e.target.selectedIndex;switch(this.ecg_chart.stop(),t){case 0:this.ecg_chart.configureTimeSeries([this.ecg_ts],[oi],[P("\u2015 Voltage (\u03BCV)",10,0)],!1,void 0,void 0,1,1,ge.title?.text||"EXG raw voltage (0.7\u201340 Hz)",!1,[],!0,!1,!0);break;case 1:this.ecg_chart.configureTimeSeries([this.ecg_filter_ts],[li],[P("\u2015 Voltage (\u03BCV)",10,0)],!0,this.ECG_FILTER_MIN,this.ECG_FILTER_MAX,1,1,`${qt(this.ecg_filter_info)} on EXG raw`,!1,[],!0,!0,!0);break;case 2:this.ecg_chart.configureTimeSeries([this.ecg_rms_ts],[ci],[P("\u2015 RMS voltage (\u03BCV)",10,0)],!0,this.ECG_RMS_MIN,this.ECG_RMS_MAX,1,1,`RMS using ${this.ecg_rms_window_ms}ms window on ${qt(this.ecg_filter_info,!1)} EXG`,!1,[],!0,!0,!0);break}this.addHeartInfo(),this.ecg_chart.start()}};changeACCGraph=e=>{if(this.acc_chart!==void 0&&this.acc_x_ts!==void 0&&this.acc_y_ts!==void 0&&this.acc_z_ts!==void 0&&this.acc_x_lp_ts!==void 0&&this.acc_y_lp_ts!==void 0&&this.acc_z_lp_ts!==void 0&&this.acc_mag_lp_ts!==void 0&&this.acc_rho_ts!==void 0&&this.acc_phi_ts!==void 0&&this.acc_theta_ts!==void 0&&this.acc_mag_ts!==void 0&&this.acc_x_filter_ts!==void 0&&this.acc_y_filter_ts!==void 0&&this.acc_z_filter_ts!==void 0&&this.acc_mag_filter_ts!==void 0){let t=e.target.selectedIndex,l="";switch(this.acc_chart.stop(),t){case 0:this.acc_chart.configureTimeSeries([this.acc_x_ts,this.acc_y_ts,this.acc_z_ts,this.acc_mag_ts],[hi,di,ui,vi],[P("\u2015 X-axis (mG)",10,0),P("\u2015 Y-axis (mG)",10,0),P("\u2015 Z-axis (mG)",10,0),P("\u2015 ACC magnitude (mG)",10,0)],!0,this.ACC_MIN,this.ACC_MAX,1,1,ve.title?.text||"Accelerometer raw",!1,[],!0,!0,!0);break;case 1:this.acc_chart.configureTimeSeries([this.acc_x_lp_ts,this.acc_y_lp_ts,this.acc_z_lp_ts,this.acc_mag_lp_ts],[fi,pi,_i,Si],[P("\u2015 X-axis (mG)",10,0),P("\u2015 Y-axis (mG)",10,0),P("\u2015 Z-axis (mG)",10,0),P("\u2015 ACC magnitude (mG)",10,0)],!0,this.ACC_MIN,this.ACC_MAX,1,1,`${qt(this.acc_lp_info)} on accelerometer raw`,!1,[],!0,!0,!0);break;case 2:this.acc_chart.configureTimeSeries([this.acc_rho_ts,this.acc_phi_ts,this.acc_theta_ts],[Ci,mi,gi],[P("\u2015 \u03C1\xB0 \u2220(X-axis, Horizon)",10,0),P("\u2015 \u03D5\xB0 \u2220(Y-axis, Horizon)",10,0),P("\u2015 \u03B8\xB0 \u2220(Z-axis, -Gravity)",10,0)],!1,-120,120,1.3,1.3,"Tilt angle [-90\xB0, 90\xB0] from lowpass on accelerometer raw",!1,[{value:90,color:"#ffffff7f",lineWidth:1},{value:-90,color:"#ffffff7f",lineWidth:1}],!0,!0,!0);break;case 3:this.acc_chart.configureTimeSeries([this.acc_x_filter_ts,this.acc_y_filter_ts,this.acc_z_filter_ts,this.acc_mag_filter_ts],[Ei,Ai,bi,Ii],[P("\u2015 X-axis (mG)",10,0),P("\u2015 Y-axis (mG)",10,0),P("\u2015 Z-axis (mG)",10,0),P("\u2015 ACC magnitude (mG)",10,0)],!0,this.ACC_FILTER_MIN,this.ACC_FILTER_MAX,1,1,`${qt(this.acc_filter_info)} on accelerometer`,!1,[],!0,!0,!0);break}this.acc_chart.start()}};onWheelECG=e=>{if(this.ecg_chart!==void 0&&!this.ecg_chart.yScaleIsAuto()){let t=e.deltaY<0?de:-de;switch(this.ECGFormSelect?.selectedIndex){case 0:break;case 1:this.ECG_FILTER_MAX!==void 0&&this.ECG_FILTER_MIN!==void 0&&(e.preventDefault(),this.ECG_FILTER_MAX+=t,this.ECG_FILTER_MIN-=t,(this.ECG_FILTER_MAX<Ye||this.ECG_FILTER_MAX<=this.ECG_FILTER_MIN||this.ECG_FILTER_MAX/At>ce)&&(this.ECG_FILTER_MAX-=t,this.ECG_FILTER_MIN+=t),this.ecg_chart.options.minValue=this.ECG_FILTER_MIN,this.ecg_chart.options.maxValue=this.ECG_FILTER_MAX);break;case 2:if(this.ECG_RMS_MAX!==void 0){e.preventDefault(),this.ECG_RMS_MAX+=t,(this.ECG_RMS_MAX<$e||this.ECG_RMS_MAX<=this.ECG_RMS_MIN||this.ECG_RMS_MAX/At>he)&&(this.ECG_RMS_MAX-=t),this.ecg_chart.options.minValue=0,this.ecg_chart.options.maxValue=this.ECG_RMS_MAX;break}}}};onWheelACC=e=>{if(this.acc_chart!==void 0&&!this.acc_chart.yScaleIsAuto()){let t=0;switch(this.ACCFormSelect?.selectedIndex){case 0:case 1:this.ACC_MAX!==void 0&&this.ACC_MIN!==void 0&&(e.preventDefault(),t=e.deltaY<0?_e:-_e,this.ACC_MAX+=t,this.ACC_MIN-=t,(this.ACC_MAX<Je||this.ACC_MAX<=this.ACC_MIN||this.ACC_MAX/At>Yt)&&(this.ACC_MAX-=t,this.ACC_MIN+=t),this.acc_chart.options.minValue=this.ACC_MIN,this.acc_chart.options.maxValue=this.ACC_MAX);break;case 2:break;case 3:this.ACC_FILTER_MAX!==void 0&&this.ACC_FILTER_MIN!==void 0&&(e.preventDefault(),t=e.deltaY<0?me:-me,this.ACC_FILTER_MAX+=t,this.ACC_FILTER_MIN-=t,(this.ACC_FILTER_MAX<ii||this.ACC_FILTER_MAX<=this.ACC_MIN||this.ACC_FILTER_MAX/At>Ce)&&(this.ACC_FILTER_MAX-=t,this.ACC_FILTER_MIN+=t),this.acc_chart.options.minValue=this.ACC_FILTER_MIN,this.acc_chart.options.maxValue=this.ACC_FILTER_MAX);break}}};disableAllOtherSameSwitch(){for(let e=0;e<i.polarVisRows.length;e++){let t=i.polarVisRows[e];t!==this&&t.polarH10===this.polarH10&&(t.ECGSwitchInput.disabled=!0,t.ACCSwitchInput.disabled=!0)}}enableAllOtherSameSwitch(){for(let e=0;e<i.polarVisRows.length;e++){let t=i.polarVisRows[e];t!==this&&t.polarH10===this.polarH10&&(t.ECGSwitchInput.disabled=!1,t.ACCSwitchInput.disabled=!1)}}onToggleECG=async e=>{if(this.ACCSwitchInput.disabled=!0,this.disableAllOtherSameSwitch(),e.target?.checked){this.initECGFilterSettings();let t;this.ACCDiv===void 0?t="full-width":(t="half-width",this.ACCDiv.classList.remove("full-width"),this.ACCDiv.classList.add("half-width"),this.visContainerDiv.removeChild(this.ACCDiv)),this.ECGDiv=I("ECGDiv",this.visContainerDiv,["float-left","almost-full-height",t]),this.ECGDiv.addEventListener("wheel",this.onWheelECG),this.ACCDiv!==void 0&&this.visContainerDiv.appendChild(this.ACCDiv),this.ecg_canvas=Fi("ecg_canvas",this.ECGDiv),this.ecg_chart=new Et(ge),this.ecg_chart.options.millisPerPixel=this.ecg_millis_per_px,this.ecg_ts=new N.TimeSeries,this.ecg_rms_ts=new N.TimeSeries,this.ecg_filter_ts=new N.TimeSeries,this.ecg_chart.streamTo(this.ecg_canvas,this.ecg_stream_delay),this.updateECGRMSWinSize(),this.updateECGRMSWin(),this.ecg_resize=wi(this.ecg_chart,1,1),this.ecg_resize_observer=new ResizeObserver(l=>{for(let s of l)s.target===this.ECGDiv&&this.ecg_resize!==void 0&&this.ecg_resize()}),this.ecg_resize_observer.observe(this.ECGDiv),this.ecgFilterCoefReset(),this.ecg_resize(),this.ECGFormSelect!==void 0&&(this.ECGFormSelect.disabled=!1,this.ECGFormSelect.selectedIndex=0),await this.startECG(pt),this.changeECGGraph({target:{selectedIndex:0}})}else this.ECGDiv!==void 0&&this.ecg_canvas!==void 0&&this.ecg_chart!==void 0&&(this.ecg_chart.stop(),this.ECGFormSelect!==void 0&&(this.ECGFormSelect.disabled=!0,this.ECGFormSelect.selectedIndex=0),this.ECGDiv.contains(this.ecg_canvas)&&(this.ACCDiv?.classList.remove("half-width"),this.ACCDiv?.classList.add("full-width"),await this.stopECG(),this.visContainerDiv.removeChild(this.ECGDiv),this.ecg_resize_observer?.disconnect(),this.polarH10.removeEventListener("ECG",this.newECGCallback),this.resetECG()));this.ACCSwitchInput&&(this.ACCSwitchInput.disabled=!1),this.enableAllOtherSameSwitch(),Se(),Zt()};onToggleACC=async e=>{if(this.disableAllOtherSameSwitch(),this.ECGSwitchInput&&(this.ECGSwitchInput.disabled=!0),e.target?.checked){this.initACCLowpassFilterSettings(),this.initACCFilterSettings();let t;this.ECGDiv===void 0?t="full-width":(t="half-width",this.ECGDiv.classList.remove("full-width"),this.ECGDiv.classList.add("half-width")),this.ACCDiv=I("ACCDiv",this.visContainerDiv,["float-left","almost-full-height",t]),this.ACCDiv.addEventListener("wheel",this.onWheelACC),this.acc_canvas=Fi("acc_canvas",this.ACCDiv),this.acc_chart=new Et(ve),this.acc_chart.options.millisPerPixel=this.acc_millis_per_px,this.acc_x_ts=new N.TimeSeries,this.acc_y_ts=new N.TimeSeries,this.acc_z_ts=new N.TimeSeries,this.acc_mag_ts=new N.TimeSeries,this.acc_x_lp_ts=new N.TimeSeries,this.acc_y_lp_ts=new N.TimeSeries,this.acc_z_lp_ts=new N.TimeSeries,this.acc_mag_lp_ts=new N.TimeSeries,this.acc_rho_ts=new N.TimeSeries,this.acc_phi_ts=new N.TimeSeries,this.acc_theta_ts=new N.TimeSeries,this.acc_x_filter_ts=new N.TimeSeries,this.acc_y_filter_ts=new N.TimeSeries,this.acc_z_filter_ts=new N.TimeSeries,this.acc_mag_filter_ts=new N.TimeSeries,this.acc_chart.streamTo(this.acc_canvas,this.acc_stream_delay),this.acc_resize=wi(this.acc_chart,1,1),this.acc_resize_observer=new ResizeObserver(l=>{for(let s of l)s.target===this.ACCDiv&&this.acc_resize!==void 0&&this.acc_resize()}),this.acc_resize_observer.observe(this.ACCDiv),this.acc_lp_iir_coef=$t[this.acc_lp_info.type](this.acc_lp_info),this.acc_x_lp_iir=(0,O.IirFilter)(this.acc_lp_iir_coef),this.acc_y_lp_iir=(0,O.IirFilter)(this.acc_lp_iir_coef),this.acc_z_lp_iir=(0,O.IirFilter)(this.acc_lp_iir_coef),this.acc_mag_lp_iir=(0,O.IirFilter)(this.acc_lp_iir_coef),this.acc_filter_iir_coef=$t[this.acc_filter_info.type](this.acc_filter_info),this.acc_x_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_y_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_z_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_mag_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_resize(),this.ACCFormSelect!==void 0&&(this.ACCFormSelect.disabled=!1,this.ACCFormSelect.selectedIndex=0),await this.startACC(this.acc_range_g,this.acc_sample_rate_hz),this.changeACCGraph({target:{selectedIndex:0}}),this.show3DBtn.disabled=!1}else this.show3DBtn.disabled=!0,this.ACCDiv!==void 0&&this.acc_canvas!==void 0&&this.acc_chart!==void 0&&(this.acc_chart.stop(),this.ACCFormSelect!==void 0&&(this.ACCFormSelect.disabled=!0,this.ACCFormSelect.selectedIndex=0),this.ACCDiv.contains(this.acc_canvas)&&this.ACCDiv.removeChild(this.acc_canvas),this.ECGDiv?.classList.remove("half-width"),this.ECGDiv?.classList.add("full-width"),this.polarH10.removeEventListener("ACC",this.newACCCallback),this.visContainerDiv.removeChild(this.ACCDiv),this.acc_resize_observer?.disconnect(),await this.stopAcc(),this.resetACC());this.ECGSwitchInput&&(this.ECGSwitchInput.disabled=!1),this.enableAllOtherSameSwitch(),Se(),Zt()};removeSelf(){this.parent.contains(this.polarSensorDiv)&&this.parent.removeChild(this.polarSensorDiv);let e=i.polarVisRows.indexOf(this);e>-1&&(i.polarVisRows.splice(e,1),i.polarVisRows.length>0&&(e===i.polarVisRows.length?i.polarVisRows[e-1].orderDownBtn.disabled=!0:e===0&&(i.polarVisRows[0].orderUpBtn.disabled=!0),i.reOrderRows()))}static reOrderRows(){for(let e=0;e<i.polarVisRows.length;e++){let t=i.polarVisRows[e];t.order=e,t.polarSensorDiv.style.order=e.toString()}}async initPolarH10(){this.polarSensorDiv=I("polarSensorDiv",this.parent,["polar-sensor-row","flexbox"]),this.optionDiv=I("optionDiv",this.polarSensorDiv,["polar-sensor-left-panel","center"]),this.order=i.polarVisRows.length,this.polarSensorDiv.style.order=this.order.toString(),this.nameDiv=I("device-name-batt",this.optionDiv,["center","flexbox"],`Conneting ${this.deviceName}...`),this.loadingDiv=I("ConnectLoading",this.optionDiv,["loading","loading-lg","full-width","flexbox"]),await this.initPolarH10IfUnique()}includesDuplicate(e="device",t=void 0){let l=-1;if(t!==void 0)for(let s=0;s<i.polarVisRows.length;s++){let r=i.polarVisRows[s];if(r!==this&&r[e]===this[e]&&t(r)){l=s;break}}else for(let s=0;s<i.polarVisRows.length;s++){let r=i.polarVisRows[s];if(r!==this&&r[e]===this[e]){l=s;break}}return l}static includesDuplicate(e,t="device",l=void 0){let s=-1;if(l!==void 0)for(let r=0;r<i.polarVisRows.length;r++){let c=i.polarVisRows[r];if(c!==e&&c[t]===e[t]&&l(c)){s=r;break}}else for(let r=0;r<i.polarVisRows.length;r++){let c=i.polarVisRows[r];if(c!==e&&c[t]===e[t]){s=r;break}}return s}disconnectPolarH10IfAlone(){this.includesDuplicate("device")===-1&&(this.device.gatt?.disconnect(),Zt(),Se())}async initPolarH10IfUnique(){let e=this.includesDuplicate("device");if(e<0)try{this.polarH10=new Be(this.device),await this.polarH10.init();let t=await this.polarH10.getSensorSettingsFromId(U.ACC)}catch(t){throw console.log(t),new Error("polarH10 device initialization failed!")}else this.polarH10=i.polarVisRows[e].polarH10}resetECG(){this.ecg_canvas=void 0,this.ECGDiv=void 0,this.ecg_resize=void 0,this.ecg_mss_win=void 0,this.ecg_chart=void 0,this.ecg_ts=void 0,this.ecg_filter_ts=void 0,this.ecg_rms_ts=void 0,this.ecg_resize_observer=void 0,this.ecg_filter_iir_coef=void 0,this.ecg_filter_iir=void 0,this.ecg_mss_win_i=0,this.ecg_mss=0}resetACC(){this.ACCDiv=void 0,this.acc_resize=void 0,this.acc_canvas=void 0,this.acc_chart=void 0,this.acc_x_ts=void 0,this.acc_y_ts=void 0,this.acc_z_ts=void 0,this.acc_resize_observer=void 0,this.acc_lp_iir_coef=void 0,this.acc_filter_iir_coef=void 0,this.acc_x_lp_iir=void 0,this.acc_y_lp_iir=void 0,this.acc_z_lp_iir=void 0,this.acc_mag_lp_iir=void 0,this.acc_x_lp_ts=void 0,this.acc_y_lp_ts=void 0,this.acc_z_lp_ts=void 0,this.acc_rho_ts=void 0,this.acc_phi_ts=void 0,this.acc_theta_ts=void 0,this.acc_mag_ts=void 0}onBodypartSelect=e=>{let t=e.target.selectedIndex;for(let l=0;l<i.polarVisRows.length;l++){let s=i.polarVisRows[l];s.polarH10===this.polarH10&&(s.bodypartSelect.selectedIndex=t,t===4?s.heartbeat_bpm_info===void 0&&s.heart_rate_var_rms_info===void 0&&(s.heartbeat_bpm_info=new st(void 0,void 0,"HR:   (bpm)","left",2,30,!0,"top","bold 20px 'Roboto Mono'","#fb4f4f"),s.heart_rate_var_rms_info=new st(void 0,void 0,"HRV:     (s)","left",2,60,!0,"top","bold 20px 'Roboto Mono'","#4ffbfb"),s.polarH10.addHeartRateEventListener(s.updateHRLabel),s.addHeartInfo()):t!==4&&(s.polarH10.removeHeartRateEventListener(s.updateHRLabel),s.removeheartInfo())),i.is_recording&&i.createNewRecordEntry(s)}};updateHRLabel=e=>{let t=`HR:${e.heart_rate_bpm.toString().padStart(3," ")}(bpm)`;this.heartbeat_bpm_info!==void 0&&(this.heartbeat_bpm_info.text=t);for(let r of e.rr_intervals_ms){r/=1e3,this.rr_list.push(r),this.rr_sum+=r;let c=r*r;if(this.rr_s_list.push(c),this.rr_ss+=c,this.rr_list.length>0&&this.rr_s_list.length>0)for(;this.rr_sum>this.hrv_win_ms;)this.rr_sum-=this.rr_list.shift(),this.rr_ss-=this.rr_s_list.shift()}let s=`HRV:${Math.sqrt(this.rr_ss/this.rr_s_list.length).toFixed(2).padStart(5," ")}(s)`;this.heart_rate_var_rms_info!==void 0&&(this.heart_rate_var_rms_info.text=s)};onCustomBodyPart=e=>{let t=e.target.value;for(let l=0;l<i.polarVisRows.length;l++){let s=i.polarVisRows[l];s.customBodyPart=t,s.polarH10===this.polarH10&&s.customBodyPartSpan!==void 0&&(s.customBodyPartSpan.textContent=t,s.customBodyPartInput.value=t)}if(t.length===0)for(let l=0;l<i.polarVisRows.length;l++){let s=i.polarVisRows[l];s.polarH10===this.polarH10&&(s.customBodyPartSpan?.classList.add("hide"),s.bodypartSelect?.classList.remove("hide"))}else for(let l=0;l<i.polarVisRows.length;l++){let s=i.polarVisRows[l];s.polarH10===this.polarH10&&(s.customBodyPartSpan?.classList.remove("hide"),s.bodypartSelect?.classList.add("hide"))}};updateBatteryInfo=async e=>{let t;e>le?t=`\u{1F50B}${e}%`:t=`\u{1FAAB}${e}%`,this.battLvlDiv!==void 0&&(this.battLvlDiv.textContent=t);for(let l=0;l<i.polarVisRows.length;l++){let s=i.polarVisRows[l];s.polarH10===this.polarH10&&s.battLvlDiv!==void 0&&(s.battLvlDiv.textContent=t)}};async initDeviceInfo(){this.deviceInfoDiv=I("deviceInfoDiv",this.optionDiv,["device-info"]),this.disconnectDiv=I("disconnectDiv",void 0,["flexbox","disconnect"]),this.disBtn=nt("delete","distBtn",this.disconnectDiv,!1,this.disconnectPolarH10,["btn","btn-primary","btn-sm","s-circle"]),Ct(this.disBtn,"disconnect","top"),this.polarH10.battLvl=await this.polarH10.getBatteryLevel(),this.optionDiv.removeChild(this.loadingDiv),this.optionDiv.removeChild(this.nameDiv),this.optionDiv.classList.remove("center"),this.nameDiv.textContent="",this.nameDiv.classList.add("flex"),this.deviceNameDiv=I("devicename",this.nameDiv,["flexbox"],this.deviceName);let e;this.polarH10.battLvl>le?e=`\u{1F50B}${this.polarH10.battLvl}%`:e=`\u{1FAAB}${this.polarH10.battLvl}%`,this.battLvlDiv=I("battLvl",this.nameDiv,["flexbox","small-mid-text"],e),this.nameDiv.classList.add("flexbox"),this.deviceInfoDiv.appendChild(this.disconnectDiv),this.deviceInfoDiv.appendChild(this.nameDiv),this.optionDiv.appendChild(this.deviceInfoDiv),this.dataInfo=I("dataInfo",this.deviceInfoDiv,["data-info"]),this.extraDataCtrl=I("extraDataCtrl",this.optionDiv,["extra-data-ctrl","center"]),this.filterConfigBtn=nt("settings","filterConfigBtn",this.extraDataCtrl,!0,this.toggleVisConfig,["btn","btn-sm"]),this.showVisConfig&&this.filterConfigBtn.classList.add("btn-primary"),Ct(this.filterConfigBtn,"settings, work-in-progress","left"),this.show3DBtn=nt("view_in_ar","show3DBtn",this.extraDataCtrl,!0,void 0,["btn","btn-sm"]),this.show3DBtn.disabled=!0,Ct(this.show3DBtn,"3D Tilt, work-in-progress","left"),this.rowOrder=I("rowOrder",this.optionDiv,["row-order"]),this.orderUpBtn=nt("arrow-up","orderUpBtn",this.rowOrder,!1,this.moveUp,["btn","btn-primary","btn-sm"]),Ct(this.orderUpBtn,"Move up","right"),this.orderUpBtn.disabled=i.polarVisRows.length<1,Ct(this.orderUpBtn,"Move up","right"),this.orderDownBtn=nt("arrow-down","orderDownBtn",this.rowOrder,!1,this.moveDown,["btn","btn-primary","btn-sm"]),Ct(this.orderDownBtn,"Move down","right"),this.orderDownBtn.disabled=!0,i.polarVisRows.length>0&&(i.polarVisRows[i.polarVisRows.length-1].orderDownBtn.disabled=!1),this.bodypartLabel=I("bodypartLabel",this.dataInfo,["bodypart-text"],"Bodypart:"),this.bodypartSelectDiv=I("bodypartSelectDiv",this.dataInfo,["bodypart-select"]),this.bodypartSelect=K("bodypartSelect",this.bodypartSelectDiv,["form-select","dark-input","select-sm","almost-full-width"],"",oe,void 0,Y),this.bodypartSelect.addEventListener("change",this.onBodypartSelect),this.customBodyPartSpan=D("customBodyPartSpan",this.bodypartSelectDiv,["hide","hide-overflow"],this.customBodyPart),this.dataCtrl=I("dataCtrl",this.optionDiv,["data-ctrl"]),this.visContainerDiv=I("visContainer",this.polarSensorDiv,["visContainer"]),this.visConfigDiv=I("visConfigDiv",this.polarSensorDiv,["visContainer"]),this.showVisConfig?this.visContainerDiv.classList.add("hide"):this.visConfigDiv.classList.add("hide"),this.initVisConfigDiv()}onECGStreamDelayChange=e=>{e.target.valueAsNumber<It?(e.target.valueAsNumber=It,e.target.value=It.toString()):e.target.valueAsNumber>Tt&&(e.target.valueAsNumber=Tt,e.target.value=Tt.toString()),this.ecg_stream_delay=e.target.valueAsNumber,this.ECGStreamDelayInput!==void 0&&(this.ECGStreamDelayInput.value=e.target.value),this.ecg_chart!==void 0&&"delay"in this.ecg_chart&&(this.ecg_chart.stop(),this.ecg_chart.delay=this.ecg_stream_delay,this.ecg_chart.start())};onECGRMSWinInput=e=>{let t=parseFloat(e.target.value);t<zt&&(t=zt),t>Xt&&(t=Xt),this.ecg_rms_window_ms=t,this.updateECGRMSWinSize(),this.updateECGRMSWin(),this.ecgFilterSelectGraphRestart()};onACCStreamDelayChange=e=>{e.target.valueAsNumber<Ft?(e.target.valueAsNumber=Ft,e.target.value=Ft.toString()):e.target.valueAsNumber>Mt&&(e.target.valueAsNumber=Mt,e.target.value=Mt.toString()),this.acc_stream_delay=e.target.valueAsNumber,this.ACCStreamDelayInput!==void 0&&(this.ACCStreamDelayInput.value=e.target.value),this.acc_chart!==void 0&&"delay"in this.acc_chart&&(this.acc_chart.stop(),this.acc_chart.delay=this.acc_stream_delay,this.acc_chart.start())};onECGMPPChange=e=>{e.target.valueAsNumber<wt?(e.target.valueAsNumber=wt,e.target.value=wt.toString()):e.target.valueAsNumber>Lt&&(e.target.valueAsNumber=Lt,e.target.value=Lt.toString()),this.ecg_millis_per_px=e.target.valueAsNumber,this.ECGstreamMPPInput!==void 0&&(this.ECGstreamMPPInput.value=e.target.value),this.ecg_chart!==void 0&&(this.ecg_chart.stop(),this.ecg_chart.options.millisPerPixel=this.ecg_millis_per_px,this.ecg_chart.start())};onACCMPPChange=e=>{e.target.valueAsNumber<Rt?(e.target.valueAsNumber=Rt,e.target.value=Rt.toString()):e.target.valueAsNumber>xt&&(e.target.valueAsNumber=xt,e.target.value=xt.toString()),this.acc_millis_per_px=e.target.valueAsNumber,this.ACCstreamMPPInput!==void 0&&(this.ACCstreamMPPInput.value=e.target.value),this.acc_chart!==void 0&&(this.acc_chart.stop(),this.acc_chart.options.millisPerPixel=this.acc_millis_per_px,this.acc_chart.start())};onACCRangeSelect=async e=>{let t=e.target.selectedIndex,l=Wt[t];for(let s=0;s<i.polarVisRows.length;s++){let r=i.polarVisRows[s];r.polarH10===this.polarH10&&(r.ACCRangeSelect!==void 0&&(r.ACCRangeSelect.selectedIndex=t),r.acc_range_g=l,r.initACCLowpassFilterSettings(),r.initACCFilterSettings())}await this.restartAllACC()};onACCSampleRateSelect=async e=>{let t=e.target.selectedIndex,l=_t[t];for(let s=0;s<i.polarVisRows.length;s++){let r=i.polarVisRows[s];r.polarH10===this.polarH10&&(r.ACCSampleRateSelect!==void 0&&(r.ACCSampleRateSelect.selectedIndex=t),r.acc_sample_rate_hz=l,r.initACCLowpassFilterSettings(),r.initACCFilterSettings())}await this.restartAllACC()};onECGFilterType=e=>{let t=e.target.selectedIndex;t===2?(this.ecg_filter_info.Fl=rt,this.ecg_filter_info.Fh=at,this.ecg_filter_info.BW=at-rt,this.ecg_filter_info.Fc=Math.sqrt(rt*at),this.ECGFilterLowCutInput!==void 0&&(this.ECGFilterLowCutInput.value=rt.toString()),this.ECGFilterHighCutInput!==void 0&&(this.ECGFilterHighCutInput.value=at.toString())):(this.ecg_filter_info.Fc=kt,this.ECGFilterCutoffInput!==void 0&&(this.ECGFilterCutoffInput.value=kt.toString())),this.ECGFilterCutoffInput!==void 0&&(t===2?this.ECGFilterCutoffInput.classList.add("hide"):this.ECGFilterCutoffInput.classList.remove("hide")),this.ECGFilterLowCutInput!==void 0&&(t===2?this.ECGFilterLowCutInput.classList.remove("hide"):this.ECGFilterLowCutInput.classList.add("hide")),this.ECGFilterHighCutInput!==void 0&&(t===2?this.ECGFilterHighCutInput.classList.remove("hide"):this.ECGFilterHighCutInput.classList.add("hide"));let l=ct[t];this.ecg_filter_info.type=l,this.ecgFilterSelectGraphRestart()};onACCFilterType=e=>{let t=e.target.selectedIndex;t===2?(this.acc_filter_info.Fl=it,this.acc_filter_info.Fh=Q,this.acc_filter_info.BW=Q-it,this.acc_filter_info.Fc=Math.sqrt(it*Q),this.ACCFilterLowCutInput!==void 0&&(this.ACCFilterLowCutInput.value=it.toString()),this.ACCFilterHighCutInput!==void 0&&(this.ACCFilterHighCutInput.value=Q.toString())):(this.acc_filter_info.Fc=Q,this.ACCFilterCutoffInput!==void 0&&(this.ACCFilterCutoffInput.value=Q.toString())),this.ACCFilterCutoffInput!==void 0&&(t===2?this.ACCFilterCutoffInput.classList.add("hide"):this.ACCFilterCutoffInput.classList.remove("hide")),this.ACCFilterLowCutInput!==void 0&&(t===2?this.ACCFilterLowCutInput.classList.remove("hide"):this.ACCFilterLowCutInput.classList.add("hide")),this.ACCFilterHighCutInput!==void 0&&(t===2?this.ACCFilterHighCutInput.classList.remove("hide"):this.ACCFilterHighCutInput.classList.add("hide"));let l=ct[t];this.acc_filter_info.type=l,this.accFilterSelectGraphRestart(3)};onECGFilterOrder=e=>{let t=parseInt(e.target.value);t<1&&(t=1),t>12&&(t=12),this.ecg_filter_info.order=t,this.ecgFilterSelectGraphRestart()};onACCFilterOrder=e=>{let t=parseInt(e.target.value);t<1&&(t=1),t>12&&(t=12),this.acc_filter_info.order=t,this.accFilterSelectGraphRestart(3)};onACCLPOrder=e=>{let t=parseInt(e.target.value);t<1&&(t=1),t>12&&(t=12),this.acc_lp_info.order=t,this.accFilterSelectGraphRestart(1)};onECGFilterChar=e=>{let t=e.target.selectedIndex,l=j[t];this.ecg_filter_info.characteristic=l,this.ecgFilterSelectGraphRestart()};onACCFilterChar=e=>{let t=e.target.selectedIndex,l=j[t];this.acc_filter_info.characteristic=l,this.accFilterSelectGraphRestart(3)};onACCLPChar=e=>{let t=e.target.selectedIndex,l=j[t];this.acc_lp_info.characteristic=l,this.accFilterSelectGraphRestart(1)};onECGFilterCutoff=e=>{let t=parseFloat(e.target.value);t<W&&(t=W),t>ot&&(t=ot),this.ECGFilterCutoffInput!==void 0&&(this.ECGFilterCutoffInput.value=t.toString()),this.ecg_filter_info.Fc=t,this.ecgFilterSelectGraphRestart()};onACCFilterCutoff=e=>{let t=parseFloat(e.target.value);t<k&&(t=k),t>et&&(t=et),this.ACCFilterCutoffInput!==void 0&&(this.ACCFilterCutoffInput.value=t.toString()),this.acc_filter_info.Fc=t,this.accFilterSelectGraphRestart(3)};onACCLPCutoff=e=>{let t=parseFloat(e.target.value);t<k&&(t=k),t>et&&(t=et),this.ACCLPCutoffInput!==void 0&&(this.ACCLPCutoffInput.value=t.toString()),this.acc_lp_info.Fc=t,this.accFilterSelectGraphRestart(1)};onECGFilterLowCutoff=e=>{let t=parseFloat(e.target.value);this.ecg_filter_info.Fh!==void 0&&t>=this.ecg_filter_info.Fh&&(t=this.ecg_filter_info.Fh-Z),t>ot&&(t=W),t<W&&(t=W),this.ecg_filter_info.Fl=t,this.updateBandpass(this.ecg_filter_info),this.ECGFilterHighCutInput!==void 0&&(this.ECGFilterHighCutInput.min=(t+Z).toString(),this.ECGFilterLowCutInput!==void 0&&(this.ECGFilterLowCutInput.value=t.toString())),this.ecgFilterSelectGraphRestart()};onACCFilterLowCutoff=e=>{let t=parseFloat(e.target.value);this.acc_filter_info.Fh!==void 0&&t>=this.acc_filter_info.Fh&&(t=this.acc_filter_info.Fh-lt),t>et&&(t=k),t<k&&(t=k),this.acc_filter_info.Fl=t,this.updateBandpass(this.acc_filter_info),this.ACCFilterHighCutInput!==void 0&&(this.ACCFilterHighCutInput.min=(t+lt).toString(),this.ACCFilterLowCutInput!==void 0&&(this.ACCFilterLowCutInput.value=t.toString())),this.accFilterSelectGraphRestart(3)};onECGFilterHighCutoff=e=>{let t=parseFloat(e.target.value);this.ecg_filter_info.Fl!==void 0&&t<=this.ecg_filter_info.Fl&&(t=this.ecg_filter_info.Fl+Z),t>ot&&(t=W),t<W&&(t=W),this.ecg_filter_info.Fh=t,this.updateBandpass(this.ecg_filter_info),this.ECGFilterLowCutInput!==void 0&&(this.ECGFilterLowCutInput.max=(t-Z).toString(),this.ECGFilterHighCutInput!==void 0&&(this.ECGFilterHighCutInput.value=t.toString())),this.ecgFilterSelectGraphRestart()};onACCFilterHighCutoff=e=>{let t=parseFloat(e.target.value);this.acc_filter_info.Fl!==void 0&&t<=this.acc_filter_info.Fl&&(t=this.acc_filter_info.Fl+lt),t>et&&(t=k),t<k&&(t=k),this.acc_filter_info.Fh=t,this.updateBandpass(this.acc_filter_info),this.ACCFilterLowCutInput!==void 0&&(this.ACCFilterLowCutInput.max=(t-lt).toString(),this.ACCFilterHighCutInput!==void 0&&(this.ACCFilterHighCutInput.value=t.toString())),this.accFilterSelectGraphRestart(3)};ecgFilterSelectGraphRestart(){this.ecgFilterCoefReset();let e=this.ECGFormSelect.selectedIndex,t=this.ECGFormSelect.disabled;this.generateECGFormSelect(),this.ECGFormSelect.disabled=t,this.ECGFormSelect.selectedIndex=e,e===1&&this.changeECGGraph({target:{selectedIndex:e}})}accFilterSelectGraphRestart(e=3){this.accFilterCoefReset();let t=this.ACCFormSelect.selectedIndex,l=this.ACCFormSelect.disabled;this.generateACCFormSelect(),this.ACCFormSelect.disabled=l,this.ACCFormSelect.selectedIndex=t,t===e&&this.changeACCGraph({target:{selectedIndex:t}})}ecgFilterCoefReset(){this.ecg_filter_iir_coef=$t[this.ecg_filter_info.type](this.ecg_filter_info),this.ecg_filter_iir=(0,O.IirFilter)(this.ecg_filter_iir_coef)}accFilterCoefReset(){this.acc_filter_iir_coef=$t[this.acc_filter_info.type](this.acc_filter_info),this.acc_x_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_y_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_z_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef),this.acc_mag_filter_iir=(0,O.IirFilter)(this.acc_filter_iir_coef)}async restartAllACC(){let e=[];for(let t=0;t<i.polarVisRows.length;t++){let l=i.polarVisRows[t];l.polarH10===this.polarH10&&l.ACCIsOn()&&(await l.onToggleACC({target:{checked:!1}}),e.push(l))}for(let t=0;t<e.length;t++)await e[t].onToggleACC({target:{checked:!0}})}initVisConfigDiv(){this.ECGConfigDiv=I("ECGConfigDiv",this.visConfigDiv,["float-left","almost-full-height","config-div","half-width","flexbox","flex-col"]);let e=I("ECGChartConfigTitleRow",this.ECGConfigDiv,["full-width","flexbox"]);I("ECGChartConfigTitle",e,["fourty-width","center","bold-text"],"EXG Visualization");let t=I("customBodypartInputDiv",e,["sixty-width","flexbox"]),l=D("customBodypartSpan",t,["padright-5px","padleft-5px"],"Custom Bodypart:");this.customBodyPartInput=hn("customBodyPartInput",t,["dark-input","custom-bodypart-input-width"]),this.customBodyPartInput.addEventListener("input",this.onCustomBodyPart),this.ECGChartConfigDiv=I("ECGChartConfigDiv",this.ECGConfigDiv,["full-width","flexbox"]);let s=I("ECGChartStreamDelay",this.ECGChartConfigDiv,["full-width","flexbox"]);D("ECGStreamDelayLabel",s,["padleft-5px","padright-5px"],"Delay (ms):"),this.ECGStreamDelayInput=V("ECGStreamDelayInput",s,["marginright-5px","dark-input","input-width-4_5"],It,Tt,ni,this.ecg_stream_delay),this.ECGStreamDelayInput.addEventListener("change",this.onECGStreamDelayChange),D("ECGStreamDataWidthLabel",s,["padright-5px"],"Data width (ms/px):"),this.ECGstreamMPPInput=V("ECGStreamMPPInput",s,["marginright-5px","dark-input","input-width-3_5"],wt,Lt,si,this.ecg_millis_per_px),this.ECGstreamMPPInput.addEventListener("change",this.onECGMPPChange),D("ECGSRMSLabel",s,["padright-5px"],"RMS window (ms): "),this.ECGRMSWinInput=V("ECGRMSWinInput",s,["marginright-5px","dark-input","input-width-4_5"],zt,Xt,qe,this.ecg_rms_window_ms),this.ECGRMSWinInput.addEventListener("change",this.onECGRMSWinInput),this.ECGFilterConfigDiv=I("ECGFilterConfigDiv",this.ECGConfigDiv,["full-width","flexbox"]),D("ECGFilterTypeSpan",this.ECGFilterConfigDiv,["padleft-5px","padright-5px"],"Filter Type:"),this.ECGFilterTypesSelect=K("ECGFilterTypesSelect",this.ECGFilterConfigDiv,["form-select","dark-input","select-sm","filter-type-width"],"",ct,ct.indexOf(this.ecg_filter_info.type)),this.ECGFilterTypesSelect.addEventListener("change",this.onECGFilterType),D("ECGFilterCharSpan",this.ECGFilterConfigDiv,["padleft-5px","padright-5px"],"Char:"),this.ECGFilteCharSelect=K("ECGFilteCharSelect",this.ECGFilterConfigDiv,["form-select","dark-input","select-sm","filter-char-width"],"",j,j.indexOf(this.ecg_filter_info.characteristic)),this.ECGFilteCharSelect.addEventListener("change",this.onECGFilterChar),D("ECGFilterOrderSpan",this.ECGFilterConfigDiv,["padleft-5px","padright-5px"],"Order:"),this.ECGFilterOrderInput=V("ECGFilterOrderInput",this.ECGFilterConfigDiv,["dark-input","input-width-3_5"],1,12,1,this.ecg_filter_info.order),this.ECGFilterOrderInput.addEventListener("change",this.onECGFilterOrder),D("ECGFilterCutoffSpan",this.ECGFilterConfigDiv,["padleft-5px","padright-5px"],"Cutoff (Hz):"),this.ECGFilterCutoffInput=V("ECGFilterCutoffInput",this.ECGFilterConfigDiv,["dark-input","freq-input-width"],W,ot,Z,this.ecg_filter_info.Fc),this.ECGFilterCutoffInput.addEventListener("change",this.onECGFilterCutoff),this.ECGFilterLowCutInput=V("ECGFilterLowCutInput",this.ECGFilterConfigDiv,["margin-left-5","dark-input","freq-input-width","hide"],W,this.ecg_filter_info.Fh,Z,this.ecg_filter_info.Fl),this.ECGFilterLowCutInput.addEventListener("change",this.onECGFilterLowCutoff),this.ECGFilterHighCutInput=V("ECGFilterHighCutInput",this.ECGFilterConfigDiv,["margin-left-5","dark-input","freq-input-width","hide"],this.ecg_filter_info.Fl,ot,Z,this.ecg_filter_info.Fh),this.ECGFilterHighCutInput.addEventListener("change",this.onECGFilterHighCutoff),this.ECGFilterTypesSelect.selectedIndex===2&&(this.ECGFilterCutoffInput.classList.add("hide"),this.ECGFilterLowCutInput.classList.remove("hide"),this.ECGFilterHighCutInput.classList.remove("hide")),this.ECGRMSConfigDiv=I("ECGRMSConfigDiv",this.ECGConfigDiv,["full-width"]),this.ACCConfigDiv=I("ACCConfigDiv",this.visConfigDiv,["float-left","almost-full-height","config-div","half-width","flexbox","flex-col"]);let r=I("ECGChartConfigTitleRow",this.ACCConfigDiv,["full-width","flexbox"]);I("ACCChartConfigTitle",r,["fourty-width","center","bold-text"],"Accelerometer Visualization");let c=I("ACCSampleRateRange",r,["sixty-width"]),o=D("ACCSampleRateSpan",c,["padright-5px","padleft-5px"],"Fs (Hz):");this.ACCSampleRateSelect=K("ACCSampleRateSelect",c,["form-select","dark-input","select-sm","input-width-4_5"],"",_t,_t.indexOf(this.acc_sample_rate_hz)),this.ACCSampleRateSelect.addEventListener("change",this.onACCSampleRateSelect);let n=D("ACCRangeSpan",c,["padright-5px","padleft-5px"],"Range (\xB1G):");this.ACCRangeSelect=K("ACCRangeSelect",c,["form-select","dark-input","select-sm","input-width-3_5"],"",Wt,Wt.indexOf(this.acc_range_g)),this.ACCRangeSelect.addEventListener("change",this.onACCRangeSelect),this.ACCChartConfigDiv=I("ACCChartConfigDiv",this.ACCConfigDiv,["full-width","flexbox"]);let a=I("ACCDisplaySettingsDiv",this.ACCChartConfigDiv,["full-width","flexbox"]);D("ACCStreamDelayLabel",a,["padleft-5px","padright-5px"],"Delay (ms):"),this.ACCStreamDelayInput=V("ACCStreamDelayInput",a,["marginright-5px","dark-input","input-width-4_5"],Ft,Mt,ri,this.acc_stream_delay),this.ACCStreamDelayInput.addEventListener("change",this.onACCStreamDelayChange),D("ACCStreamDataWidthLabel",a,["padright-5px"],"Data width (ms/px):"),this.ACCstreamMPPInput=V("ACCSteamMPPInput",a,["marginright-5px","dark-input","input-width-3_5"],Rt,xt,ai),this.ACCstreamMPPInput.value=this.acc_millis_per_px.toString(),this.ACCstreamMPPInput.addEventListener("change",this.onACCMPPChange),this.ACCLPConfigDiv=I("ACCLPConfigDiv",this.ACCConfigDiv,["full-width","flexbox"]),D("ACCLPCharSpan",this.ACCLPConfigDiv,["padleft-5px","padright-5px"],"Lowpass filter characteristic:"),this.ACCLPCharSelect=K("ACCLPCharSelect",this.ACCLPConfigDiv,["form-select","dark-input","select-sm","filter-char-width"],"",j,j.indexOf(this.acc_lp_info.characteristic)),this.ACCLPCharSelect.addEventListener("change",this.onACCLPChar),D("ACCLPOrderSpan",this.ACCLPConfigDiv,["padleft-5px","padright-5px"],"Order:"),this.ACCLPOrderInput=V("ACCLPOrderInput",this.ACCLPConfigDiv,["dark-input","input-width-3_5"],1,12,1,this.acc_lp_info.order),this.ACCLPOrderInput.addEventListener("change",this.onACCLPOrder),D("ACCLPCutoffSpan",this.ACCLPConfigDiv,["padleft-5px","padright-5px"],"Cutoff (Hz):"),this.ACCLPCutoffInput=V("ACCLPCutoffInput",this.ACCLPConfigDiv,["dark-input","freq-input-width"],k,_t[this.ACCSampleRateSelect.selectedIndex]/2,Z,this.acc_lp_info.Fc),this.ACCLPCutoffInput.addEventListener("change",this.onACCLPCutoff),this.ACCFilterConfigDiv=I("ACCFilterConfigDiv",this.ACCConfigDiv,["full-width","flexbox"]),D("ACCFilterTypeSpan",this.ACCFilterConfigDiv,["padleft-5px","padright-5px"],"Filter Type:"),this.ACCFilterTypesSelect=K("ACCFilterTypesSelect",this.ACCFilterConfigDiv,["form-select","dark-input","select-sm","filter-type-width"],"",ct,ct.indexOf(this.acc_filter_info.type)),this.ACCFilterTypesSelect.addEventListener("change",this.onACCFilterType),D("ACCFilterCharSpan",this.ACCFilterConfigDiv,["padleft-5px","padright-5px"],"Char:"),this.ACCFilterCharSelect=K("ACCFilterCharSelect",this.ACCFilterConfigDiv,["form-select","dark-input","select-sm","filter-char-width"],"",j,j.indexOf(this.acc_filter_info.characteristic)),this.ACCFilterCharSelect.addEventListener("change",this.onACCFilterChar),D("ACCFilterOrderSpan",this.ACCFilterConfigDiv,["padleft-5px","padright-5px"],"Order:"),this.ACCFilterOrderInput=V("ACCFilterOrderInput",this.ACCFilterConfigDiv,["dark-input","input-width-3_5"],1,12,1,this.acc_filter_info.order),this.ACCFilterOrderInput.addEventListener("change",this.onACCFilterOrder),D("ACCFilterCutoffSpan",this.ACCFilterConfigDiv,["padleft-5px","padright-5px"],"Cutoff (Hz):"),this.ACCFilterCutoffInput=V("ACCFilterCutoffInput",this.ACCFilterConfigDiv,["dark-input","freq-input-width","hide"],k,_t[this.ACCSampleRateSelect.selectedIndex]/2,Z,this.acc_filter_info.Fc),this.ACCFilterCutoffInput.addEventListener("change",this.onACCFilterCutoff),this.ACCFilterLowCutInput=V("ACCFilterLowCutInput",this.ACCFilterConfigDiv,["margin-left-5","dark-input","freq-input-width"],k,this.acc_filter_info.Fh,lt,this.acc_filter_info.Fl),this.ACCFilterLowCutInput.addEventListener("change",this.onACCFilterLowCutoff),this.ACCFilterHighCutInput=V("ACCFilterHighCutInput",this.ACCFilterConfigDiv,["margin-left-5","dark-input","freq-input-width"],this.acc_filter_info.Fl,et,lt,this.acc_filter_info.Fh),this.ACCFilterHighCutInput.addEventListener("change",this.onACCFilterHighCutoff),this.ACCFilterTypesSelect.selectedIndex!==2&&(this.ACCFilterCutoffInput.classList.remove("hide"),this.ACCFilterLowCutInput.classList.add("hide"),this.ACCFilterHighCutInput.classList.add("hide"))}async initDeviceGraphCtrl(){this.ECGCtrlDiv=I("ECGCtrlDiv",this.dataCtrl,["half-width"]);let e=Li("EXG",this.onToggleECG);this.ECGCtrlDiv.appendChild(e),this.ECGSwitchInput=e.children.item(0),this.ECGDropDown=I("ECGDropDownDiv",this.ECGCtrlDiv,["form-group"]),this.generateECGFormSelect(),this.ACCCtrlDiv=I("ACCCtrlDiv",this.dataCtrl,["half-width"]);let t=Li("ACC",this.onToggleACC);this.ACCCtrlDiv.appendChild(t),this.ACCSwitchInput=t.children.item(0),this.ACCDropDown=I("ACCDropDownDiv",this.ACCCtrlDiv,["form-group"]),this.generateACCFormSelect()}generateECGFormSelect(e=0,t=!0){this.ECGFormSelect!==void 0&&this.ECGFormSelect.parentElement?.removeChild(this.ECGFormSelect),this.ECGFormSelect=K("ECGFormSelect",this.ECGDropDown,["form-select","dark-input","select-sm","almost-full-width"],"",["Raw",Ae(this.ecg_filter_info),`${this.ecg_rms_window_ms}ms RMS`],e),this.ECGFormSelect.onchange=this.changeECGGraph,this.ECGFormSelect.disabled=t}generateACCFormSelect(e=0,t=!0){this.ACCFormSelect!==void 0&&this.ACCFormSelect.parentElement?.removeChild(this.ACCFormSelect),this.ACCFormSelect=K("ACCFormSelect",this.ACCDropDown,["form-select","dark-input","select-sm","almost-full-width"],"",["Raw",Ae(this.acc_lp_info),"Tilt",Ae(this.acc_filter_info)],e),this.ACCFormSelect.onchange=this.changeACCGraph,this.ACCFormSelect.disabled=t}async startECG(e=pt,t=!0){if(this.includesDuplicate("device",Mi)<0)try{let s=await this.polarH10.startECG(e);s?.error==="SUCCESS"||s?.error==="ALREADY IN STATE"?(t&&this.polarH10.addEventListener("ECG",this.newECGCallback),i.is_recording&&(i.createNewRecordEntry(this),this.polarH10.addEventListener("ECG",this.recordECGData))):(console.log(s),this.disconnectPolarH10())}catch(s){alert(s),this.disconnectPolarH10()}else this.polarH10.addEventListener("ECG",this.newECGCallback)}async stopECG(){if(this.includesDuplicate("device",Mi)<0)try{let t=await this.polarH10.stopECG();t&&console.log(t),this.polarH10.removeEventListener("ECG",this.recordECGData)}catch(t){console.log(t),alert(t),t.name==="NetworkError"&&this.disconnectPolarH10()}}async startACC(e=fe,t=ue,l=!0){if(this.includesDuplicate("device",Ri)<0)try{let r=await this.polarH10.startACC(e,t);r?.error==="SUCCESS"||r?.error==="ALREADY IN STATE"?(l&&this.polarH10.addEventListener("ACC",this.newACCCallback),i.is_recording&&(i.createNewRecordEntry(this),this.polarH10.addEventListener("ACC",this.recordACCData))):(console.log(r),this.disconnectPolarH10())}catch(r){alert(r),this.disconnectPolarH10()}else this.polarH10.addEventListener("ACC",this.newACCCallback)}async stopAcc(){if(this.includesDuplicate("device",Ri)<0)try{let t=await this.polarH10.stopACC();t&&console.log(t),this.polarH10.removeEventListener("ACC",this.recordACCData)}catch(t){console.log(t),alert(t),t.name==="NetworkError"&&this.disconnectPolarH10()}}ECGIsOn(){return this.ECGDiv!==void 0}ACCIsOn(){return this.ACCDiv!==void 0}};function wi(i,e,t,l=!1){return()=>{let r=i.canvas,c=r.parentNode,o=c.offsetWidth,n=c.offsetHeight,a=o*e,d=n*t;r.width=a-5,r.height=d,l&&console.log(`Resize at ${new Date().valueOf()} parent: ${c.id} ${c.offsetWidth} ${r.width} ${c.offsetHeight} ${r.height}`)}}function Li(i,e,t=Y){let l=document.createElement("label");l.setAttribute("class","form-switch"),l.classList.add("label-sm");let s=document.createElement("input");s.id=`${i}-onoff-${t()}`,s.type="checkbox",s.addEventListener("change",e),s.classList.add("input-sm");let r=document.createElement("i");return r.classList.add("form-icon"),l.textContent=i,l.appendChild(s),l.appendChild(r),l}function K(i,e=void 0,t=[],l="",s=[],r=void 0,c=Y){let o=document.createElement("select");return mt(o,i,e,t,l,c),cn(o,s,c),r!==void 0&&(o.selectedIndex=r),o}function cn(i,e,t=Y){for(let l=0;l<e.length;l++){let s=e[l],r=document.createElement("option");r.id=`${i.id}-${l}-${t()}`,r.textContent=s.toString(),i.appendChild(r)}}function I(i,e=void 0,t=[],l="",s=Y){let r=document.createElement("div");return mt(r,i,e,t,l,s),r}function V(i,e=void 0,t=[],l=0,s=100,r=1,c=1,o="",n=Y){let a=document.createElement("input");return mt(a,i,e,["form-input","input-sm",...t],o,n),a.setAttribute("type","number"),a.setAttribute("min",l.toString()),a.setAttribute("max",s.toString()),a.setAttribute("step",r.toString()),a.setAttribute("value",c.toString()),a}function hn(i,e=void 0,t=[],l="",s=Y){let r=document.createElement("input");return mt(r,i,e,["form-input","input-sm",...t],l,s),r.setAttribute("type","text"),r}function D(i,e=void 0,t=[],l="",s=Y){let r=document.createElement("span");return mt(r,i,e,t,l,s),r}function Fi(i,e=void 0,t=[],l="",s=Y){let r=document.createElement("canvas");return mt(r,i,e,t,l,s),r}function mt(i,e,t=void 0,l=[],s="",r=Y){return i.id=`${e}-${r()}`,t&&t.appendChild(i),l.length>0&&i.classList.add(...l),s.length>0&&(i.textContent=s),i}function Y(){return y.polarRowID}function Mi(i){return i.ECGDiv!==void 0}function Ri(i){return i.ACCDiv!==void 0}function Ct(i,e,t="top"){i.setAttribute("data-tooltip",e),i.classList.add("tooltip",`tooltip-${t}`)}function nt(i,e=void 0,t=void 0,l=!1,s=void 0,r=[],c=Y){let o=document.createElement("button");if(e){let a=c();a!==void 0?o.id=`${e}-${a}`:o.id=e}o.classList.add("flexbox","center");let n=document.createElement("i");return l?(n.classList.add("material-icons"),n.textContent=i):n.classList.add("icon",`icon-${i}`),o.appendChild(n),r.length>0&&o.classList.add(...r),s&&(o.onclick=s),t&&t.appendChild(o),o}function Ee(i){return typeof i!="string"||i.length===0?i:i.charAt(0).toUpperCase()+i.slice(1)}function qt(i,e=!0){let t="";return i.type==="lowpass"||i.type==="highpass"?t=`${i.type} (${Number.isInteger(i.Fc)?i.Fc:i.Fc?.toFixed(1)}Hz ${i.order} order ${Ee(i.characteristic)})`:t=`bandpass (${Number.isInteger(i.Fl)?i.Fl:i.Fl?.toFixed(1)}-${Number.isInteger(i.Fh)?i.Fh:i.Fh?.toFixed(1)}Hz ${i.order} order ${Ee(i.characteristic)})`,e&&(t=Ee(t)),t}function Ae(i){let e="";return i.type==="lowpass"||i.type==="highpass"?e=`${Number.isInteger(i.Fc)?i.Fc:i.Fc?.toFixed(1)}Hz ${i.type}`:e=`${Number.isInteger(i.Fl)?i.Fl:i.Fl?.toFixed(1)}-${Number.isInteger(i.Fh)?i.Fh:i.Fh?.toFixed(1)}Hz ${i.type}`,e}function dn(i,e,t="application/json"){let l=document.createElement("a"),s=new Blob([e],{type:t}),r=URL.createObjectURL(s);l.setAttribute("href",r),l.setAttribute("download",i),l.click()}var Gt=document.createElement("div");Gt.id="webapp_container";Gt.classList.add("container");document.body.appendChild(Gt);var ht=document.createElement("div");ht.id="top_bar_div";Gt.appendChild(ht);var Te=document.createElement("h3");Te.textContent="Polar H10 raw data visualizer";Te.classList.add("title");ht.appendChild(Te);ht.classList.add("center");var Ie=nt("plus","ble_connect_btn",ht,!1,pn,["btn","btn-primary","btn-action","s-circle","ble-conn","tooltip","tooltip-right"],()=>{});Ie.setAttribute("data-tooltip","Connect new Polar H10");var we=nt("cross","ble_disconnect_btn",ht,!1,_n,["btn","btn-error","btn-action","s-circle","ble-conn","tooltip","tooltip-right"],()=>{});we.setAttribute("data-tooltip","Stop all streams and disconnect");we.disabled=!0;var Pt=document.createElement("div");Pt.id="content_div";Pt.classList.add("flexbox","content");Gt.appendChild(Pt);if(navigator.bluetooth===void 0){let i=document.createElement("p");i.innerHTML=`Web Bluetooth API is not present!<br>
Please make sure you are using the latest chrome/chromium based browser.<br>
Also make sure to enable experimental-web-platform-features in your browser <a href="chrome://flags/#enable-experimental-web-platform-features">chrome://flags/#enable-experimental-web-platform-features</a> `,i.setAttribute("style","margin:5% 20%;font-size:1.4em;"),Pt.appendChild(i),window.stop()}var be=!1,un="record_btn",$=document.createElement("button");$.setAttribute("data-tooltip","Start recording");$.id=un;$.classList.add("btn","btn-primary","btn-action","s-circle","record-conn","center","tooltip","tooltip-left");var Dt=document.createElement("i");Dt.classList.add("material-icons");Dt.textContent="radio_button_unchecked";var yt=document.createElement("i");yt.classList.add("material-icons","hide","red");yt.textContent="radio_button_checked";$.appendChild(Dt);$.appendChild(yt);ht.appendChild($);$.addEventListener("click",fn);$.disabled=!0;function fn(i){be?(be=!1,Ie.disabled=!1,yt.classList.add("hide"),Dt.classList.remove("hide"),$.setAttribute("data-tooltip","Start recording"),yi()):(be=!0,Ie.disabled=!0,Dt.classList.add("hide"),yt.classList.remove("hide"),$.setAttribute("data-tooltip","Stop recording"),Di())}async function pn(){let i;try{i=await navigator.bluetooth.requestDevice({filters:[{namePrefix:"Polar"}],optionalServices:Oe})}catch(e){console.log(e);return}await xi(Pt,i)}async function _n(){await y.disconnectAllPolarH10(),we.disabled=!0,$.disabled=!0}window.onbeforeunload=function(i){y.hasAnyActiveStream()?(i.preventDefault(),i.returnValue=""):window.close()};
/*! Bundled license information:

smoothie/smoothie.js:
  (**
   * @license
   * MIT License:
   *
   * Copyright (c) 2010-2013, Joe Walnes
   *               2013-2018, Drew Noakes
   *
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   *
   * The above copyright notice and this permission notice shall be included in
   * all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   * THE SOFTWARE.
   *)

fili/dist/fili.min.js:
  (**
   * @name    fili
   * @version 2.0.3 | December 13th 2018
   * @author  Florian Markert
   * @license MIT
   *)
*/
//# sourceMappingURL=index.js.map
