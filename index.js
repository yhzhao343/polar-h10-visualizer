var ei=Object.create;var Qe=Object.defineProperty;var ti=Object.getOwnPropertyDescriptor;var ii=Object.getOwnPropertyNames;var ni=Object.getPrototypeOf,si=Object.prototype.hasOwnProperty;var K=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(r,o)=>(typeof require<"u"?require:r)[o]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});var je=(s,r)=>()=>(r||s((r={exports:{}}).exports,r),r.exports);var ai=(s,r,o,_)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of ii(r))!si.call(s,a)&&a!==o&&Qe(s,a,{get:()=>r[a],enumerable:!(_=ti(r,a))||_.enumerable});return s};var Te=(s,r,o)=>(o=s!=null?ei(ni(s)):{},ai(r||!s||!s.__esModule?Qe(o,"default",{value:s,enumerable:!0}):o,s));var we=je(le=>{(function(s){Date.now=Date.now||function(){return new Date().getTime()};var r={extend:function(){arguments[0]=arguments[0]||{};for(var a=1;a<arguments.length;a++)for(var i in arguments[a])arguments[a].hasOwnProperty(i)&&(typeof arguments[a][i]=="object"?arguments[a][i]instanceof Array?arguments[0][i]=arguments[a][i]:arguments[0][i]=r.extend(arguments[0][i],arguments[a][i]):arguments[0][i]=arguments[a][i]);return arguments[0]},binarySearch:function(a,i){for(var h=0,n=a.length;h<n;){var e=h+n>>1;i<a[e][0]?n=e:h=e+1}return h},pixelSnap:function(a,i){return i%2===0?Math.round(a):Math.floor(a)+.5}};function o(a){this.options=r.extend({},o.defaultOptions,a),this.disabled=!1,this.clear()}o.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},o.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},o.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var a=1;a<this.data.length;a++){var i=this.data[a][1];i>this.maxValue&&(this.maxValue=i),i<this.minValue&&(this.minValue=i)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},o.prototype.append=function(a,i,h){if(!(isNaN(a)||isNaN(i))){var n=this.data.length-1;if(n>=0)for(var e=n;;){var t=this.data[e];if(a>=t[0]){a===t[0]?h?(t[1]+=i,i=t[1]):t[1]=i:this.data.splice(e+1,0,[a,i]);break}if(e--,e<0){this.data.splice(0,0,[a,i]);break}}else this.data.push([a,i]);this.maxValue=isNaN(this.maxValue)?i:Math.max(this.maxValue,i),this.minValue=isNaN(this.minValue)?i:Math.min(this.minValue,i)}},o.prototype.dropOldData=function(a,i){for(var h=0;this.data.length-h>=i&&this.data[h+1][0]<a;)h++;h!==0&&this.data.splice(0,h)};function _(a){this.options=r.extend({},_.defaultChartOptions,a),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}_.tooltipFormatter=function(a,i){var h=this.options.timestampFormatter||_.timeFormatter,n=document.createElement("div"),e;n.appendChild(document.createTextNode(h(new Date(a))));for(var t=0;t<i.length;++t){e=i[t].series.options.tooltipLabel||"",e!==""&&(e=e+" ");var c=document.createElement("span");c.style.color=i[t].series.options.strokeStyle,c.appendChild(document.createTextNode(e+this.options.yMaxFormatter(i[t].value,this.options.labels.precision))),n.appendChild(document.createElement("br")),n.appendChild(c)}return n.innerHTML},_.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(a,i){return parseFloat(a).toFixed(i)},yMaxFormatter:function(a,i){return parseFloat(a).toFixed(i)},yIntermediateFormatter:function(a,i){return parseFloat(a).toFixed(i)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:2,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},title:{text:"",fillStyle:"#ffffff",fontSize:15,fontFamily:"monospace",verticalAlign:"middle"},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:_.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},_.AnimateCompatibility=function(){var a=function(h,n){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t(Date.now())},16)};return e.call(window,h,n)},i=function(h){var n=window.cancelAnimationFrame||function(e){clearTimeout(e)};return n.call(window,h)};return{requestAnimationFrame:a,cancelAnimationFrame:i}}(),_.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},_.prototype.addTimeSeries=function(a,i){this.seriesSet.push({timeSeries:a,options:r.extend({},_.defaultSeriesPresentationOptions,i)}),a.options.resetBounds&&a.options.resetBoundsInterval>0&&(a.resetBoundsTimerId=setInterval(function(){a.resetBounds()},a.options.resetBoundsInterval))},_.prototype.removeTimeSeries=function(a){for(var i=this.seriesSet.length,h=0;h<i;h++)if(this.seriesSet[h].timeSeries===a){this.seriesSet.splice(h,1);break}a.resetBoundsTimerId&&clearInterval(a.resetBoundsTimerId)},_.prototype.getTimeSeriesOptions=function(a){for(var i=this.seriesSet.length,h=0;h<i;h++)if(this.seriesSet[h].timeSeries===a)return this.seriesSet[h].options},_.prototype.bringToFront=function(a){for(var i=this.seriesSet.length,h=0;h<i;h++)if(this.seriesSet[h].timeSeries===a){var n=this.seriesSet.splice(h,1);this.seriesSet.push(n[0]);break}},_.prototype.streamTo=function(a,i){this.canvas=a,this.clientWidth=parseInt(this.canvas.getAttribute("width")),this.clientHeight=parseInt(this.canvas.getAttribute("height")),this.delay=i,this.start()},_.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.pointerEvents="none",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},_.prototype.updateTooltip=function(){if(this.options.tooltip){var a=this.getTooltipEl();if(!this.mouseover||!this.options.tooltip){a.style.display="none";return}for(var i=this.lastChartTimestamp,h=this.options.scrollBackwards?i-this.mouseX*this.options.millisPerPixel:i-(this.clientWidth-this.mouseX)*this.options.millisPerPixel,n=[],e=0;e<this.seriesSet.length;e++){var t=this.seriesSet[e].timeSeries;if(!t.disabled){var c=r.binarySearch(t.data,h);c>0&&c<t.data.length&&n.push({series:this.seriesSet[e],index:c,value:t.data[c][1]})}}n.length?(a.innerHTML=this.options.tooltipFormatter.call(this,h,n),a.style.display="block"):a.style.display="none"}},_.prototype.mousemove=function(a){if(this.mouseover=!0,this.mouseX=a.offsetX,this.mouseY=a.offsetY,this.mousePageX=a.pageX,this.mousePageY=a.pageY,!!this.options.tooltip){var i=this.getTooltipEl();i.style.top=Math.round(this.mousePageY)+"px",i.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()}},_.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},_.prototype.resize=function(){var a=!this.options.enableDpiScaling||!window?1:window.devicePixelRatio,i,h;this.options.responsive?(i=this.canvas.offsetWidth,h=this.canvas.offsetHeight,i!==this.lastWidth&&(this.lastWidth=i,this.canvas.setAttribute("width",Math.floor(i*a).toString()),this.canvas.getContext("2d").scale(a,a)),h!==this.lastHeight&&(this.lastHeight=h,this.canvas.setAttribute("height",Math.floor(h*a).toString()),this.canvas.getContext("2d").scale(a,a)),this.clientWidth=i,this.clientHeight=h):(i=parseInt(this.canvas.getAttribute("width")),h=parseInt(this.canvas.getAttribute("height")),a!==1?(Math.floor(this.clientWidth*a)!==i&&(this.canvas.setAttribute("width",Math.floor(i*a).toString()),this.canvas.style.width=i+"px",this.clientWidth=i,this.canvas.getContext("2d").scale(a,a)),Math.floor(this.clientHeight*a)!==h&&(this.canvas.setAttribute("height",Math.floor(h*a).toString()),this.canvas.style.height=h+"px",this.clientHeight=h,this.canvas.getContext("2d").scale(a,a))):(this.clientWidth=i,this.clientHeight=h))},_.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var a=function(){this.frame=_.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var i=new Date(0),h=this.seriesSet.reduce(function(n,e){var t=e.timeSeries.data,c=Math.round(this.options.displayDataFromPercentile*t.length)-1;if(c=c>=0?c:0,c=c<=t.length-1?c:t.length-1,t&&t.length>0){var u=t[c][0];n=n>u?n:u}return n}.bind(this),i);this.render(this.canvas,h>i?h:null)}else this.render();a()}.bind(this))}.bind(this);a()}},_.prototype.stop=function(){this.frame&&(_.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},_.prototype.updateValueRange=function(){for(var a=this.options,i=Number.NaN,h=Number.NaN,n=0;n<this.seriesSet.length;n++){var e=this.seriesSet[n].timeSeries;e.disabled||(isNaN(e.maxValue)||(i=isNaN(i)?e.maxValue:Math.max(i,e.maxValue)),isNaN(e.minValue)||(h=isNaN(h)?e.minValue:Math.min(h,e.minValue)))}if(a.maxValue!=null?i=a.maxValue:i*=a.maxValueScale,a.minValue!=null?h=a.minValue:h-=Math.abs(h*a.minValueScale-h),this.options.yRangeFunction){var t=this.options.yRangeFunction({min:h,max:i});h=t.min,i=t.max}if(!isNaN(i)&&!isNaN(h)){var c=i-h,u=c-this.currentValueRange,d=h-this.currentVisMinValue;this.isAnimatingScale=Math.abs(u)>.1||Math.abs(d)>.1,this.currentValueRange+=a.scaleSmoothing*u,this.currentVisMinValue+=a.scaleSmoothing*d}this.valueRange={min:h,max:i}},_.prototype.render=function(a,i){var h=Date.now();if(!(this.options.limitFPS>0&&h-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(i=(i||h)-(this.delay||0),i-=i%this.options.millisPerPixel,!this.isAnimatingScale){var n=this.lastChartTimestamp===i;if(n){var e=h-this.lastRenderTimeMillis>166.66666666666666;if(!e)return}}this.lastRenderTimeMillis=h,this.lastChartTimestamp=i,this.resize(),a=a||this.canvas;var t=a.getContext("2d"),c=this.options,u={top:0,left:0,width:this.clientWidth,height:this.clientHeight},d=i-u.width*c.millisPerPixel,v=function(G,B){var z=G-this.currentVisMinValue,Y=this.currentValueRange===0?u.height:u.height*(1-z/this.currentValueRange);return r.pixelSnap(Y,B)}.bind(this),S=function(G,B){var z=c.scrollBackwards?(i-G)/c.millisPerPixel:u.width-(i-G)/c.millisPerPixel;return r.pixelSnap(z,B)};if(this.updateValueRange(),t.font=c.labels.fontSize+"px "+c.labels.fontFamily,t.save(),t.translate(u.left,u.top),t.beginPath(),t.rect(0,0,u.width,u.height),t.clip(),t.save(),t.fillStyle=c.grid.fillStyle,t.clearRect(0,0,u.width,u.height),t.fillRect(0,0,u.width,u.height),t.restore(),t.save(),t.lineWidth=c.grid.lineWidth,t.strokeStyle=c.grid.strokeStyle,c.grid.millisPerLine>0){t.beginPath();for(var f=i-i%c.grid.millisPerLine;f>=d;f-=c.grid.millisPerLine){var T=S(f,c.grid.lineWidth);t.moveTo(T,0),t.lineTo(T,u.height)}t.stroke(),t.closePath()}for(var I=1;I<c.grid.verticalSections;I++){var A=r.pixelSnap(I*u.height/c.grid.verticalSections,c.grid.lineWidth);t.beginPath(),t.moveTo(0,A),t.lineTo(u.width,A),t.stroke(),t.closePath()}if(c.grid.borderVisible&&(t.beginPath(),t.strokeRect(0,0,u.width,u.height),t.closePath()),t.restore(),c.horizontalLines&&c.horizontalLines.length)for(var E=0;E<c.horizontalLines.length;E++){var M=c.horizontalLines[E],p=M.lineWidth||1,m=v(M.value,p);t.strokeStyle=M.color||"#ffffff",t.lineWidth=p,t.beginPath(),t.moveTo(0,m),t.lineTo(u.width,m),t.stroke(),t.closePath()}for(var l=0;l<this.seriesSet.length;l++){var R=this.seriesSet[l].timeSeries,g=R.data;if(R.dropOldData(d,c.maxDataSetLength),!(g.length<=1||R.disabled)){t.save();var C=this.seriesSet[l].options,b=C.strokeStyle&&C.strokeStyle!=="none",w=b?C.lineWidth:0;t.beginPath();var x=S(g[0][0],w),N=v(g[0][1],w),O=x,D=N,P;switch(t.moveTo(x,N),C.interpolation||c.interpolation){case"linear":case"line":{P=function(G,B,z,Y){t.lineTo(G,B)};break}case"bezier":default:{P=function(G,B,z,Y){t.bezierCurveTo(Math.round((z+G)/2),Y,Math.round(z+G)/2,B,G,B)};break}case"step":{P=function(G,B,z,Y){t.lineTo(G,Y),t.lineTo(G,B)};break}}for(var V=1;V<g.length;V++){var W=g[V],j=S(W[0],w),qe=v(W[1],w);P(j,qe,O,D),O=j,D=qe}b&&(t.lineWidth=C.lineWidth,t.strokeStyle=C.strokeStyle,t.stroke()),C.fillStyle&&(t.lineTo(O,u.height+w+1),t.lineTo(x,u.height+w+1),t.fillStyle=C.fillStyle,t.fill()),t.restore()}}c.tooltip&&this.mouseX>=0&&(t.lineWidth=c.tooltipLine.lineWidth,t.strokeStyle=c.tooltipLine.strokeStyle,t.beginPath(),t.moveTo(this.mouseX,0),t.lineTo(this.mouseX,u.height),t.closePath(),t.stroke()),this.updateTooltip();var k=c.labels;if(!k.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var Ze=c.yMaxFormatter(this.valueRange.max,k.precision),oe=c.yMinFormatter(this.valueRange.min,k.precision),$t=c.scrollBackwards?0:u.width-t.measureText(Ze).width-2,qt=c.scrollBackwards?0:u.width-t.measureText(oe).width-2;t.fillStyle=k.fillStyle,t.fillText(Ze,$t,k.fontSize),t.fillText(oe,qt,u.height-2)}if(k.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&c.grid.verticalSections>0)for(var Zt=(this.valueRange.max-this.valueRange.min)/c.grid.verticalSections,Qt=u.height/c.grid.verticalSections,I=1;I<c.grid.verticalSections;I++){var A=u.height-Math.round(I*Qt),Ce=c.yIntermediateFormatter(this.valueRange.min+I*Zt,k.precision),jt=k.intermediateLabelSameAxis?c.scrollBackwards?0:u.width-t.measureText(Ce).width-2:c.scrollBackwards?u.width-t.measureText(Ce).width-2:0;t.fillText(Ce,jt,A-c.grid.lineWidth)}if(c.timestampFormatter&&c.grid.millisPerLine>0)for(var Se=c.scrollBackwards?t.measureText(oe).width:u.width-t.measureText(oe).width+4,f=i-i%c.grid.millisPerLine;f>=d;f-=c.grid.millisPerLine){var T=S(f,0);if(!c.scrollBackwards&&T<Se||c.scrollBackwards&&T>Se){var Kt=new Date(f),Ee=c.timestampFormatter(Kt),be=t.measureText(Ee).width;Se=c.scrollBackwards?T+be+2:T-be-2,t.fillStyle=c.labels.fillStyle,c.scrollBackwards?t.fillText(Ee,T,u.height-2):t.fillText(Ee,T-be,u.height-2)}}if(c.title.text!==""){t.font=c.title.fontSize+"px "+c.title.fontFamily;var Jt=c.scrollBackwards?u.width-t.measureText(c.title.text).width-2:2;if(c.title.verticalAlign=="bottom"){t.textBaseline="bottom";var Ae=u.height}else if(c.title.verticalAlign=="middle"){t.textBaseline="middle";var Ae=u.height/2}else{t.textBaseline="top";var Ae=0}t.fillStyle=c.title.fillStyle,t.fillText(c.title.text,Jt,Ae)}t.restore()}},_.timeFormatter=function(a){function i(h){return(h<10?"0":"")+h}return i(a.getHours())+":"+i(a.getMinutes())+":"+i(a.getSeconds())},s.TimeSeries=o,s.SmoothieChart=_})(le)});var it=je((tt,Ie)=>{(function(s){if(typeof tt=="object"&&typeof Ie<"u")Ie.exports=s();else if(typeof define=="function"&&define.amd)define([],s);else{var r;r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this,r.Fili=s()}})(function(){return function s(r,o,_){function a(n,e){if(!o[n]){if(!r[n]){var t=typeof K=="function"&&K;if(!e&&t)return t(n,!0);if(i)return i(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[n]={exports:{}};r[n][0].call(u.exports,function(d){var v=r[n][1][d];return a(v||d)},u,u.exports,s,r,o,_)}return o[n].exports}for(var i=typeof K=="function"&&K,h=0;h<_.length;h++)a(_[h]);return a}({1:[function(s,r,o){"use strict";r.exports={CalcCascades:s("./src/calcCascades"),Fft:s("./src/fft"),FirCoeffs:s("./src/firCoeffs"),FirFilter:s("./src/firFilter"),IirCoeffs:s("./src/iirCoeffs"),IirFilter:s("./src/iirFilter"),TestFilter:s("./src/testFilter")}},{"./src/calcCascades":2,"./src/fft":3,"./src/firCoeffs":4,"./src/firFilter":5,"./src/iirCoeffs":6,"./src/iirFilter":7,"./src/testFilter":8}],2:[function(s,r,o){"use strict";var _=s("./iirCoeffs"),a=new _,i={bessel:{q:[[.57735026919],[.805538281842,.521934581669],[1.02331395383,.611194546878,.510317824749],[1.22566942541,.710852074442,.559609164796,.505991069397],[1.41530886916,.809790964842,.620470155556,.537552151325,.503912727276],[1.59465693507,.905947107025,.684008068137,.579367238641,.525936202016,.502755558204],[1.76552743493,.998998442993,.747625068271,.624777082395,.556680772868,.519027293158,.502045428643],[1.9292718407,1.08906376917,.810410302962,.671382379377,.591144659703,.542678365981,.514570953471,.501578400482],[2.08691792612,1.17637337045,.872034231424,.718163551101,.627261751983,.569890924765,.533371782078,.511523796759,.50125489338],[2.23926560629,1.26117120993,.932397288146,.764647810579,.664052481472,.598921924986,.555480327396,.526848630061,.509345928377,.501021580965],[2.38695091667,1.34368488961,.991497755204,.81060830488,.701011199665,.628878390935,.57943181849,.545207253735,.52208637596,.507736060535,.500847111042],[2.53048919562,1.42411783481,1.04937620183,.85593899901,.737862159044,.659265671705,.604435823473,.565352679646,.537608804383,.51849505465,.506508536474,.500715908905]],f3dB:[[1.27201964951],[1.60335751622,1.43017155999],[1.9047076123,1.68916826762,1.60391912877],[2.18872623053,1.95319575902,1.8320926012,1.77846591177],[2.45062684305,2.20375262593,2.06220731793,1.98055310881,1.94270419166],[2.69298925084,2.43912611431,2.28431825401,2.18496722634,2.12472538477,2.09613322542],[2.91905714471,2.66069088948,2.49663434571,2.38497976939,2.30961462222,2.26265746534,2.24005716132],[3.13149167404,2.87016099416,2.69935018044,2.57862945683,2.49225505119,2.43227707449,2.39427710712,2.37582307687],[3.33237300564,3.06908580184,2.89318259511,2.76551588399,2.67073340527,2.60094950474,2.55161764546,2.52001358804,2.50457164552],[3.52333123464,3.25877569704,3.07894353744,2.94580435024,2.84438325189,2.76691082498,2.70881411245,2.66724655259,2.64040228249,2.62723439989],[3.70566068548,3.44032173223,3.2574059854,3.11986367838,3.01307175388,2.92939234605,2.86428726094,2.81483068055,2.77915465405,2.75596888377,2.74456638588],[3.88040469682,3.61463243697,3.4292654707,3.28812274966,3.17689762788,3.08812364257,3.01720732972,2.96140104561,2.91862858495,2.88729479473,2.8674198668,2.8570800015]],f1dB:[[2.16477559371],[2.70320928596,2.41122332505],[3.25676581436,2.88822569572,2.74246238837],[3.76153580353,3.35675411406,3.14862673032,3.05646412475],[4.22174260104,3.79644757806,3.55260471864,3.41193742197,3.34673435508],[4.64584812552,4.20789257981,3.94082363122,3.76942681446,3.66549975744,3.61617359345],[5.04060395196,4.5944592201,4.3111677248,4.11836351827,3.98822359814,3.90713836715,3.86811234525],[5.41107948467,4.95951159709,4.66435804468,4.45575796102,4.30650679478,4.20286750045,4.13720522991,4.10531748119],[5.76110791853,5.30592898465,5.00182215701,4.7811081045,4.61724509926,4.49660100894,4.41131378918,4.35667671372,4.32997951075],[6.09364309488,5.63609116014,5.32506930789,5.09480346139,4.91939504255,4.78540258409,4.68493280536,4.61302286993,4.56661931366,4.54382759952],[6.41100731543,5.95195558182,5.63550073656,5.39754464742,5.21278891332,5.06801430334,4.95539684456,4.8697869429,4.80814951843,4.76793469612,4.74828032403],[6.71506056052,6.25514029778,5.9343616072,5.69011422355,5.49763642361,5.34401973764,5.22125973611,5.12485045619,5.05037962112,4.99699982231,4.96155789635,4.94441828777]]}},h={bessel:{as:[[1.3617],[1.3397,.7743],[1.2217,.9686,.5131],[1.1112,.9754,.7202,.3728],[1.0215,.9393,.7815,.5604,.2883]],bs:[[.618],[.4889,.389],[.3887,.3505,.2756],[.3162,.2979,.2621,.2087],[.265,.2549,.2351,.2059,.1665]]},butterworth:{as:[[1.4142],[1.8478,.7654],[1.9319,1.4142,.5176],[1.9616,1.6629,1.1111,.3902],[1.9754,1.782,1.4142,.908,.3129]],bs:[[1],[1,1],[1,1,1],[1,1,1,1],[1,1,1,1,1]]},tschebyscheff05:{as:[[1.3614],[2.6282,.3648],[3.8645,.7528,.1589],[5.1117,1.0639,.3439,.0885],[6.3648,1.3582,.4822,.1994,.0563]],bs:[[1.3827],[3.4341,1.1509],[6.9797,1.8573,1.0711],[11.9607,2.9365,1.4206,1.0407],[18.3695,4.3453,1.944,1.252,1.0263]]},tschebyscheff1:{as:[[1.3022],[2.5904,.3039],[3.8437,.6292,.1296],[5.1019,.8916,.2806,.0717],[6.3634,1.1399,.3939,.1616,.0455]],bs:[[1.5515],[4.1301,1.1697],[8.5529,1.9124,1.0766],[14.7608,3.0426,1.4334,1.0432],[22.7468,4.5167,1.9665,1.2569,1.0277]]},tschebyscheff2:{as:[[1.1813],[2.4025,.2374],[3.588,.4925,.0995],[4.7743,.6991,.2153,.0547],[5.9618,.8947,.3023,.1233,.0347]],bs:[[1.7775],[4.9862,1.1896],[10.4648,1.9622,1.0826],[18.151,3.1353,1.4449,1.0461],[28.0376,4.6644,1.9858,1.2614,1.0294]]},tschebyscheff3:{as:[[1.065],[2.1853,.1964],[3.2721,.4077,.0815],[4.3583,.5791,.1765,.0448],[5.4449,.7414,.2479,.1008,.0283]],bs:[[1.9305],[5.5339,1.2009],[11.6773,1.9873,1.0861],[20.2948,3.1808,1.4507,1.0478],[31.3788,4.7363,1.9952,1.2638,1.0304]]},allpass:{as:[[1.6278],[2.337,1.3506],[2.6117,2.0706,1.0967],[2.7541,2.4174,1.785,.9239],[2.8406,2.612,2.1733,1.5583,.8018]],bs:[[.8832],[1.4878,1.1837],[1.7763,1.6015,1.2596],[1.942,1.83,1.6101,1.2822],[2.049,1.9714,1.8184,1.5923,1.2877]]}},n=function(u,d){var v=[],S=0;if(d!=="fromPZ")for(u.order>12&&(u.order=12),S=0;S<u.order;S++){var f,T,I;u.transform==="matchedZ"?v.push(a.lowpassMZ({Fs:u.Fs,Fc:u.Fc,preGain:u.preGain,as:h[u.characteristic].as[u.order-1][S],bs:h[u.characteristic].bs[u.order-1][S]})):(u.characteristic==="butterworth"?(f=.5/Math.sin(Math.PI/(2*u.order)*(S+.5)),T=1):(f=i[u.characteristic].q[u.order-1][S],T=u.oneDb?i[u.characteristic].f1dB[u.order-1][S]:i[u.characteristic].f3dB[u.order-1][S]),I=d==="highpass"?u.Fc/T:u.Fc*T,d!=="bandpass"&&d!=="bandstop"||u.characteristic==="bessel"&&(I=Math.sqrt(u.order)*I/u.order),v.push(a[d]({Fs:u.Fs,Fc:I,Q:f,BW:u.BW||0,gain:u.gain||0,preGain:u.preGain||!1})))}else for(S=0;S<u.length;S++)v.push(a[d](u[S]));return v},e=function(u){return function(d){return n(d,u)}},t={},c=function(){var u=[];for(var d in a)t[d]=e(d),u.push(d);return t.available=function(){return u},t};r.exports=c},{"./iirCoeffs":6}],3:[function(s,r,o){"use strict";var _=function(a){if(!function(p){return!(p&p-1)}(a))return!1;var i={};i.length=a,i.buffer=new Float64Array(a),i.re=new Float64Array(a),i.im=new Float64Array(a),i.reI=new Float64Array(a),i.imI=new Float64Array(a),i.twiddle=new Int32Array(a),i.sinTable=new Float64Array(a-1),i.cosTable=new Float64Array(a-1);var h=2*Math.PI,n=Math.floor(Math.log(a)/Math.LN2);for(t=i.sinTable.length;t--;)i.sinTable[t]=Math.sin(h*(t/a)),i.cosTable[t]=Math.cos(h*(t/a));for(var e=a>>1,t=0,c=0;i.twiddle[t]=c,!(++t>=a);){for(n=e;n<=c;)c-=n,n>>=1;c+=n}var u=Math.PI,d=2*Math.PI,v=Math.abs,S=Math.pow,f=Math.cos,T=Math.sin,I=function(p){return T(u*p)/(u*p)},A=Math.E,E={rectangular:{calc:function(){return 1},values:[],correction:1},none:{calc:function(){return 1},values:[],correction:1},hanning:{calc:function(p,m){return .5*(1-f(d*p/(m-1)))},values:[],correction:2},hamming:{calc:function(p,m){return .54-.46*f(d*p/(m-1))},values:[],correction:1.8518999946875638},tukery:{calc:function(p,m,l){return p<l*(m-1)/2?.5*(1+f(u*(2*p/(l*(m-1))-1))):(m-1)*(1-l/2)<p?.5*(1+f(u*(2*p/(l*(m-1))-2/l+1))):1},values:[],correction:4/3},cosine:{calc:function(p,m){return T(u*p/(m-1))},values:[],correction:1.570844266360796},lanczos:{calc:function(p,m){return I(2*p/(m-1)-1)},values:[],correction:1.6964337576195783},triangular:{calc:function(p,m){return 2/(m+1)*((m+1)/2-v(p-(m-1)/2))},values:[],correction:2},bartlett:{calc:function(p,m){return 2/(m-1)*((m-1)/2-v(p-(m-1)/2))},values:[],correction:2},gaussian:{calc:function(p,m,l){return S(A,-.5*S((p-(m-1)/2)/(l*(m-1)/2),2))},values:[],correction:5/3},bartlettHanning:{calc:function(p,m){var l=d*p/(m-1);return .62-.48*v(p/(m-1)-.5)-.38*f(l)},values:[],correction:2},blackman:{calc:function(p,m,l){var R=(1-l)/2,g=l/2,C=d*p/(m-1);return R-.5*f(C)+g*f(2*C)},values:[],correction:4/3},blackmanHarris:{calc:function(p,m){var l=d*p/(m-1);return .35875-.48829*f(l)+.14128*f(2*l)-.01168*f(3*l)},values:[],correction:1.5594508635},nuttall3:{calc:function(p,m){var l=d*p/(m-1);return .375-.5*f(l)+.125*f(2*l)},values:[],correction:1.56},nuttall3a:{calc:function(p,m){var l=d*p/(m-1);return .40897-.5*f(l)+.09103*f(2*l)},values:[],correction:1.692},nuttall3b:{calc:function(p,m){var l=d*p/(m-1);return .4243801-.4973406*f(l)+.078793*f(2*l)},values:[],correction:1.7372527},nuttall4:{calc:function(p,m){var l=d*p/(m-1);return .3125-.46875*f(l)+.1875*f(2*l)-.03125*f(3*l)},values:[],correction:1.454543},nuttall4a:{calc:function(p,m){var l=d*p/(m-1);return .338946-.481973*f(l)+.161054*f(2*l)-.018027*f(3*l)},values:[],correction:1.512732763},nuttall4b:{calc:function(p,m){var l=d*p/(m-1);return .355768-.481973*f(l)+.144232*f(2*l)-.012604*f(3*l)},values:[],correction:1.55223262},nuttall4c:{calc:function(p,m){var l=d*p/(m-1);return .3635819-.4891775*f(l)+.1365995*f(2*l)-.0106411*f(3*l)},values:[],correction:1.57129067},sft3f:{calc:function(p,m){var l=d*p/(m-1);return .26526-.5*f(l)+.23474*f(2*l)},values:[],correction:1.3610238},sft4f:{calc:function(p,m){var l=d*p/(m-1);return .21706-.42103*f(l)+.28294*f(2*l)-.07897*f(3*l)},values:[],correction:1.2773573},sft5f:{calc:function(p,m){var l=d*p/(m-1);return .1881-.36923*f(l)+.28702*f(2*l)-.13077*f(3*l)+.02488*f(4*l)},values:[],correction:1.23167769},sft3m:{calc:function(p,m){var l=d*p/(m-1);return .28235-.52105*f(l)+.19659*f(2*l)},values:[],correction:1.39343451},sft4m:{calc:function(p,m){var l=d*p/(m-1);return .241906-.460841*f(l)+.2552381*f(2*l)-.041872*f(3*l)},values:[],correction:1.3190596},sft5m:{calc:function(p,m){var l=d*p/(m-1);return .209671-.407331*f(l)+.281225*f(2*l)-.092669*f(3*l)+.0091036*f(4*l)},values:[],correction:1.26529456464},nift:{calc:function(p,m){var l=d*p/(m-1);return .2810639-.5208972*f(l)+.1980399*f(2*l)},values:[],correction:1.39094182},hpft:{calc:function(p,m){var l=d*p/(m-1);return(1-1.912510941*f(l)+1.079173272*f(2*l)-.1832630879*f(3*l))/m},values:[],correction:1},srft:{calc:function(p,m){var l=d*p/(m-1);return(1-1.93*f(l)+1.29*f(2*l)-.388*f(3*l)+.028*f(4*l))/m},values:[],correction:1},hft70:{calc:function(p,m){var l=d*p/(m-1);return(1-1.90796*f(l)+1.07349*f(2*l)-.18199*f(3*l))/m},values:[],correction:1},hft95:{calc:function(p,m){var l=d*p/(m-1);return(1-1.9383379*f(l)+1.3045202*f(2*l)-.402827*f(3*l)+.0350665*f(4*l))/m},values:[],correction:1},hft90d:{calc:function(p,m){var l=d*p/(m-1);return(1-1.942604*f(l)+1.340318*f(2*l)-.440811*f(3*l)+.043097*f(4*l))/m},values:[],correction:1},hft116d:{calc:function(p,m){var l=d*p/(m-1);return(1-1.9575375*f(l)+1.4780705*f(2*l)-.6367431*f(3*l)+.1228389*f(4*l)-.0066288*f(5*l))/m},values:[],correction:1},hft144d:{calc:function(p,m){var l=d*p/(m-1);return(1-1.96760033*f(l)+1.57983607*f(2*l)-.81123644*f(3*l)+.22583558*f(4*l)-.02773848*f(5*l)+9036e-7*f(6*l))/m},values:[],correction:1},hft196d:{calc:function(p,m){var l=d*p/(m-1);return(1-1.97441842*f(l)+1.65409888*f(2*l)-.95788186*f(3*l)+.3367342*f(4*l)-.06364621*f(5*l)+.00521942*f(6*l)-10599e-8*f(7*l))/m},values:[],correction:1},hft223d:{calc:function(p,m){var l=d*p/(m-1);return(1-1.98298997309*f(l)+1.75556083063*f(2*l)-1.19037717712*f(3*l)+.56155440797*f(4*l)-.17296769663*f(5*l)+.03233247087*f(6*l)-.00324954578*f(7*l)+.0001380104*f(8*l)-132725e-11*f(9*l))/m},values:[],correction:1},hft248d:{calc:function(p,m){var l=d*p/(m-1);return(1-1.985844164102*f(l)+1.791176438506*f(2*l)-1.282075284005*f(3*l)+.667777530266*f(4*l)-.240160796576*f(5*l)+.056656381764*f(6*l)-.008134974479*f(7*l)+.00062454465*f(8*l)-19808998e-12*f(9*l)+132974e-12*f(10*l))/m},values:[],correction:1}},M=function(p){return E[p.name].values.length!==p.N?(p.n===0&&(E[p.name].values.length=0),E[p.name].values[p.n]=E[p.name].correction*E[p.name].calc(p.n,p.N,p.a),E[p.name].values[p.n]):E[p.name].values};return{forward:function(p,m){var l,R,g,C,b,w,x,N,O,D,P,V;g=i.buffer.length;var W={name:m,N:g,a:.5,n:0},j=M(W);if(typeof j=="number")for(l=0;l<g;++l)W.n=l,i.buffer[l]=p[l]*M(W);else for(l=0;l<g;++l)i.buffer[l]=p[l]*j[l];for(l=g;l--;)i.re[l]=i.buffer[i.twiddle[l]],i.im[l]=0;for(C=1;C<g;C=b)for(w=0,b=C+C,x=g/b,R=0;R<C;R++){for(N=i.cosTable[w],O=i.sinTable[w],l=R;l<g;l+=b)D=l+C,P=O*i.im[D]+N*i.re[D],V=N*i.im[D]-O*i.re[D],i.re[D]=i.re[l]-P,i.re[l]+=P,i.im[D]=i.im[l]-V,i.im[l]+=V;w+=x}return{re:i.re,im:i.im}},inverse:function(p,m){var l,R,g,C,b,w,x,N,O,D,P,V;for(g=p.length,l=g;l--;)R=i.twiddle[l],i.reI[l]=p[R],i.imI[l]=-m[R];for(C=1;C<g;C=b)for(w=0,b=C+C,x=g/b,R=0;R<C;R++){for(N=i.cosTable[w],O=i.sinTable[w],l=R;l<g;l+=b)D=l+C,P=O*i.imI[D]+N*i.reI[D],V=N*i.imI[D]-O*i.reI[D],i.reI[D]=i.reI[l]-P,i.reI[l]+=P,i.imI[D]=i.imI[l]-V,i.imI[l]+=V;w+=x}for(l=g;l--;)i.buffer[l]=i.reI[l]/g;return i.buffer},magnitude:function(p){for(var m=[],l=0;l<p.re.length;l++)m.push(Math.sqrt(p.re[l]*p.re[l]+p.im[l]*p.im[l]));return m},magToDb:function(p){for(var m=[],l=0;l<p.length;l++)m.push(20*Math.log(p[l])*Math.LOG10E);return m},phase:function(p){for(var m=[],l=0;l<p.re.length;l++)m.push(Math.atan2(p.im[l],p.re[l]));return m},windows:function(){var p=[];for(var m in E)p.push(m);return p}}};r.exports=_},{}],4:[function(s,r,o){"use strict";var _=function(){var a=function(e){var t=e.Fs,c=e.Fa,u=e.Fb,d=e.order||51,v=e.Att||100,S=function(p){for(var m=0,l=1,R=1;l>1e-6*R;)m+=2,l*=p*p/(m*m),R+=l;return R};d/2-Math.floor(d/2)==0&&d++;var f,T=(d-1)/2,I=[],A=0,E=0,M=[];for(I[0]=2*(u-c)/t,E=1;E<=T;E++)I[E]=(Math.sin(2*E*Math.PI*u/t)-Math.sin(2*E*Math.PI*c/t))/(E*Math.PI);for(A=v<21?0:v>50?.1102*(v-8.7):.5842*Math.pow(v-21,.4)+.07886*(v-21),f=S(A),E=0;E<=T;E++)M[T+E]=I[E]*S(A*Math.sqrt(1-E*E/(T*T)))/f;for(E=0;E<T;E++)M[E]=M[d-1-E];return M},i=function(e){var t=e.Fs,c=e.Fc,u=e.order,d=2*Math.PI*c/t,v=0,S=0,f=[];for(v=0;v<=u;v++)v-u/2==0?f[v]=d:(f[v]=Math.sin(d*(v-u/2))/(v-u/2),f[v]*=.54-.46*Math.cos(2*Math.PI*v/u)),S+=f[v];for(v=0;v<=u;v++)f[v]/=S;return f},h=function(e){var t;for(t=0;t<e.length;t++)e[t]=-e[t];return e[(e.length-1)/2]++,e},n=function(e){for(var t=i({order:e.order,Fs:e.Fs,Fc:e.F2}),c=h(i({order:e.order,Fs:e.Fs,Fc:e.F1})),u=[],d=0;d<t.length;d++)u.push(t[d]+c[d]);return u};return{lowpass:function(e){return i(e)},highpass:function(e){return h(i(e))},bandstop:function(e){return n(e)},bandpass:function(e){return h(n(e))},kbFilter:function(e){return a(e)},available:function(){return["lowpass","highpass","bandstop","bandpass","kbFilter"]}}};r.exports=_},{}],5:[function(s,r,o){"use strict";var _=s("./utils"),a=_.runMultiFilter,i=_.runMultiFilterReverse,h=_.complex,n=_.evaluatePhase,e=function(t){var c=t,u=[],d=0;for(d=0;d<c.length;d++)u[d]={re:c[d],im:0};var v=function(A){var E,M=[];for(E=0;E<A;E++)M.push(0);return{buf:M,pointer:0}},S=v(c.length-1),f=function(A,E){E.buf[E.pointer]=A;var M=0;for(d=0;d<E.buf.length;d++)M+=c[d]*E.buf[(E.pointer+d)%E.buf.length];return E.pointer=(E.pointer+1)%E.buf.length,M},T=function(A){var E=v(c.length-1);return a(A,E,f)},I=function(A){for(var E=A.Fs,M=A.Fr,p=-Math.PI*(M/E)*2,m={re:0,im:0},l=0;l<c.length-1;l++)m=h.add(m,h.mul(u[l],{re:Math.cos(p*l),im:Math.sin(p*l)}));var R=h.magnitude(m);return{magnitude:R,phase:h.phase(m),dBmagnitude:20*Math.log(R)*Math.LOG10E}};return{responsePoint:function(A){return I(A)},response:function(A){A=A||100;var E=[],M=0,p=2*A;for(M=0;M<A;M++)E[M]=I({Fs:p,Fr:M});return n(E),E},simulate:function(A){return T(A)},singleStep:function(A){return f(A,S)},multiStep:function(A,E){return a(A,S,f,E)},filtfilt:function(A,E){return i(a(A,S,f,E),S,f,!0)},reinit:function(){S=v(c.length-1)}}};r.exports=e},{"./utils":9}],6:[function(s,r,o){"use strict";var _=function(){var a=function(n,e){var t=n.Q,c=n.Fc,u=n.Fs,d={},v=2*Math.PI*c/u;return n.BW?d.alpha=Math.sin(v)*Math.sinh(Math.log(2)/2*n.BW*v/Math.sin(v)):d.alpha=Math.sin(v)/(2*t),d.cw=Math.cos(v),d.a0=1+d.alpha,e.a0=d.a0,e.a.push(-2*d.cw/d.a0),e.k=1,e.a.push((1-d.alpha)/d.a0),d},i=function(n){var e=n.Q,t=n.Fc,c=n.Fs,u={},d=2*Math.PI*t/c;return u.alpha=Math.sin(d)/(2*e),u.cw=Math.cos(d),u.A=Math.pow(10,n.gain/40),u},h=function(){var n={};return n.z=[0,0],n.a=[],n.b=[],n};return{fromPZ:function(n){var e=h();return e.a0=1,e.b.push(1),e.b.push(-n.z0.re-n.z1.re),e.b.push(n.z0.re*n.z1.re-n.z0.im*n.z1.im),e.a.push(-n.p0.re-n.p1.re),e.a.push(n.p0.re*n.p1.re-n.p0.im*n.p1.im),n.type==="lowpass"?e.k=(1+e.a[0]+e.a[1])/(1+e.b[1]+e.b[2]):e.k=(1-e.a[0]+e.a[1])/(1-e.b[1]+e.b[2]),e},lowpassMZ:function(n){var e=h();e.a0=1;var t=n.as,c=n.bs,u=2*Math.PI*n.Fc/n.Fs,d=-t/(2*c);return e.a.push(2*-Math.pow(Math.E,d*u)*Math.cos(-u*Math.sqrt(Math.abs(Math.pow(t,2)/(4*Math.pow(c,2))-1/c)))),e.a.push(Math.pow(Math.E,2*d*u)),n.preGain?(e.b.push(1),e.k=e.a0+e.a[0]+e.a[1]):(e.b.push(e.a0+e.a[0]+e.a[1]),e.k=1),e.b.push(0),e.b.push(0),e},lowpassBT:function(n){var e=h();return n.Q=1,e.wp=Math.tan(2*Math.PI*n.Fc/(2*n.Fs)),e.wp2=e.wp*e.wp,n.BW&&delete n.BW,e.k=1,e.a0=3*e.wp+3*e.wp2+1,e.b.push(3*e.wp2*n.Q/e.a0),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e.a.push((6*e.wp2-2)/e.a0),e.a.push((3*e.wp2-3*e.wp+1)/e.a0),e},highpassBT:function(n){var e=h();return n.Q=1,e.wp=Math.tan(2*Math.PI*n.Fc/(2*n.Fs)),e.wp2=e.wp*e.wp,n.BW&&delete n.BW,e.k=1,e.a0=e.wp+e.wp2+3,e.b.push(3*n.Q/e.a0),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e.a.push((2*e.wp2-6)/e.a0),e.a.push((e.wp2-e.wp+3)/e.a0),e},lowpass:function(n){var e=h();n.BW&&delete n.BW;var t=a(n,e);return n.preGain?(e.k=.5*(1-t.cw),e.b.push(1/t.a0)):(e.k=1,e.b.push((1-t.cw)/(2*t.a0))),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e},highpass:function(n){var e=h();n.BW&&delete n.BW;var t=a(n,e);return n.preGain?(e.k=.5*(1+t.cw),e.b.push(1/t.a0)):(e.k=1,e.b.push((1+t.cw)/(2*t.a0))),e.b.push(-2*e.b[0]),e.b.push(e.b[0]),e},allpass:function(n){var e=h();n.BW&&delete n.BW;var t=a(n,e);return e.k=1,e.b.push((1-t.alpha)/t.a0),e.b.push(-2*t.cw/t.a0),e.b.push((1+t.alpha)/t.a0),e},bandpassQ:function(n){var e=h(),t=a(n,e);return e.k=1,e.b.push(t.alpha*n.Q/t.a0),e.b.push(0),e.b.push(-e.b[0]),e},bandpass:function(n){var e=h(),t=a(n,e);return e.k=1,e.b.push(t.alpha/t.a0),e.b.push(0),e.b.push(-e.b[0]),e},bandstop:function(n){var e=h(),t=a(n,e);return e.k=1,e.b.push(1/t.a0),e.b.push(-2*t.cw/t.a0),e.b.push(e.b[0]),e},peak:function(n){var e=h(),t=i(n);return e.k=1,e.a0=1+t.alpha/t.A,e.a.push(-2*t.cw/e.a0),e.a.push((1-t.alpha/t.A)/e.a0),e.b.push((1+t.alpha*t.A)/e.a0),e.b.push(-2*t.cw/e.a0),e.b.push((1-t.alpha*t.A)/e.a0),e},lowshelf:function(n){var e=h();n.BW&&delete n.BW;var t=i(n);e.k=1;var c=2*Math.sqrt(t.A)*t.alpha;return e.a0=t.A+1+(t.A-1)*t.cw+c,e.a.push(-2*(t.A-1+(t.A+1)*t.cw)/e.a0),e.a.push((t.A+1+(t.A-1)*t.cw-c)/e.a0),e.b.push(t.A*(t.A+1-(t.A-1)*t.cw+c)/e.a0),e.b.push(2*t.A*(t.A-1-(t.A+1)*t.cw)/e.a0),e.b.push(t.A*(t.A+1-(t.A-1)*t.cw-c)/e.a0),e},highshelf:function(n){var e=h();n.BW&&delete n.BW;var t=i(n);e.k=1;var c=2*Math.sqrt(t.A)*t.alpha;return e.a0=t.A+1-(t.A-1)*t.cw+c,e.a.push(2*(t.A-1-(t.A+1)*t.cw)/e.a0),e.a.push((t.A+1-(t.A-1)*t.cw-c)/e.a0),e.b.push(t.A*(t.A+1+(t.A-1)*t.cw+c)/e.a0),e.b.push(-2*t.A*(t.A-1+(t.A+1)*t.cw)/e.a0),e.b.push(t.A*(t.A+1+(t.A-1)*t.cw-c)/e.a0),e},aweighting:function(n){var e=h();e.k=1;var t=2*Math.PI*n.Fc/n.Fs,c=2*Math.tan(t/2),u=n.Q,d=Math.pow(c,2);return e.a0=4*u+d*u+2*c,e.a.push(2*d*u-8*u),e.a.push(4*u+d*u-2*c),e.b.push(d*u),e.b.push(2*d*u),e.b.push(d*u),e}}};r.exports=_},{}],7:[function(s,r,o){"use strict";var _=s("./utils"),a=_.complex,i=_.runMultiFilter,h=_.runMultiFilterReverse,n=_.evaluatePhase,e=function(t){for(var c=t,u={re:1,im:0},d=[],v=[],S=0;S<c.length;S++){d[S]={};var f=c[S];d[S].b0={re:f.b[0],im:0},d[S].b1={re:f.b[1],im:0},d[S].b2={re:f.b[2],im:0},d[S].a1={re:f.a[0],im:0},d[S].a2={re:f.a[1],im:0},d[S].k={re:f.k,im:0},d[S].z=[0,0],v[S]={},v[S].b1=f.b[1]/f.b[0],v[S].b2=f.b[2]/f.b[0],v[S].a1=f.a[0],v[S].a2=f.a[1]}var T=function(g,C){var b=C*g.k.re-g.a1.re*g.z[0]-g.a2.re*g.z[1],w=g.b0.re*b+g.b1.re*g.z[0]+g.b2.re*g.z[1];return g.z[1]=g.z[0],g.z[0]=b,w},I=function(g,C){var b=g,w=0;for(w=0;w<C.length;w++)b=T(C[w],b);return b},A=function(g,C){var b=g.Fs,w=g.Fr,x=-Math.PI*(w/b)*2,N={re:Math.cos(x),im:Math.sin(x)},O=a.mul(C.k,a.add(C.b0,a.mul(N,a.add(C.b1,a.mul(C.b2,N))))),D=a.add(u,a.mul(N,a.add(C.a1,a.mul(C.a2,N)))),P=a.div(O,D);return{magnitude:a.magnitude(P),phase:a.phase(P)}},E=function(g){var C=0,b={magnitude:1,phase:0};for(C=0;C<d.length;C++){var w=A(g,d[C]);b.magnitude*=w.magnitude,b.phase+=w.phase}return b.dBmagnitude=20*Math.log(b.magnitude)*Math.LOG10E,b},M=function(){for(var g=[],C=0;C<c.length;C++)g[C]={b0:{re:f.b[0],im:0},b1:{re:f.b[1],im:0},b2:{re:f.b[2],im:0},a1:{re:f.a[0],im:0},a2:{re:f.a[1],im:0},k:{re:f.k,im:0},z:[0,0]};return g},p=function(g){var C=M();return i(g,C,I)},m=function(g,C){var b={},w=[],x=0;for(x=0;x<C;x++)w.push(g(x));b.out=p(w);var N=!1,O=!1;for(x=0;x<C-1;x++)if(b.out[x]>b.out[x+1]&&!N&&(N=!0,b.max={sample:x,value:b.out[x]}),N&&!O&&b.out[x]<b.out[x+1]){O=!0,b.min={sample:x,value:b.out[x]};break}return b},l=function(g,C){var b=Math.pow(g/2,2)-C;return b<0?[{re:-g/2,im:Math.sqrt(Math.abs(b))},{re:-g/2,im:-Math.sqrt(Math.abs(b))}]:[{re:-g/2+Math.sqrt(b),im:0},{re:-g/2-Math.sqrt(b),im:0}]},R=function(){for(var g=[],C=0;C<v.length;C++)g[C]={},g[C].z=l(v[C].b1,v[C].b2),g[C].p=l(v[C].a1,v[C].a2);return g};return{singleStep:function(g){return I(g,d)},multiStep:function(g,C){return i(g,d,I,C)},filtfilt:function(g,C){return h(i(g,d,I,C),d,I,!0)},simulate:function(g){return p(g)},stepResponse:function(g){return m(function(){return 1},g)},impulseResponse:function(g){return m(function(C){return C===0?1:0},g)},responsePoint:function(g){return E(g)},response:function(g){g=g||100;var C=[],b=0,w=2*g;for(b=0;b<g;b++)C[b]=E({Fs:w,Fr:b});return n(C),C},polesZeros:function(){return R()},reinit:function(){for(S=0;S<d.length;S++)d[S].z=[0,0]}}};r.exports=e},{"./utils":9}],8:[function(s,r,o){"use strict";var _=function(a){var i,h=a,n=[],e=function(d){for(i=0;i<d.steps;i++)n.push(h.singleStep((Math.random()-.5)*d.pp+d.offset))},t=function(d){var v=d.offset+d.pp,S=d.offset-d.pp;for(i=0;i<d.steps;i++)i%200<100?n.push(h.singleStep(v)):n.push(h.singleStep(S))},c=function(d){var v=d.offset+d.pp,S=d.offset-d.pp;for(i=0;i<d.steps;i++)i%100==0?n.push(h.singleStep(v)):n.push(h.singleStep(S))},u=function(d){var v=d.offset+d.pp,S=d.offset-d.pp,f=S,T=(v-S)/100;for(i=0;i<d.steps;i++)i%200<100?f+=T:f-=T,n.push(h.singleStep(f))};return{randomStability:function(d){for(h.reinit(),n.length=0,e(d),i=d.setup;i<n.length;i++)if(n[i]>d.maxStable||n[i]<d.minStable)return n[i];return!0},directedRandomStability:function(d){h.reinit(),n.length=0;var v;for(v=0;v<d.tests;v++){var S=Math.random();S<.25?e(d):S<.5?t(d):S<.75?c(d):u(d)}for(e(d),i=d.setup;i<n.length;i++)if(n[i]>d.maxStable||n[i]<d.minStable)return n[i];return!0},evaluateBehavior:function(){}}};r.exports=_},{}],9:[function(s,r,o){"use strict";o.evaluatePhase=function(n){var e=0,t=0,c=Math.PI,u=2*c,d=[];for(t=0;t<n.length;t++)d.push(n[t].phase);for(n[0].unwrappedPhase=n[0].phase,n[0].groupDelay=0,t=1;t<d.length;t++){var v=d[t]-d[t-1];if(v>c)for(e=t;e<d.length;e++)d[e]-=u;else if(v<-c)for(e=t;e<d.length;e++)d[e]+=u;d[t]<0?n[t].unwrappedPhase=-d[t]:n[t].unwrappedPhase=d[t],n[t].phaseDelay=n[t].unwrappedPhase/(t/n.length),n[t].groupDelay=(n[t].unwrappedPhase-n[t-1].unwrappedPhase)/(c/n.length),n[t].groupDelay<0&&(n[t].groupDelay=-n[t].groupDelay)}n[0].magnitude!==0?(n[0].phaseDelay=n[1].phaseDelay,n[0].groupDelay=n[1].groupDelay):(n[0].phaseDelay=n[2].phaseDelay,n[0].groupDelay=n[2].groupDelay,n[1].phaseDelay=n[2].phaseDelay,n[1].groupDelay=n[2].groupDelay)},o.runMultiFilter=function(n,e,t,c){var u=[];c&&(u=n);var d;for(d=0;d<n.length;d++)u[d]=t(n[d],e);return u},o.runMultiFilterReverse=function(n,e,t,c){var u=[];c&&(u=n);var d;for(d=n.length-1;d>=0;d--)u[d]=t(n[d],e);return u};var _=function(n,e){for(var t=!0;t;){var c=n,u=e;if(t=!1,u||(u=1),c!==Math.floor(c)||u!==Math.floor(u))return 1;if(c===0||c===1)return u;n=c-1,e=u*c,t=!0}};o.besselFactors=function(n){for(var e=[],t=0;t<n+1;t++){var c=_(2*n-t),u=Math.pow(2,n-t)*_(t)*_(n-t);e.unshift(Math.floor(c/u))}return e};var a=function(n,e){for(var t=0,c=0;c<e;c++){var u=1/Math.pow(2,c+1);n>u&&(n-=u,t+=u)}return t},i=function(n,e){return n&Math.pow(2,e)},h=function(n,e,t){var c=Math.abs(n),u=n-c;return{number:i(c,e).toString(),fraction:a(u,t).toString(),numberBits:e,fractionBits:t}};o.fixedPoint={convert:function(n,e,t){return h(n,e,t)},add:function(n,e){},sub:function(n,e){},mul:function(n,e){},div:function(n,e){}},o.complex={div:function(n,e){var t=n.re,c=n.im,u=e.re,d=e.im,v=u*u+d*d;return{re:(t*u+c*d)/v,im:(c*u-t*d)/v}},mul:function(n,e){var t=n.re,c=n.im,u=e.re,d=e.im;return{re:t*u-c*d,im:(t+c)*(u+d)-t*u-c*d}},add:function(n,e){return{re:n.re+e.re,im:n.im+e.im}},sub:function(n,e){return{re:n.re-e.re,im:n.im-e.im}},phase:function(n){return Math.atan2(n.im,n.re)},magnitude:function(n){return Math.sqrt(n.re*n.re+n.im*n.im)}}},{}]},{},[1])(1)})});var y=Te(we(),1);var Je=Te(we(),1),ce="#ebebebcc",he="#5f5f5fcc",J="14px Arial";function et(s){return parseFloat(s.split("px")[0])}var de=class{timeseries;tsPresOpts;text;x=0;y=0;fillStyle;textBaseline="top";textAlign="start";font=J;on=!0;on_fillStyle;off_fillStyle=he;width=void 0;height=void 0;constructor(r,o,_,a="start",i=0,h=0,n=!0,e="top",t=J,c=void 0,u=void 0){this.timeseries=r,this.tsPresOpts=o,this.text=_,this.textAlign=a,this.x=i,this.y=h,this.on=n,this.fillStyle=o?.strokeStyle||(n?ce:he),this.textBaseline=e,this.font=t,c!==void 0?this.on_fillStyle=c:this.on&&(this.on_fillStyle=this.fillStyle),u!==void 0?this.off_fillStyle=u:this.on||(this.off_fillStyle=this.fillStyle),this.enable(n)}getHeight(){return this.height=et(this.font),this.height}getWidth(r){let o=r.getContext("2d");return o&&(o.save(),o.textBaseline=this.textBaseline,o.textAlign=this.textAlign,o.font=this.font,o.fillStyle=this.fillStyle,this.width=o.measureText(this.text).width,o.restore()),this.width}enable(r=!0){this.on=r,this.fillStyle=this.on?this.on_fillStyle:this.off_fillStyle}onclick(){this.on=!this.on,this.enable(this.on)}};function Ke(s,r,o,_,a,i){return s>o&&s<o+_&&r>a&&r<a+i}var ee=class extends Je.SmoothieChart{smoothieTSInfos;isRow=!0;enableRenderLegend=!0;allowToggleTooltip=!0;allowToggleLegend=!0;allowToggleLabelAuto=!0;ctrlFont=J;ctrlFontHeight=0;enableTooltipText="[Tooltip]";enableTooltipTextX=0;enableTooltipTextY=0;enableTooltipTextWidth=0;yAutoScaleText="[Auto Y scale]";yAutoScaleTextX=0;yAutoScaleTextY=0;yAutoScaleTextWidth=0;defaultXSpacing=10;defaultYSpacing=0;renderOffset=0;prevMinValue=void 0;prevMaxValue=void 0;scrollable=!1;constructor(r,o=!0,_=!0,a=!0,i=!0,h=!0,n=J,e=10,t=0,c=!1){super(r),this.smoothieTSInfos=[],this.isRow=o,this.enableRenderLegend=_,this.allowToggleTooltip=a,this.allowToggleLegend=i,this.allowToggleLabelAuto=h,this.ctrlFont=n,this.defaultXSpacing=e,this.defaultYSpacing=t,this.ctrlFontHeight=et(this.ctrlFont),this.scrollable=c}canvasOnClick=r=>{if(this.allowToggleLegend&&"canvas"in this){let o=this.canvas;this.allowToggleTooltip&&this.options.tooltip!==void 0&&Ke(r.offsetX,r.offsetY,this.enableTooltipTextX,this.enableTooltipTextWidth,this.enableTooltipTextY,this.ctrlFontHeight)&&(this.options.tooltip?(this.options.tooltip=!1,"tooltipEl"in this&&(this.tooltipEl.style.display="none")):this.options.tooltip=!0),this.allowToggleLabelAuto&&Ke(r.offsetX,r.offsetY,this.yAutoScaleTextX,this.yAutoScaleTextWidth,this.yAutoScaleTextY,this.ctrlFontHeight)&&(this.yScaleIsAuto()?(this.options.minValue=this.prevMinValue||this?.valueRange?.min||20,this.options.maxValue=this.prevMaxValue||this?.valueRange?.max||-20,this.updateValueRange(),this.showScrollMessage()):(this.prevMinValue=this.options.minValue,this.prevMaxValue=this.options.maxValue,this.options.minValue=void 0,this.options.maxValue=void 0,this.updateValueRange()));for(let _=0;_<this.smoothieTSInfos.length;_++){let a=this.smoothieTSInfos[_],i=a.width||a.getWidth(o)||0,h=a.height||a.getHeight()||0;i>0&&h>0&&r.offsetX-this.renderOffset>a.x&&r.offsetX-this.renderOffset<a.x+i&&r.offsetY>a.y&&r.offsetY<a.y+h&&(a.onclick(),a.on?a.timeseries!==void 0&&this.addTimeSeries(a.timeseries,a.tsPresOpts):a.timeseries!==void 0&&this.removeTimeSeries(a.timeseries))}}};yScaleIsAuto(){return this.options.minValue===void 0||this.options.maxValue===void 0}streamTo(r,o){super.streamTo(r,o),"canvas"in this&&this.canvas.addEventListener("click",this.canvasOnClick)}render(r,o){if(super.render(r,o),this.enableRenderLegend&&this.smoothieTSInfos.length){let _=this.lastRenderTimeMillis;Date.now()-_<3&&this.renderLegend(r)}}renderLegend(r){let o=r.getContext("2d");if(o){o.save();let _=this.smoothieTSInfos,a=this.defaultXSpacing;this.allowToggleTooltip&&(o.textBaseline="top",o.textAlign="start",o.font=this.ctrlFont,o.fillStyle=this.options.tooltip?ce:he,o.fillText(this.enableTooltipText,a,this.defaultYSpacing),this.enableTooltipTextX=a,this.enableTooltipTextY=this.defaultYSpacing,this.enableTooltipTextWidth=o.measureText(this.enableTooltipText).width,a+=this.enableTooltipTextWidth+this.defaultXSpacing),this.allowToggleLabelAuto&&(o.textBaseline="top",o.textAlign="start",o.font=this.ctrlFont,o.fillStyle=ce,o.fillStyle=this.yScaleIsAuto()?ce:he,o.fillText(this.yAutoScaleText,a,this.defaultYSpacing),this.yAutoScaleTextX=a,this.yAutoScaleTextY=this.defaultYSpacing,this.yAutoScaleTextWidth=o.measureText(this.yAutoScaleText).width,a+=this.yAutoScaleTextWidth+this.defaultXSpacing),this.renderOffset=a;let i=0;for(let h=0;h<_.length;h++){if(h>0){if(this.isRow&&_[h].x===_[0].x)_[h].x=_[h-1].x+i+this.defaultXSpacing;else if(!this.isRow&&_[h].y===_[0].y){let e=parseFloat(_[h].font.split("px")[0]);_[h].y=_[h-1].y+e+2}}let n=_[h];o.textBaseline=n.textBaseline,o.textAlign=n.textAlign,o.font=n.font,o.fillStyle=n.fillStyle,n.timeseries===void 0&&n.tsPresOpts===void 0?o.fillText(n.text,n.x,n.y):o.fillText(n.text,a+n.x,n.y),i=o.measureText(n.text).width}o.restore()}}addSmoothieTSInfo(r){this.smoothieTSInfos.indexOf(r)<0&&(this.smoothieTSInfos.push(r),r.timeseries!==void 0&&r.tsPresOpts!==void 0&&this.addTimeSeries(r.timeseries,r.tsPresOpts))}removeLegendTSInfo(r){let o=this.smoothieTSInfos.indexOf(r);return o>-1?(r.timeseries!==void 0&&this.removeTimeSeries(r.timeseries),this.smoothieTSInfos.splice(o,1)):[]}clearLegendTSInfos(){for(let r=0;r<this.smoothieTSInfos.length;r++){let o=this.smoothieTSInfos[r];o.timeseries!==void 0&&this.removeTimeSeries(o.timeseries)}this.smoothieTSInfos=[]}configureTimeSeries(r,o,_,a=!1,i=void 0,h=void 0,n=1,e=1,t="",c=!1,u=[],d=!0,v=!1,S=!0){this.clearLegendTSInfos();for(let f=0;f<r.length;f++){let T=new de(r[f],o[f],_[f].legend,_[f].textAlign,_[f].x,_[f].y,!0,_[f].textBaseline,_[f].font);this.addSmoothieTSInfo(T)}this.scrollable=a,this.showScrollMessage(),this.options.minValue=i,this.options.maxValue=h,this.options.minValueScale=n,this.options.maxValueScale=e,this.updateValueRange(),t.length>0&&this.options.title!==void 0&&(this.options.title.text=t),this.options.labels!==void 0&&(this.options.labels.disabled=c),this.options.horizontalLines=u,this.allowToggleLegend=d,this.allowToggleLabelAuto=v,this.allowToggleTooltip=S}showScrollMessage(){if(this.scrollable&&"canvas"in this){let r=this.canvas,o=new de(void 0,void 0,"Scroll to change y-range","center",r.width/window.devicePixelRatio/2,30,!0,"top","16px Arial","#fbfbfb");this.addSmoothieTSInfo(o),setTimeout(()=>{this.removeLegendTSInfo(o)},1500)}}};function F(s,r=10,o=5,_="top",a="start",i=J){return{legend:s,x:r,y:o,textBaseline:_,textAlign:a,font:i}}var H=Te(it(),1);var ri="fb005c80-02e7-f387-1cad-8acd2d8df0c8",oi="fb005c81-02e7-f387-1cad-8acd2d8df0c8",li="fb005c82-02e7-f387-1cad-8acd2d8df0c8",U=(s=>(s[s.ECG=0]="ECG",s[s.PPG=1]="PPG",s[s.ACC=2]="ACC",s[s.PPI=3]="PPI",s[s.GYRO=5]="GYRO",s[s.MAGNETOMETER=6]="MAGNETOMETER",s[s.SDK_MODE=9]="SDK_MODE",s[s.LOCATION=10]="LOCATION",s[s.PRESSURE=11]="PRESSURE",s[s.TEMPERATURE=12]="TEMPERATURE",s))(U||{}),Re=(s=>(s[s.SAMPLE_RATE=0]="SAMPLE_RATE",s[s.RESOLUTION=1]="RESOLUTION",s[s.RANGE_PN_UNIT=2]="RANGE_PN_UNIT",s[s.RANGE_MILI_UNIT=3]="RANGE_MILI_UNIT",s[s.NUM_CHANNELS=4]="NUM_CHANNELS",s[s.CONVERSION_FACTOR=5]="CONVERSION_FACTOR",s))(Re||{});function Me(s,r,o=!0){return s.getUint16(r,o)}function ci(s,r,o=!0){return s.getFloat32(r,o)}function hi(s,r,o=!0){return[s.getUint16(r,o),s.getUint16(r+2,o),s.getUint16(r+4,o),s.getUint16(r+6,o)]}var di={SAMPLE_RATE:Me,RESOLUTION:Me,RANGE_PN_UNIT:Me,RANGE_MILI_UNIT:hi,CONVERSION_FACTOR:ci},ui={SAMPLE_RATE:2,RESOLUTION:2,RANGE_PN_UNIT:2,RANGE_MILI_UNIT:8,NUM_CHANNELS:1,CONVERSION_FACTOR:4},xe=(s=>(s[s.GET_MEASUREMENT_SETTINGS=1]="GET_MEASUREMENT_SETTINGS",s[s.REQUEST_MEASUREMENT_START=2]="REQUEST_MEASUREMENT_START",s[s.REQUEST_MEASUREMENT_STOP=3]="REQUEST_MEASUREMENT_STOP",s))(xe||{}),Li=Object.keys(Re).filter(s=>isNaN(Number(s))),ue=Object.keys(U).filter(s=>isNaN(Number(s))),Di=Object.keys(xe).filter(s=>isNaN(Number(s))),$=["SUCCESS","INVALID OP CODE","INVALID MEASUREMENT TYPE","NOT SUPPORTED","INVALID LENGTH","INVALID PARAMETER","ALREADY IN STATE","INVALID RESOLUTION","INVALID SAMPLE RATE","INVALID RANGE","INVALID MTU","INVALID NUMBER OF CHANNELS","INVALID STATE","DEVICE IN CHARGER"],nt=class{device;server=void 0;PMDService=void 0;PMDCtrlChar=void 0;PMDDataChar=void 0;BattService=void 0;BattLvlChar=void 0;streaming=!1;verbose=!0;dataHandle={};timeOffset=BigInt(0);eventTimeOffset;lastECGTimestamp;lastACCTimestamp;ACCStarted=!1;ECGStarted=!1;constructor(s,r=!0){this.device=s,this.verbose=r,this.lastECGTimestamp=0,this.lastACCTimestamp=0,this.ACCStarted=!1,this.ECGStarted=!1;for(let o=0;o<ue.length;o++)this.dataHandle[ue[o]]=[]}addEventListener(s,r){this.dataHandle[s].includes(r)||this.dataHandle[s].push(r)}removeEventListener(s,r){let o=this.dataHandle[s].indexOf(r);return o>-1&&this.dataHandle[s].splice(o,1),o}clearEventListner(s){delete this.dataHandle[s],this.dataHandle[s]=[]}log(...s){this.verbose&&console.log(...s)}async init(){this.server=await this.device.gatt?.connect(),this.log(`Connecting to ${this.device.name} GATT server...`),this.PMDService=await this.server?.getPrimaryService(ri),this.log("  Got PMD Service"),this.PMDCtrlChar=await this.PMDService?.getCharacteristic(oi),this.log("    Got PMD control characteristic"),await this.PMDCtrlChar?.startNotifications(),this.log("    Start notification"),this.PMDDataChar=await this.PMDService?.getCharacteristic(li),this.log("    Got PMD data characteristic"),await this.PMDDataChar?.startNotifications(),this.log("    Start notification"),this.streaming=!1,this.BattService=await this.server?.getPrimaryService("battery_service"),this.log("  Got battery Service"),this.BattLvlChar=await this.BattService?.getCharacteristic("battery_level"),this.log("    Got battery level characteristic"),this.PMDDataChar?.addEventListener("characteristicvaluechanged",this.PMDDataHandle.bind(this))}PMDCtrlCharHandle(s){this.log(s)}PMDCtrlDataHandle(s){this.log(s)}async getBatteryLevel(){let s=await this.BattLvlChar?.readValue();return s?s.getUint8(0):0}async getPMDFeatures(){let s=await this.PMDCtrlChar?.readValue(),r=[];if(s!==void 0&&s.byteLength===17&&s.getUint8(0)===15){let o=s.getUint8(1);for(let _=0;_<ue.length;_++){let a=ue[_];o>>U[a]&1&&r.push(a)}}return r}async getSensorSettingsFromName(s){return this.getSensorSettingsFromId(U[s])}parseSensorSettings(s){if(s.getUint8(0)==240&&s.getUint8(1)==1){let r={type:U[s.getUint8(2)],error:$[s.getUint8(3)],more_frames:s.getUint8(4),settings:{}},o=5;for(;o<s.byteLength;){let _=s.getUint8(o);o+=1;let a=s.getUint8(o);o+=1;let i=Re[_];r.settings[i]=[];for(let h=0;h<a;h++)r.settings[i].push(di[i](s,o)),o+=ui[i]}return r}}async getSensorSettingsFromId(s){if(!this.streaming){let r,o=new Promise((i,h)=>{r=i}),_=i=>{let h=i?.target?.value;r(this.parseSensorSettings(h))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",_,{once:!0});let a=new Uint8Array([1,s]);return await this.PMDCtrlChar?.writeValue(a),await o}}PMDDataHandle(s){let r=s.target.value,o=r.getBigUint64(1,!0);this.timeOffset===BigInt(0)&&(this.timeOffset=o,this.eventTimeOffset=s.timeStamp+performance.timeOrigin);let _=Number(o-this.timeOffset)/1e6,a=r.getUint8(0),i=r.getUint8(9),h={type:U[a],sample_timestamp_ms:_,prev_sample_timestamp_ms:0,recv_epoch_time_ms:s.timeStamp+performance.timeOrigin,event_time_offset_ms:this.eventTimeOffset};switch(a){case 2:i==1&&(h.samples=new Int16Array(r.buffer.slice(10)),h.prev_sample_timestamp_ms=this.lastACCTimestamp,this.lastACCTimestamp=_);break;case 0:if(i===0){let n=Math.floor((r.byteLength-10)/3);h.samples=new Int32Array(n);for(let e=10;e<r.byteLength;e+=3){let t=r.getUint8(e+2)<<16|r.getUint8(e+1)<<8|r.getUint8(e);t&8388608&&(t|=4278190080),h.samples[Math.floor((e-10)/3)]=t}h.prev_sample_timestamp_ms=this.lastECGTimestamp,this.lastECGTimestamp=_}break}for(let n of this.dataHandle[U[a]])n(h)}parseCtrlReply(s){if(s.getUint8(0)===240){let r=s.getUint8(1);if(r===2||r===3){let o={type:xe[r],sensor:U[s.getUint8(2)],error:$[s.getUint8(3)],more_frames:s.getUint8(4)};return s.byteLength>5&&(o.reserved=s.getUint8(5)),o}}}async startACC(s=4,r=100,o=16){if(this.ACCStarted)return;let _,a=new Promise((t,c)=>{_=t}),i=t=>{this.log("PMDSensorSettingHandle");let c=t?.target?.value;_(this.parseCtrlReply(c))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",i,{once:!0});let h=new Uint8Array(14),n=new DataView(h.buffer);h[0]=2,h[1]=2,h[2]=2,h[3]=1,n.setUint16(4,s,!0),h[6]=0,h[7]=1,n.setUint16(8,r,!0),h[10]=1,h[11]=1,n.setUint16(12,o,!0),await this.PMDCtrlChar?.writeValue(h);let e=await a;return e?.error===$[0]&&(this.ACCStarted=!0),e}async startECG(s=130,r=14){if(this.ECGStarted)return;let o,_=new Promise((e,t)=>{o=e}),a=e=>{this.log("PMDSensorSettingHandle");let t=e?.target?.value;o(this.parseCtrlReply(t))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",a,{once:!0});let i=new Uint8Array(10),h=new DataView(i.buffer);i[0]=2,i[1]=0,i[2]=1,i[3]=1,h.setUint16(4,r,!0),i[6]=0,i[7]=1,h.setUint16(8,s,!0),await this.PMDCtrlChar?.writeValue(i);let n=await _;return n?.error===$[0]&&(this.ECGStarted=!0),n}async stopECG(){if(!this.ECGStarted)return;let s=await this.stopSensor(0);return s?.error===$[0]&&(this.ECGStarted=!1),s}async stopACC(){if(!this.ACCStarted)return;let s=await this.stopSensor(2);return s?.error===$[0]&&(this.ACCStarted=!1),s}async stopSensor(s){let r,o=new Promise((i,h)=>{r=i}),_=i=>{let h=i?.target?.value;r(this.parseCtrlReply(h))};this.PMDCtrlChar?.addEventListener("characteristicvaluechanged",_,{once:!0});let a=new Uint8Array(2);return a[0]=3,a[1]=s,await this.PMDCtrlChar?.writeValue(a),await o}};var at=["","LShoulder","RShoulder","Chest","MiddleSpine","LowerSpine","Hip","LThigh","RThigh"],fi=new Date("2000-01-01T00:00:00Z"),_i=new Date("2018-01-01T00:00:00Z"),pi=fi.valueOf(),mi=BigInt(pi)*BigInt(1e6),gi=_i.valueOf(),vi=BigInt(gi)*BigInt(1e6),rt=vi-mi,Ci=rt/BigInt(1e6),st=Number(rt-Ci*BigInt(1e6))/1e6,yi=st+Number(st);var te=5,ot=35,lt=600,fe=200,q=Math.round(130/(1e3/fe)),ct=-120,Le=120,ht=0,De=120,dt=25,ut=4,_e=130,ft=5,_t=5,Ne=1,pt=600,ie=100,Fe=4,ye=-2e3,pe=2e3,Oe=10,Pe=4;var Ge=10,mt=100,me=2.5,ge=.1,gt=4,vt=-20,He=20,Ve=1,Ct=1,Be={limitFPS:60,grid:{strokeStyle:"#484f58",fillStyle:"#000000",lineWidth:1,millisPerLine:1e3,borderVisible:!1},title:{text:"EXG raw voltage (0.7\u201340 Hz)",fontFamily:"Arial",verticalAlign:"bottom",fillStyle:"#ffffff80",fontSize:14},responsive:!1,nonRealtimeData:!0,millisPerPixel:8,scaleSmoothing:.1,tooltip:!1,minValueScale:1,maxValueScale:1},ke={limitFPS:60,minValue:ye,maxValue:pe,grid:{strokeStyle:"#484f58",fillStyle:"#000000",lineWidth:1,millisPerLine:1e3,borderVisible:!1},title:{text:"Accelerometer raw",fontFamily:"Arial",verticalAlign:"bottom",fillStyle:"#ffffff80",fontSize:14},labels:{disabled:!1},responsive:!1,nonRealtimeData:!0,millisPerPixel:8,scaleSmoothing:.1,tooltip:!1,minValueScale:1.3,maxValueScale:1.3},St={lineWidth:2,interpolation:"linear",strokeStyle:"#fbfbfbcc"},Et={lineWidth:2,interpolation:"linear",strokeStyle:"#ffdcaacc"},bt={lineWidth:2,interpolation:"linear",strokeStyle:"#dcaaffcc",fillStyle:"#f0beff99"},At={lineWidth:2,interpolation:"linear",strokeStyle:"#ff453acc"},Tt={lineWidth:2,interpolation:"linear",strokeStyle:"#32ff4bcc"},wt={lineWidth:2,interpolation:"linear",strokeStyle:"#0a84ffcc"},It={lineWidth:2,interpolation:"linear",strokeStyle:"#ff776ccc"},Mt={lineWidth:2,interpolation:"linear",strokeStyle:"#64ff7dcc"},Rt={lineWidth:2,interpolation:"linear",strokeStyle:"#3cb6ffcc"},xt={lineWidth:2,interpolation:"linear",strokeStyle:"#6effffcc"},Lt={lineWidth:2,interpolation:"linear",strokeStyle:"#ff70ffcc"},Dt={lineWidth:2,interpolation:"linear",strokeStyle:"#ffff78cc"},Nt={lineWidth:2,interpolation:"linear",strokeStyle:"#fbfbfbcc"},Ft={lineWidth:2,interpolation:"linear",strokeStyle:"#ffdcaacc"},yt={lineWidth:2,interpolation:"linear",strokeStyle:"#f0883e"},Ot={lineWidth:2,interpolation:"linear",strokeStyle:"#f778ba"},Pt={lineWidth:2,interpolation:"linear",strokeStyle:"#388afd"},Gt={lineWidth:2,interpolation:"linear",strokeStyle:"#aadcffcc"},Ht=(c=>(c[c.ECG=0]="ECG",c[c.PPG=1]="PPG",c[c.ACC=2]="ACC",c[c.PPI=3]="PPI",c[c.GYRO=5]="GYRO",c[c.MAGNETOMETER=6]="MAGNETOMETER",c[c.SDK_MODE=9]="SDK_MODE",c[c.LOCATION=10]="LOCATION",c[c.PRESSURE=11]="PRESSURE",c[c.TEMPERATURE=12]="TEMPERATURE",c))(Ht||{}),Oi=Object.keys(Ht).filter(s=>isNaN(Number(s)));var ze=new H.CalcCascades;async function Wt(s,r){await new ve(s,r).init()}var ve=class s{static polarRowID=0;static polarVisRows=[];device;polarH10;deviceName;battLvl;parent;polarSensorDiv;optionDiv;deviceInfoDiv;nameDiv;loadingDiv;disconnectDiv;deviceNameDiv;battLvlDiv;dataInfo;bodypartLabel;bodypartSelectDiv;bodypartSelect;dataCtrl;extraDataCtrl;rowOrder;visContainerDiv;ECGCtrlDiv;ACCCtrlDiv;order;ECG_FILTER_MIN=ct;ECG_FILTER_MAX=Le;ECG_RMS_MIN=ht;ECG_RMS_MAX=De;ACC_MIN=ye;ACC_MAX=pe;ACC_FILTER_MIN=vt;ACC_FILTER_MAX=He;disBtn;orderUpBtn;orderDownBtn;show3DBtn;filterConfigBtn;ECGFormSelect;ECGSwitchInput;ECGDropDown;ACCFormSelect;ACCSwitchInput;ACCDropDown;ECGDiv=void 0;ACCDiv=void 0;ecg_resize=void 0;ecg_chart=void 0;ecg_resize_observer=void 0;ecg_canvas=void 0;ecg_filter_iir_coef=void 0;ecg_ts=void 0;ecg_filter_info;ecg_filter_iir=void 0;ecg_filter_ts=void 0;ecg_rms_ts=void 0;ecg_ss_win=void 0;ecg_ss_win_i=0;ecg_ss=0;acc_resize=void 0;acc_chart=void 0;acc_resize_observer=void 0;acc_canvas=void 0;acc_x_ts=void 0;acc_y_ts=void 0;acc_z_ts=void 0;acc_mag_ts=void 0;acc_lp_info;acc_lp_iir_coef=void 0;acc_x_lp_iir=void 0;acc_y_lp_iir=void 0;acc_z_lp_iir=void 0;acc_mag_lp_iir=void 0;acc_x_lp_ts=void 0;acc_y_lp_ts=void 0;acc_z_lp_ts=void 0;acc_mag_lp_ts=void 0;acc_rho_ts=void 0;acc_phi_ts=void 0;acc_theta_ts=void 0;acc_filter_info;acc_filter_iir_coef=void 0;acc_x_filter_iir=void 0;acc_y_filter_iir=void 0;acc_z_filter_iir=void 0;acc_mag_filter_iir=void 0;acc_x_filter_ts=void 0;acc_y_filter_ts=void 0;acc_z_filter_ts=void 0;acc_mag_filter_ts=void 0;ecg_rms_window_ms=fe;constructor(r,o){if(o.name===void 0)throw new Error("Invalid Bluetooth device! Missing name");this.parent=r,this.device=o,this.deviceName=this.device?.name?.substring(10)||"",this.ecg_rms_window_ms=fe,this.ecg_filter_info={type:"highpass",order:ut,characteristic:"butterworth",Fs:_e,Fc:dt,Fl:void 0,Fh:void 0,BW:void 0,gain:void 0,preGain:!1},this.acc_lp_info={type:"lowpass",order:Pe,characteristic:"butterworth",Fs:ie,Fc:Oe,Fl:void 0,Fh:void 0,BW:void 0,gain:void 0,preGain:!1},this.acc_filter_info={type:"bandpass",order:gt,characteristic:"butterworth",Fs:ie,Fc:Math.sqrt(ge*me),Fl:ge,Fh:me,BW:me-ge,gain:void 0,preGain:!1}}disconnectPolarH10=async(r=void 0)=>{this.removeSelf(),this.ecg_chart!==void 0&&this.ecg_chart.stop(),this.ecg_resize_observer!==void 0&&this.ecg_resize_observer.disconnect(),this.ECGDiv!==void 0&&(this.visContainerDiv?.removeChild(this.ECGDiv),this.polarH10.removeEventListener("ECG",this.newECGCallback),await this.stopECG()),this.resetECG(),this.acc_chart!==void 0&&this.acc_chart.stop(),this.acc_resize_observer!==void 0&&this.acc_resize_observer.disconnect(),this.ACCDiv!==void 0&&(this.visContainerDiv?.removeChild(this.ACCDiv),this.polarH10.removeEventListener("ACC",this.newACCCallback),await this.stopAcc()),this.resetACC(),this.disconnectPolarH10IfAlone()};async init(){try{await this.initPolarH10(),await this.initDeviceInfo(),await this.initDeviceGraphCtrl(),s.polarRowID+=1,s.polarVisRows.push(this)}catch(r){this.disconnectPolarH10(),alert(r)}}moveUp=r=>{this.order-=1,this.polarSensorDiv.style.order=this.order.toString();let o=s.polarVisRows[this.order];o.order+=1,o.polarSensorDiv.style.order=o.order.toString(),s.polarVisRows[this.order]=this,s.polarVisRows[o.order]=o,this.order===0?(this.orderUpBtn.disabled=!0,this.orderDownBtn.disabled=!1,o.orderUpBtn.disabled=!1):this.order===s.polarVisRows.length-2&&(this.orderDownBtn.disabled=!1),o.order===s.polarVisRows.length-1&&(o.orderDownBtn.disabled=!0,o.orderUpBtn.disabled=!1)};moveDown=r=>{this.order+=1,this.polarSensorDiv.style.order=this.order.toString();let o=s.polarVisRows[this.order];o.order-=1,o.polarSensorDiv.style.order=o.order.toString(),s.polarVisRows[this.order]=this,s.polarVisRows[o.order]=o,this.order===s.polarVisRows.length-1?(this.orderUpBtn.disabled=!1,this.orderDownBtn.disabled=!0,o.orderDownBtn.disabled=!1):this.order===1&&(this.orderUpBtn.disabled=!1),o.order===0&&(o.orderDownBtn.disabled=!1,o.orderUpBtn.disabled=!0)};newECGCallback=r=>{if(this.ecg_ts!==void 0&&this.ecg_rms_ts!==void 0&&this.ecg_filter_ts!==void 0&&r.prev_sample_timestamp_ms>0&&r.samples!==void 0&&this.ecg_filter_iir!==void 0){let o=(r.sample_timestamp_ms-r.prev_sample_timestamp_ms)/r.samples.length,_=r.event_time_offset_ms+r.prev_sample_timestamp_ms+o;for(let a=0;a<r.samples.length;a++){let i=a*o,h=_+i,n=r.samples[a],e=this.ecg_filter_iir.singleStep(n),t=e*e,c;this.ecg_ss_win!==void 0&&(this.ecg_ss+=t,this.ecg_ss_win_i<q?(this.ecg_ss_win[this.ecg_ss_win_i]=t,this.ecg_ss_win_i++):(this.ecg_ss-=this.ecg_ss_win[0],this.ecg_ss_win.set(this.ecg_ss_win.subarray(1)),this.ecg_ss_win[q-1]=t),this.ecg_ss_win_i===q&&(c=Math.sqrt(this.ecg_ss/q))),setTimeout(()=>{this.ecg_ts?.append(h,n),this.ecg_filter_ts?.append(h,e),c!==void 0&&this.ecg_rms_ts?.append(h,c)},i)}}};newACCCallback=r=>{if(r.prev_sample_timestamp_ms>0&&r.samples!==void 0&&this.acc_x_ts!==void 0&&this.acc_y_ts!==void 0&&this.acc_z_ts!==void 0&&this.acc_mag_ts!==void 0&&this.acc_x_lp_ts!==void 0&&this.acc_y_lp_ts!==void 0&&this.acc_z_lp_ts!==void 0&&this.acc_mag_lp_ts!==void 0&&this.acc_rho_ts!==void 0&&this.acc_phi_ts!==void 0&&this.acc_theta_ts!==void 0&&this.acc_x_filter_ts!==void 0&&this.acc_y_filter_ts!==void 0&&this.acc_z_filter_ts!==void 0&&this.acc_mag_filter_ts!==void 0&&this.acc_x_lp_iir!==void 0&&this.acc_y_lp_iir!==void 0&&this.acc_z_lp_iir!==void 0&&this.acc_mag_lp_iir!==void 0&&this.acc_x_filter_iir!==void 0&&this.acc_y_filter_iir!==void 0&&this.acc_z_filter_iir!==void 0&&this.acc_mag_filter_iir!==void 0){let o=r.samples.length/3,_=(r.sample_timestamp_ms-r.prev_sample_timestamp_ms)/o,a=r.event_time_offset_ms+r.prev_sample_timestamp_ms+_;for(let i=0;i<r.samples.length;i+=3){let n=Math.floor(i/3)*_,e=a+n,t=-r.samples[i],c=-r.samples[i+1],u=r.samples[i+2],d=this.acc_x_lp_iir.singleStep(c),v=this.acc_y_lp_iir.singleStep(t),S=this.acc_z_lp_iir.singleStep(u),f=d*d,T=v*v,I=S*S,A=Math.atan(d/Math.sqrt(T+I))/Math.PI*180,E=Math.atan(v/Math.sqrt(f+I))/Math.PI*180,M=Math.atan(Math.sqrt(f+T)/S)/Math.PI*180,p=Math.sqrt(c*c+t*t+u*u),m=this.acc_mag_lp_iir.singleStep(p),l=this.acc_x_filter_iir.singleStep(c),R=this.acc_y_filter_iir.singleStep(t),g=this.acc_z_filter_iir.singleStep(u),C=this.acc_mag_filter_iir.singleStep(p);setTimeout(()=>{this.acc_x_ts?.append(e,c),this.acc_y_ts?.append(e,t),this.acc_z_ts?.append(e,u),this.acc_mag_ts?.append(e,p),this.acc_rho_ts?.append(e,A),this.acc_phi_ts?.append(e,E),this.acc_theta_ts?.append(e,M),this.acc_x_lp_ts?.append(e,d),this.acc_y_lp_ts?.append(e,v),this.acc_z_lp_ts?.append(e,S),this.acc_mag_lp_ts?.append(e,m),this.acc_x_filter_ts?.append(e,l),this.acc_y_filter_ts?.append(e,R),this.acc_z_filter_ts?.append(e,g),this.acc_mag_filter_ts?.append(e,C)},n)}}};changeECGGraph=r=>{if(this.ecg_chart!==void 0&&this.ecg_ts!==void 0&&this.ecg_filter_ts!==void 0&&this.ecg_rms_ts!==void 0){let o=r.target.selectedIndex;switch(this.ecg_chart.stop(),o){case 0:this.ecg_chart.configureTimeSeries([this.ecg_ts],[St],[F("\u2015 Voltage (\u03BCV)",10,0)],!1,void 0,void 0,1,1,Be.title?.text||"EXG raw voltage (0.7\u201340 Hz)",!1,[],!0,!1,!0);break;case 1:this.ecg_chart.configureTimeSeries([this.ecg_filter_ts],[Et],[F("\u2015 Voltage (\u03BCV)",10,0)],!0,this.ECG_FILTER_MIN,this.ECG_FILTER_MAX,1,1,`${Xt(this.ecg_filter_info)} on EXG raw`,!1,[],!0,!0,!0);break;case 2:this.ecg_chart.configureTimeSeries([this.ecg_rms_ts],[bt],[F("\u2015 RMS voltage (\u03BCV)",10,0)],!0,this.ECG_RMS_MIN,this.ECG_RMS_MAX,1,1,`RMS using ${this.ecg_rms_window_ms}ms window on filtered EXG`,!1,[],!0,!0,!0);break}this.ecg_chart.start()}};changeACCGraph=r=>{if(this.acc_chart!==void 0&&this.acc_x_ts!==void 0&&this.acc_y_ts!==void 0&&this.acc_z_ts!==void 0&&this.acc_x_lp_ts!==void 0&&this.acc_y_lp_ts!==void 0&&this.acc_z_lp_ts!==void 0&&this.acc_mag_lp_ts!==void 0&&this.acc_rho_ts!==void 0&&this.acc_phi_ts!==void 0&&this.acc_theta_ts!==void 0&&this.acc_mag_ts!==void 0&&this.acc_x_filter_ts!==void 0&&this.acc_y_filter_ts!==void 0&&this.acc_z_filter_ts!==void 0&&this.acc_mag_filter_ts!==void 0){let o=r.target.selectedIndex,_="";switch(this.acc_chart.stop(),o){case 0:this.acc_chart.configureTimeSeries([this.acc_x_ts,this.acc_y_ts,this.acc_z_ts,this.acc_mag_ts],[At,Tt,wt,Nt],[F("\u2015 X-axis (mG)",10,0),F("\u2015 Y-axis (mG)",10,0),F("\u2015 Z-axis (mG)",10,0),F("\u2015 Accelerometer magnitude (mG)",10,0)],!0,this.ACC_MIN,this.ACC_MAX,1,1,ke.title?.text||"Accelerometer raw",!1,[],!0,!0,!0);break;case 1:this.acc_chart.configureTimeSeries([this.acc_x_lp_ts,this.acc_y_lp_ts,this.acc_z_lp_ts,this.acc_mag_lp_ts],[It,Mt,Rt,Ft],[F("\u2015 X-axis (mG)",10,0),F("\u2015 Y-axis (mG)",10,0),F("\u2015 Z-axis (mG)",10,0),F("\u2015 Accelerometer magnitude (mG)",10,0)],!0,this.ACC_MIN,this.ACC_MAX,1,1,`Lowpass (${Oe}Hz ${Pe}th order Butterworth) on accelerometer raw`,!1,[],!0,!0,!0);break;case 2:this.acc_chart.configureTimeSeries([this.acc_rho_ts,this.acc_phi_ts,this.acc_theta_ts],[xt,Lt,Dt],[F("\u2015 \u03C1\xB0 \u2220(X-axis, Horizon)",10,0),F("\u2015 \u03D5\xB0 \u2220(Y-axis, Horizon)",10,0),F("\u2015 \u03B8\xB0 \u2220(Z-axis, -Gravity)",10,0)],!1,-120,120,1.3,1.3,"Tilt angle [-90\xB0, 90\xB0] from lowpass on accelerometer raw",!1,[{value:90,color:"#ffffff7f",lineWidth:1},{value:-90,color:"#ffffff7f",lineWidth:1}],!0,!0,!0);break;case 3:this.acc_chart.configureTimeSeries([this.acc_x_filter_ts,this.acc_y_filter_ts,this.acc_z_filter_ts,this.acc_mag_filter_ts],[yt,Ot,Pt,Gt],[F("\u2015 X-axis (mG)",10,0),F("\u2015 Y-axis (mG)",10,0),F("\u2015 Z-axis (mG)",10,0),F("\u2015 Accelerometer magnitude (mG)",10,0)],!0,this.ACC_FILTER_MIN,this.ACC_FILTER_MAX,1,1,`${Xt(this.acc_filter_info)} on accelerometer raw magnitude`,!1,[],!0,!0,!0);break}this.acc_chart.start()}};onWheelECG=r=>{if(this.ecg_chart!==void 0&&!this.ecg_chart.yScaleIsAuto()){let o=r.deltaY<0?Ne:-Ne;switch(this.ECGFormSelect?.selectedIndex){case 0:break;case 1:this.ECG_FILTER_MAX!==void 0&&this.ECG_FILTER_MIN!==void 0&&(r.preventDefault(),this.ECG_FILTER_MAX+=o,this.ECG_FILTER_MIN-=o,(this.ECG_FILTER_MAX<ft||this.ECG_FILTER_MAX<=this.ECG_FILTER_MIN||this.ECG_FILTER_MAX/te>Le)&&(this.ECG_FILTER_MAX-=o,this.ECG_FILTER_MIN+=o),this.ecg_chart.options.minValue=this.ECG_FILTER_MIN,this.ecg_chart.options.maxValue=this.ECG_FILTER_MAX);break;case 2:if(this.ECG_RMS_MAX!==void 0){r.preventDefault(),this.ECG_RMS_MAX+=o,(this.ECG_RMS_MAX<_t||this.ECG_RMS_MAX<=this.ECG_RMS_MIN||this.ECG_RMS_MAX/te>De)&&(this.ECG_RMS_MAX-=o),this.ecg_chart.options.minValue=0,this.ecg_chart.options.maxValue=this.ECG_RMS_MAX;break}}}};onWheelACC=r=>{if(this.acc_chart!==void 0&&!this.acc_chart.yScaleIsAuto()){let o=0;switch(this.ACCFormSelect?.selectedIndex){case 0:case 1:this.ACC_MAX!==void 0&&this.ACC_MIN!==void 0&&(r.preventDefault(),o=r.deltaY<0?Ge:-Ge,this.ACC_MAX+=o,this.ACC_MIN-=o,(this.ACC_MAX<mt||this.ACC_MAX<=this.ACC_MIN||this.ACC_MAX/te>pe)&&(this.ACC_MAX-=o,this.ACC_MIN+=o),this.acc_chart.options.minValue=this.ACC_MIN,this.acc_chart.options.maxValue=this.ACC_MAX);break;case 2:break;case 3:this.ACC_FILTER_MAX!==void 0&&this.ACC_FILTER_MIN!==void 0&&(r.preventDefault(),o=r.deltaY<0?Ve:-Ve,this.ACC_FILTER_MAX+=o,this.ACC_FILTER_MIN-=o,(this.ACC_FILTER_MAX<Ct||this.ACC_FILTER_MAX<=this.ACC_MIN||this.ACC_FILTER_MAX/te>He)&&(this.ACC_FILTER_MAX-=o,this.ACC_FILTER_MIN+=o),this.acc_chart.options.minValue=this.ACC_FILTER_MIN,this.acc_chart.options.maxValue=this.ACC_FILTER_MAX);break}}};onToggleECG=async r=>{if(this.ACCSwitchInput.disabled=!0,r.target?.checked){let o;this.ACCDiv===void 0?o="full-width":(o="half-width",this.ACCDiv.classList.remove("full-width"),this.ACCDiv.classList.add("half-width"),this.visContainerDiv.removeChild(this.ACCDiv)),this.ECGDiv=L("ECGDiv",this.visContainerDiv,["float-left","almost-full-height",o]),this.ECGDiv.addEventListener("wheel",this.onWheelECG),this.ACCDiv!==void 0&&this.visContainerDiv.appendChild(this.ACCDiv),this.ecg_canvas=kt("ecg_canvas",this.ECGDiv),this.ecg_chart=new ee(Be),this.ecg_ts=new y.TimeSeries,this.ecg_rms_ts=new y.TimeSeries,this.ecg_filter_ts=new y.TimeSeries,this.ecg_chart.streamTo(this.ecg_canvas,lt),this.ecg_ss_win=new Float64Array(q),this.ecg_ss_win_i=0,this.ecg_ss=0,this.ecg_resize=Vt(this.ecg_chart,1,1),this.ecg_resize_observer=new ResizeObserver(_=>{for(let a of _)a.target===this.ECGDiv&&this.ecg_resize!==void 0&&this.ecg_resize()}),this.ecg_resize_observer.observe(this.ECGDiv),this.ecg_filter_iir_coef=ze[this.ecg_filter_info.type](this.ecg_filter_info),this.ecg_filter_iir=(0,H.IirFilter)(this.ecg_filter_iir_coef),this.ecg_resize(),this.ECGFormSelect!==void 0&&(this.ECGFormSelect.disabled=!1,this.ECGFormSelect.selectedIndex=0),await this.startECG(_e),this.changeECGGraph({target:{selectedIndex:0}})}else this.ECGDiv!==void 0&&this.ecg_canvas!==void 0&&this.ecg_chart!==void 0&&(this.ecg_chart.stop(),this.ECGFormSelect!==void 0&&(this.ECGFormSelect.disabled=!0,this.ECGFormSelect.selectedIndex=0),this.ECGDiv.contains(this.ecg_canvas)&&(this.ACCDiv?.classList.remove("half-width"),this.ACCDiv?.classList.add("full-width"),await this.stopECG(),this.visContainerDiv.removeChild(this.ECGDiv),this.ecg_resize_observer?.disconnect(),this.polarH10.removeEventListener("ECG",this.newECGCallback),this.resetECG()));this.ACCSwitchInput&&(this.ACCSwitchInput.disabled=!1)};onToggleACC=async r=>{if(this.ECGSwitchInput&&(this.ECGSwitchInput.disabled=!0),r.target?.checked){let o;this.ECGDiv===void 0?o="full-width":(o="half-width",this.ECGDiv.classList.remove("full-width"),this.ECGDiv.classList.add("half-width")),this.ACCDiv=L("ACCDiv",this.visContainerDiv,["float-left","almost-full-height",o]),this.ACCDiv.addEventListener("wheel",this.onWheelACC),this.acc_canvas=kt("acc_canvas",this.ACCDiv),this.acc_chart=new ee(ke),this.acc_x_ts=new y.TimeSeries,this.acc_y_ts=new y.TimeSeries,this.acc_z_ts=new y.TimeSeries,this.acc_mag_ts=new y.TimeSeries,this.acc_x_lp_ts=new y.TimeSeries,this.acc_y_lp_ts=new y.TimeSeries,this.acc_z_lp_ts=new y.TimeSeries,this.acc_mag_lp_ts=new y.TimeSeries,this.acc_rho_ts=new y.TimeSeries,this.acc_phi_ts=new y.TimeSeries,this.acc_theta_ts=new y.TimeSeries,this.acc_x_filter_ts=new y.TimeSeries,this.acc_y_filter_ts=new y.TimeSeries,this.acc_z_filter_ts=new y.TimeSeries,this.acc_mag_filter_ts=new y.TimeSeries,this.acc_chart.streamTo(this.acc_canvas,pt),this.acc_resize=Vt(this.acc_chart,1,1),this.acc_resize_observer=new ResizeObserver(_=>{for(let a of _)a.target===this.ACCDiv&&this.acc_resize!==void 0&&this.acc_resize()}),this.acc_resize_observer.observe(this.ACCDiv),this.acc_lp_iir_coef=ze[this.acc_lp_info.type](this.acc_lp_info),this.acc_x_lp_iir=(0,H.IirFilter)(this.acc_lp_iir_coef),this.acc_y_lp_iir=(0,H.IirFilter)(this.acc_lp_iir_coef),this.acc_z_lp_iir=(0,H.IirFilter)(this.acc_lp_iir_coef),this.acc_mag_lp_iir=(0,H.IirFilter)(this.acc_lp_iir_coef),this.acc_filter_iir_coef=ze[this.acc_filter_info.type](this.acc_filter_info),this.acc_x_filter_iir=(0,H.IirFilter)(this.acc_filter_iir_coef),this.acc_y_filter_iir=(0,H.IirFilter)(this.acc_filter_iir_coef),this.acc_z_filter_iir=(0,H.IirFilter)(this.acc_filter_iir_coef),this.acc_mag_filter_iir=(0,H.IirFilter)(this.acc_filter_iir_coef),this.acc_resize(),this.ACCFormSelect!==void 0&&(this.ACCFormSelect.disabled=!1,this.ACCFormSelect.selectedIndex=0),await this.startACC(Fe,ie),this.changeACCGraph({target:{selectedIndex:0}}),this.show3DBtn.disabled=!1}else this.show3DBtn.disabled=!0,this.ACCDiv!==void 0&&this.acc_canvas!==void 0&&this.acc_chart!==void 0&&(this.acc_chart.stop(),this.ACCFormSelect!==void 0&&(this.ACCFormSelect.disabled=!0,this.ACCFormSelect.selectedIndex=0),this.ACCDiv.contains(this.acc_canvas)&&this.ACCDiv.removeChild(this.acc_canvas),this.ECGDiv?.classList.remove("half-width"),this.ECGDiv?.classList.add("full-width"),this.polarH10.removeEventListener("ACC",this.newACCCallback),this.visContainerDiv.removeChild(this.ACCDiv),this.acc_resize_observer?.disconnect(),await this.stopAcc(),this.resetACC());this.ECGSwitchInput&&(this.ECGSwitchInput.disabled=!1)};removeSelf(){this.parent.contains(this.polarSensorDiv)&&this.parent.removeChild(this.polarSensorDiv);let r=s.polarVisRows.indexOf(this);r>-1&&(s.polarVisRows.splice(r,1),s.polarVisRows.length>0&&(r===s.polarVisRows.length?s.polarVisRows[r-1].orderDownBtn.disabled=!0:r===0&&(s.polarVisRows[0].orderUpBtn.disabled=!0),s.reOrderRows()))}static reOrderRows(){for(let r=0;r<s.polarVisRows.length;r++){let o=s.polarVisRows[r];o.order=r,o.polarSensorDiv.style.order=r.toString()}}async initPolarH10(){this.polarSensorDiv=L("polarSensorDiv",this.parent,["polar-sensor-row","flexbox"]),this.optionDiv=L("optionDiv",this.polarSensorDiv,["polar-sensor-left-panel","center"]),this.order=s.polarVisRows.length,this.polarSensorDiv.style.order=this.order.toString(),this.nameDiv=L("device-name-batt",this.optionDiv,["center","flexbox"],`Conneting ${this.deviceName}...`),this.loadingDiv=L("ConnectLoading",this.optionDiv,["loading","loading-lg","full-width","flexbox"]),await this.initPolarH10IfUnique()}includesDuplicate(r="device",o=void 0){let _=-1;if(o!==void 0)for(let a=0;a<s.polarVisRows.length;a++){let i=s.polarVisRows[a];if(i!==this&&i[r]===this[r]&&o(i)){_=a;break}}else for(let a=0;a<s.polarVisRows.length;a++){let i=s.polarVisRows[a];if(i!==this&&i[r]===this[r]){_=a;break}}return _}static includesDuplicate(r,o="device",_=void 0){let a=-1;if(_!==void 0)for(let i=0;i<s.polarVisRows.length;i++){let h=s.polarVisRows[i];if(h!==r&&h[o]===r[o]&&_(h)){a=i;break}}else for(let i=0;i<s.polarVisRows.length;i++){let h=s.polarVisRows[i];if(h!==r&&h[o]===r[o]){a=i;break}}return a}disconnectPolarH10IfAlone(){this.includesDuplicate("device")===-1&&this.device.gatt?.disconnect()}async initPolarH10IfUnique(){let r=this.includesDuplicate("device");if(r<0)try{this.polarH10=new nt(this.device),await this.polarH10.init()}catch(o){throw console.log(o),new Error("polarH10 device initialization failed!")}else this.polarH10=s.polarVisRows[r].polarH10}resetECG(){this.ecg_canvas=void 0,this.ECGDiv=void 0,this.ecg_resize=void 0,this.ecg_ss_win=void 0,this.ecg_chart=void 0,this.ecg_ts=void 0,this.ecg_filter_ts=void 0,this.ecg_rms_ts=void 0,this.ecg_resize_observer=void 0,this.ecg_filter_iir_coef=void 0,this.ecg_filter_iir=void 0,this.ecg_ss_win_i=0,this.ecg_ss=0}resetACC(){this.ACCDiv=void 0,this.acc_resize=void 0,this.acc_canvas=void 0,this.acc_chart=void 0,this.acc_x_ts=void 0,this.acc_y_ts=void 0,this.acc_z_ts=void 0,this.acc_resize_observer=void 0,this.acc_lp_iir_coef=void 0,this.acc_filter_iir_coef=void 0,this.acc_x_lp_iir=void 0,this.acc_y_lp_iir=void 0,this.acc_z_lp_iir=void 0,this.acc_mag_lp_iir=void 0,this.acc_x_lp_ts=void 0,this.acc_y_lp_ts=void 0,this.acc_z_lp_ts=void 0,this.acc_rho_ts=void 0,this.acc_phi_ts=void 0,this.acc_theta_ts=void 0,this.acc_mag_ts=void 0}async initDeviceInfo(){this.deviceInfoDiv=L("deviceInfoDiv",this.optionDiv,["device-info"]),this.disconnectDiv=L("disconnectDiv",void 0,["flexbox","disconnect"]),this.disBtn=ne("delete","distBtn",this.disconnectDiv,!1,this.disconnectPolarH10,["btn","btn-primary","btn-sm","s-circle"]),Z(this.disBtn,"disconnect","top"),this.battLvl=await this.polarH10.getBatteryLevel(),this.optionDiv.removeChild(this.loadingDiv),this.optionDiv.removeChild(this.nameDiv),this.optionDiv.classList.remove("center"),this.nameDiv.textContent="",this.nameDiv.classList.add("flex"),this.deviceNameDiv=L("devicename",this.nameDiv,["flexbox"],this.deviceName);let r;this.battLvl>ot?r=`\u{1F50B}${this.battLvl}%`:r=`\u{1FAAB}${this.battLvl}%`,this.battLvlDiv=L("battLvl",this.nameDiv,["flexbox","small-mid-text"],r),this.nameDiv.classList.add("flexbox"),this.deviceInfoDiv.appendChild(this.disconnectDiv),this.deviceInfoDiv.appendChild(this.nameDiv),this.optionDiv.appendChild(this.deviceInfoDiv),this.dataInfo=L("dataInfo",this.deviceInfoDiv,["data-info"]),this.extraDataCtrl=L("extraDataCtrl",this.optionDiv,["extra-data-ctrl","center"]),this.filterConfigBtn=ne("settings","filterConfigBtn",this.extraDataCtrl,!0,void 0,["btn","btn-sm"]),Z(this.filterConfigBtn,"settings, work-in-progress","left"),this.show3DBtn=ne("view_in_ar","show3DBtn",this.extraDataCtrl,!0,void 0,["btn","btn-sm"]),this.show3DBtn.disabled=!0,Z(this.show3DBtn,"3D Tilt, work-in-progress","left"),this.rowOrder=L("rowOrder",this.optionDiv,["row-order"]),this.orderUpBtn=ne("arrow-up","orderUpBtn",this.rowOrder,!1,this.moveUp,["btn","btn-primary","btn-sm"]),Z(this.orderUpBtn,"Move up","right"),this.orderUpBtn.disabled=s.polarVisRows.length<1,Z(this.orderUpBtn,"Move up","right"),this.orderDownBtn=ne("arrow-down","orderDownBtn",this.rowOrder,!1,this.moveDown,["btn","btn-primary","btn-sm"]),Z(this.orderDownBtn,"Move down","right"),this.orderDownBtn.disabled=!0,s.polarVisRows.length>0&&(s.polarVisRows[s.polarVisRows.length-1].orderDownBtn.disabled=!1),this.bodypartLabel=L("bodypartLabel",this.dataInfo,["bodypart-text"],"Bodypart:"),this.bodypartSelectDiv=L("bodypartSelectDiv",this.dataInfo,["bodypart-select"]),this.bodypartSelect=Ue("bodypartSelect",this.bodypartSelectDiv,["form-select","dark-select","select-sm","almost-full-width"],"",at,X),this.dataCtrl=L("dataCtrl",this.optionDiv,["data-ctrl"]),this.visContainerDiv=L("visContainer",this.polarSensorDiv,["visContainer"])}async initDeviceGraphCtrl(){this.ECGCtrlDiv=L("ECGCtrlDiv",this.dataCtrl,["half-width"]);let r=Bt("EXG",this.onToggleECG);this.ECGCtrlDiv.appendChild(r),this.ECGSwitchInput=r.children.item(0),this.ECGDropDown=L("ECGDropDownDiv",this.ECGCtrlDiv,["form-group"]),this.generateECGFormSelect(),this.ACCCtrlDiv=L("ACCCtrlDiv",this.dataCtrl,["half-width"]);let o=Bt("ACC",this.onToggleACC);this.ACCCtrlDiv.appendChild(o),this.ACCSwitchInput=o.children.item(0),this.ACCDropDown=L("ACCDropDownDiv",this.ACCCtrlDiv,["form-group"]),this.generateACCFormSelect()}generateECGFormSelect(r=0,o=!0){this.ECGFormSelect!==void 0&&this.ECGFormSelect.parentElement?.removeChild(this.ECGFormSelect),this.ECGFormSelect=Ue("ECGFormSelect",this.ECGDropDown,["form-select","dark-select","select-sm","almost-full-width"],"",["Raw",We(this.ecg_filter_info),"RMS"]),this.ECGFormSelect.selectedIndex=r,this.ECGFormSelect.onchange=this.changeECGGraph,this.ECGFormSelect.disabled=o}generateACCFormSelect(r=0,o=!0){this.ACCFormSelect!==void 0&&this.ACCFormSelect.parentElement?.removeChild(this.ACCFormSelect),this.ACCFormSelect=Ue("ACCFormSelect",this.ACCDropDown,["form-select","dark-select","select-sm","almost-full-width"],"",["Raw",We(this.acc_lp_info),"Tilt",We(this.acc_filter_info)]),this.ACCFormSelect.selectedIndex=r,this.ACCFormSelect.onchange=this.changeACCGraph,this.ACCFormSelect.disabled=o}async startECG(r=_e,o=!0){if(this.includesDuplicate("device",zt)<0)try{let a=await this.polarH10.startECG(r);a?.error==="SUCCESS"||a?.error==="ALREADY IN STATE"?o&&this.polarH10.addEventListener("ECG",this.newECGCallback):(console.log(a),this.disconnectPolarH10())}catch(a){alert(a),this.disconnectPolarH10()}else this.polarH10.addEventListener("ECG",this.newECGCallback)}async stopECG(){if(this.includesDuplicate("device",zt)<0)try{let o=await this.polarH10.stopECG();o&&console.log(o)}catch(o){console.log(o),alert(o)}}async startACC(r=Fe,o=ie,_=!0){if(this.includesDuplicate("device",Ut)<0)try{let i=await this.polarH10.startACC(r,o);i?.error==="SUCCESS"||i?.error==="ALREADY IN STATE"?_&&this.polarH10.addEventListener("ACC",this.newACCCallback):(console.log(i),this.disconnectPolarH10())}catch(i){alert(i),this.disconnectPolarH10()}else this.polarH10.addEventListener("ACC",this.newACCCallback)}async stopAcc(){if(this.includesDuplicate("device",Ut)<0)try{let o=await this.polarH10.stopACC();o&&console.log(o)}catch(o){console.log(o),alert(o)}}ECGIsOn(){return this.ECGDiv!==void 0}ACCIsOn(){return this.ACCDiv!==void 0}};function Vt(s,r,o,_=!1){return()=>{let i=s.canvas,h=i.parentNode,n=h.offsetWidth,e=h.offsetHeight,t=n*r,c=e*o;i.width=t-5,i.height=c,_&&console.log(`Resize at ${new Date().valueOf()} parent: ${h.id} ${h.offsetWidth} ${i.width} ${h.offsetHeight} ${i.height}`)}}function Bt(s,r,o=X){let _=document.createElement("label");_.setAttribute("class","form-switch"),_.classList.add("label-sm");let a=document.createElement("input");a.id=`${s}-onoff-${o()}`,a.type="checkbox",a.addEventListener("change",r),a.classList.add("input-sm");let i=document.createElement("i");return i.classList.add("form-icon"),_.textContent=s,_.appendChild(a),_.appendChild(i),_}function Ue(s,r=void 0,o=[],_="",a=[],i=X){let h=document.createElement("select");return Ye(h,s,r,o,_,i),Si(h,a,i),h}function Si(s,r,o=X){for(let _=0;_<r.length;_++){let a=r[_],i=document.createElement("option");i.id=`${s.id}-${_}-${o()}`,i.textContent=a,s.appendChild(i)}}function L(s,r=void 0,o=[],_="",a=X){let i=document.createElement("div");return Ye(i,s,r,o,_,a),i}function kt(s,r=void 0,o=[],_="",a=X){let i=document.createElement("canvas");return Ye(i,s,r,o,_,a),i}function Ye(s,r,o=void 0,_=[],a="",i=X){return s.id=`${r}-${i()}`,o&&o.appendChild(s),_.length>0&&s.classList.add(..._),a.length>0&&(s.textContent=a),s}function X(){return ve.polarRowID}function zt(s){return s.ECGDiv!==void 0}function Ut(s){return s.ACCDiv!==void 0}function Z(s,r,o="top"){s.setAttribute("data-tooltip",r),s.classList.add("tooltip",`tooltip-${o}`)}function ne(s,r=void 0,o=void 0,_=!1,a=void 0,i=[],h=X){let n=document.createElement("button");r&&(n.id=`${r}-${h()}`),n.classList.add("flexbox","center");let e=document.createElement("i");return _?(e.classList.add("material-icons"),e.textContent=s):e.classList.add("icon",`icon-${s}`),n.appendChild(e),i.length>0&&n.classList.add(...i),a&&(n.onclick=a),o&&o.appendChild(n),n}function Xe(s){return typeof s!="string"||s.length===0?s:s.charAt(0).toUpperCase()+s.slice(1)}function Xt(s,r=!0){let o="";return s.type==="lowpass"||s.type==="highpass"?o=`${s.type} (${Number.isInteger(s.Fc)?s.Fc:s.Fc?.toFixed(1)}Hz ${s.order} order ${Xe(s.characteristic)})`:o=`bandpass (${Number.isInteger(s.Fl)?s.Fl:s.Fl?.toFixed(1)}-${Number.isInteger(s.Fh)?s.Fh:s.Fh?.toFixed(1)}Hz ${s.order} order ${Xe(s.characteristic)})`,r&&(o=Xe(o)),o}function We(s){let r="";return s.type==="lowpass"||s.type==="highpass"?r=`${Number.isInteger(s.Fc)?s.Fc:s.Fc?.toFixed(1)}Hz ${s.type}`:r=`${Number.isInteger(s.Fl)?s.Fl:s.Fl?.toFixed(1)}-${Number.isInteger(s.Fh)?s.Fh:s.Fh?.toFixed(1)}Hz ${s.type}`,r}var se=document.createElement("div");se.id="webapp_container";se.classList.add("container");document.body.appendChild(se);var ae=document.createElement("div");ae.id="top_bar_div";se.appendChild(ae);var $e=document.createElement("h3");$e.textContent="Polar H10 raw data visualizer";$e.classList.add("title");ae.appendChild($e);ae.classList.add("center");var Ei="ble_connect_btn",Q=document.createElement("button");Q.setAttribute("data-tooltip","Connect new Polar H10");Q.id=Ei;Q.classList.add("btn","btn-primary","btn-action","s-circle","ble-conn");var re=document.createElement("div");re.id="content_div";re.classList.add("flexbox","content");se.appendChild(re);if(navigator.bluetooth===void 0){let s=document.createElement("p");s.innerHTML=`Web Bluetooth API is not present!<br>
Please make sure you are using the latest chrome/chromium based browser.<br>
Also make sure to enable experimental-web-platform-features in your browser <a href="chrome://flags/#enable-experimental-web-platform-features">chrome://flags/#enable-experimental-web-platform-features</a> `,s.setAttribute("style","margin:5% 20%;font-size:1.4em;"),re.appendChild(s),window.stop()}var Yt=document.createElement("i");Yt.setAttribute("class","icon icon-plus");Q.appendChild(Yt);Q.addEventListener("click",bi(re,Wt));ae.appendChild(Q);function bi(s,r){return async o=>{let _;try{_=await navigator.bluetooth.requestDevice({filters:[{namePrefix:"Polar"}],optionalServices:["battery_service","fb005c80-02e7-f387-1cad-8acd2d8df0c8"]})}catch(a){console.log(a);return}r(s,_)}}
/*! Bundled license information:

smoothie/smoothie.js:
  (**
   * @license
   * MIT License:
   *
   * Copyright (c) 2010-2013, Joe Walnes
   *               2013-2018, Drew Noakes
   *
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   *
   * The above copyright notice and this permission notice shall be included in
   * all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
   * THE SOFTWARE.
   *)

fili/dist/fili.min.js:
  (**
   * @name    fili
   * @version 2.0.3 | December 13th 2018
   * @author  Florian Markert
   * @license MIT
   *)
*/
//# sourceMappingURL=index.js.map
